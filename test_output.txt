
[1m[46m RUN [49m[22m [36mv4.0.12 [39m[90mC:/laragon/www/claude/ecommerce-platform[39m

[90mstdout[2m | src/test/api/media/upload.test.ts
[22m[39mDEBUG: Is getServerSession mocked? [33mtrue[39m

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould return 401 if not authenticated
[22m[39mDEBUG: POST start
DEBUG: getServerSession type function

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould return 401 if not authenticated
[22m[39mDEBUG: Session retrieved null

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould return 400 if no file provided
[22m[39mDEBUG: POST start
DEBUG: getServerSession type function

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould return 400 if no file provided
[22m[39mDEBUG: Session retrieved found

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould upload file and create database record
[22m[39mDEBUG: POST start
DEBUG: getServerSession type function

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould upload file and create database record
[22m[39mDEBUG: Session retrieved found

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould upload file and create database record
[22m[39mDEBUG: Calling uploadToCloudinary

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould upload file and create database record
[22m[39mDEBUG: uploadToCloudinary done
DEBUG: Calling prisma.create

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould handle upload errors
[22m[39mDEBUG: POST start
DEBUG: getServerSession type function

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould handle upload errors
[22m[39mDEBUG: Session retrieved found

[90mstdout[2m | src/test/api/media/upload.test.ts[2m > [22m[2mMedia Upload API[2m > [22m[2mshould handle upload errors
[22m[39mDEBUG: Calling uploadToCloudinary

stderr | src/test/api/media/upload.test.ts > Media Upload API > should handle upload errors
Upload error: Error: Cloudinary error
    at C:/laragon/www/claude/ecommerce-platform/src/test/api/media/upload.test.ts:137:61
    at file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:912:26
    at file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:1237:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:1203:10)
    at file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:1647:37
    at Traces.$ (file:///C:/laragon/www/claude/ecommerce-platform/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/laragon/www/claude/ecommerce-platform/node_modules/vitest/dist/chunks/test.DqQZzsWf.js:234:21)
    at runTest (file:///C:/laragon/www/claude/ecommerce-platform/node_modules/@vitest/runner/dist/index.js:1647:12)

 [31mâ¯[39m src/test/api/media/upload.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 68[2mms[22m[39m
     [32mâœ“[39m should return 401 if not authenticated[32m 16[2mms[22m[39m
     [32mâœ“[39m should return 400 if no file provided[32m 5[2mms[22m[39m
[31m     [31mÃ—[31m should upload file and create database record[39m[32m 31[2mms[22m[39m
     [32mâœ“[39m should handle upload errors[32m 12[2mms[22m[39m

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/test/api/media/upload.test.ts > Media Upload API > should upload file and create database record
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "data": ObjectContaining {
-       "filename": "test.jpg",
+   {
+     "data": {
+       "aspectRatio": 1,
+       "cloudinaryId": "test_id",
+       "fileSize": 1024,
+       "filename": "blob",
+       "folderId": null,
+       "format": "jpg",
+       "height": 100,
+       "mimeType": "image/jpeg",
+       "originalName": "blob",
+       "publicId": "test_id",
+       "secureUrl": "https://cloudinary.com/test.jpg",
+       "type": "IMAGE",
        "uploadedById": "1",
+       "url": "http://cloudinary.com/test.jpg",
+       "version": 1,
+       "width": 100,
      },
    },
  ]


Number of calls: 1

 â¯ src/test/api/media/upload.test.ts:124:44
    122|         expect(data).toEqual(mockMedia)
    123|         expect(uploadToCloudinary).toHaveBeenCalled()
    124|         expect(prisma.mediaLibrary.create).toHaveBeenCalledWith(expectâ€¦
       |                                            ^
    125|             data: expect.objectContaining({
    126|                 filename: 'test.jpg',

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m3 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 20:20:15
[2m   Duration [22m 1.68s[2m (transform 117ms, setup 182ms, collect 170ms, tests 68ms, environment 1.02s, prepare 17ms)[22m

