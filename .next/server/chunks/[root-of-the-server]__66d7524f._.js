module.exports=[904733,e=>e.a(async(t,r)=>{try{let t=await e.y("@prisma/client/runtime/library");e.n(t),r()}catch(e){r(e)}},!0),316487,e=>e.a(async(t,r)=>{try{var a=e.i(89171),i=e.i(823667),s=e.i(79832),o=e.i(698043),n=e.i(286008),u=e.i(517350),l=e.i(904733),d=t([l]);async function c(e,{params:t}){let{id:r}=await t;try{let t,l=await (0,i.getServerSession)(s.authOptions);if(!l?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});if("SUPERADMIN"!==l.user.role)return a.NextResponse.json({error:"Insufficient permissions"},{status:403});let d=await o.prisma.dataImport.findUnique({where:{id:r}});if(!d)return a.NextResponse.json({error:"Import not found"},{status:404});if("COMPLETED"===d.status)return a.NextResponse.json({error:"Import already processed"},{status:400});await o.prisma.dataImport.update({where:{id:r},data:{status:"IN_PROGRESS"}});let c=await fetch(d.fileUrl);if(!c.ok)throw Error("Failed to fetch import file");let S=await c.text();if("CSV"===d.format)t=(0,n.parseCSV)(S);else if("JSON"===d.format)t=JSON.parse(S);else throw Error("Unsupported file format");let v={successCount:0,failedCount:0,skippedCount:0,errors:[]};return await o.prisma.$transaction(async e=>{for(let r=0;r<t.length;r++){let a=t[r],i=r+2;try{switch(d.type){case"PRODUCTS":await p(a,d.mode,e,v,i);break;case"PRODUCT_IMAGES":await C(a,d.mode,e,v,i);break;case"PRODUCT_VARIANTS":await h(a,d.mode,e,v,i);break;case"CUSTOMERS":await w(a,d.mode,e,v,i);break;case"CATEGORIES":await m(a,d.mode,e,v,i);break;case"INVENTORY":await f(a,e,v,i);break;case"BLOG_POSTS":await E(a,d.mode,e,v,i);break;case"PAGES":await R(a,d.mode,e,v,i);break;case"MEDIA_LIBRARY":await g(a,d.mode,e,v,i);break;case"REVIEWS":await P(a,d.mode,e,v,i);break;case"NEWSLETTER_SUBSCRIBERS":await T(a,d.mode,e,v,i);break;case"DISCOUNT_CODES":await U(a,d.mode,e,v,i);break;default:v.skippedCount++,v.errors.push({row:i,error:"Unsupported import type"})}}catch(e){v.failedCount++,v.errors.push({row:i,error:e instanceof Error?e.message:"Unknown error"})}}},{timeout:12e4}),await o.prisma.dataImport.update({where:{id:r},data:{status:v.failedCount>0?"PARTIAL":"COMPLETED",totalRows:t.length,successCount:v.successCount,failedCount:v.failedCount,skippedCount:v.skippedCount,errors:JSON.stringify(v.errors),completedAt:new Date}}),await (0,u.logActivity)({userId:l.user.id,action:"UPDATE",resource:"DATA_IMPORT",resourceId:r,details:`Processed import: ${v.successCount} success, ${v.failedCount} failed`,ipAddress:(0,u.getClientIp)(e),userAgent:(0,u.getUserAgent)(e)}),a.NextResponse.json({message:"Import completed",results:{total:t.length,success:v.successCount,failed:v.failedCount,skipped:v.skippedCount,errors:v.errors}})}catch(e){console.error("Error processing import:",e);try{await o.prisma.dataImport.update({where:{id:r},data:{status:"FAILED",errors:JSON.stringify({error:e instanceof Error?e.message:"Unknown error"})}})}catch(e){console.error("Error updating import status:",e)}return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,t,r,a,i){let s=e.SKU?.trim(),o=e.Name?.trim(),n=parseFloat(e.Price),u=parseInt(e.Stock),d=e.Published?.toLowerCase()==="yes";if(!s||!o||isNaN(n)||isNaN(u))throw Error("Missing required fields");let c=await r.product.findUnique({where:{sku:s}});if("CREATE"===t){if(c)return void a.skippedCount++;let t=o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");await r.product.create({data:{sku:s,name:o,slug:`${t}-${Date.now()}`,price:new l.Decimal(n),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:u,published:d,featured:e.Featured?.toLowerCase()==="yes",description:e.Description||null}}),a.successCount++}else if("UPDATE"===t){if(!c)return void a.skippedCount++;await r.product.update({where:{sku:s},data:{name:o,price:new l.Decimal(n),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:u,published:d,featured:e.Featured?.toLowerCase()==="yes",description:e.Description||null}}),a.successCount++}else if("UPSERT"===t){let t=o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");await r.product.upsert({where:{sku:s},create:{sku:s,name:o,slug:`${t}-${Date.now()}`,price:new l.Decimal(n),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:u,published:d,featured:e.Featured?.toLowerCase()==="yes",description:e.Description||null},update:{name:o,price:new l.Decimal(n),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:u,published:d,featured:e.Featured?.toLowerCase()==="yes",description:e.Description||null}}),a.successCount++}}async function w(e,t,r,a,i){let s=e.Email?.trim(),o=e.Name?.trim();if(!s||!o)throw Error("Missing required fields");let n=await r.user.findUnique({where:{email:s}});if("CREATE"===t){if(n)return void a.skippedCount++;await r.user.create({data:{email:s,name:o,role:"CUSTOMER"}}),a.successCount++}else if("UPDATE"===t){if(!n)return void a.skippedCount++;await r.user.update({where:{email:s},data:{name:o}}),a.successCount++}else"UPSERT"===t&&(await r.user.upsert({where:{email:s},create:{email:s,name:o,role:"CUSTOMER"},update:{name:o}}),a.successCount++)}async function m(e,t,r,a,i){let s=e.Name?.trim(),o=e.Slug?.trim();if(!s||!o)throw Error("Missing required fields");let n=await r.category.findUnique({where:{slug:o}});if("CREATE"===t){if(n)return void a.skippedCount++;await r.category.create({data:{name:s,slug:o,description:e.Description||null}}),a.successCount++}else if("UPDATE"===t){if(!n)return void a.skippedCount++;await r.category.update({where:{slug:o},data:{name:s,description:e.Description||null}}),a.successCount++}else"UPSERT"===t&&(await r.category.upsert({where:{slug:o},create:{name:s,slug:o,description:e.Description||null},update:{name:s,description:e.Description||null}}),a.successCount++)}async function f(e,t,r,a){let i=e.SKU?.trim(),s=parseInt(e["Current Stock"]);if(!i||isNaN(s))throw Error("Missing required fields");await t.product.findUnique({where:{sku:i}})?(await t.product.update({where:{sku:i},data:{stock:s}}),r.successCount++):r.skippedCount++}async function C(e,t,r,a,i){let s=e["Product SKU"]?.trim(),o=e["Image URL"]?.trim(),u=e["Alt Text"]?.trim()||"",l=parseInt(e.Position)||0;if(!s||!o)throw Error("Missing required fields: Product SKU and Image URL");let d=await r.product.findUnique({where:{sku:s}});if(!d)throw Error(`Product with SKU ${s} not found`);let c=await (0,n.uploadImageFromUrl)(o),p=await r.productImage.findFirst({where:{productId:d.id,url:c}});if("CREATE"===t){if(p)return void a.skippedCount++;await r.productImage.create({data:{productId:d.id,url:c,altText:u,position:l}}),a.successCount++}else"UPSERT"===t&&(p?await r.productImage.update({where:{id:p.id},data:{altText:u,position:l}}):await r.productImage.create({data:{productId:d.id,url:c,altText:u,position:l}}),a.successCount++)}async function h(e,t,r,a,i){let s=e["Product SKU"]?.trim(),o=e["Variant SKU"]?.trim(),n=e.Options?JSON.parse(e.Options):{},u=parseFloat(e.Price),d=parseInt(e.Stock);if(!s||!o||isNaN(u)||isNaN(d))throw Error("Missing required fields");let c=await r.product.findUnique({where:{sku:s}});if(!c)throw Error(`Product with SKU ${s} not found`);let p=await r.productVariant.findUnique({where:{sku:o}});if("CREATE"===t){if(p)return void a.skippedCount++;await r.productVariant.create({data:{productId:c.id,sku:o,options:n,price:new l.Decimal(u),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:d}}),a.successCount++}else if("UPDATE"===t){if(!p)return void a.skippedCount++;await r.productVariant.update({where:{sku:o},data:{options:n,price:new l.Decimal(u),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:d}}),a.successCount++}else"UPSERT"===t&&(await r.productVariant.upsert({where:{sku:o},create:{productId:c.id,sku:o,options:n,price:new l.Decimal(u),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:d},update:{options:n,price:new l.Decimal(u),comparePrice:e["Compare Price"]?new l.Decimal(parseFloat(e["Compare Price"])):null,stock:d}}),a.successCount++)}async function E(e,t,r,a,i){let s=e.Title?.trim(),o=e.Slug?.trim(),n=e.Content?.trim(),u=e.Status?.toUpperCase()||"DRAFT",l=e["Author Email"]?.trim();if(!s||!o||!n)throw Error("Missing required fields: Title, Slug, Content");let d=null;if(l){let e=await r.user.findUnique({where:{email:l}});d=e?.id}let c=null;if(e["Category Name"]){let t=await r.blogCategory.findFirst({where:{name:e["Category Name"].trim()}});c=t?.id}let p=await r.blogPost.findUnique({where:{slug:o}}),w={title:s,slug:o,excerpt:e.Excerpt||null,content:n,featuredImage:e["Featured Image"]||null,status:u,publishedAt:e["Published At"]?new Date(e["Published At"]):null,categoryId:c,authorId:d,metaTitle:e["Meta Title"]||null,metaDescription:e["Meta Description"]||null,metaKeywords:e["Meta Keywords"]||null};if("CREATE"===t){if(p)return void a.skippedCount++;await r.blogPost.create({data:w}),a.successCount++}else if("UPDATE"===t){if(!p)return void a.skippedCount++;await r.blogPost.update({where:{slug:o},data:w}),a.successCount++}else"UPSERT"===t&&(await r.blogPost.upsert({where:{slug:o},create:w,update:w}),a.successCount++)}async function R(e,t,r,a,i){let s=e.Title?.trim(),o=e.Slug?.trim(),n=e.Content?.trim(),u=e.Status?.toUpperCase()||"DRAFT";if(!s||!o||!n)throw Error("Missing required fields: Title, Slug, Content");let l=null;if(e["Parent Page Slug"]){let t=await r.page.findUnique({where:{slug:e["Parent Page Slug"].trim()}});l=t?.id}let d=await r.page.findUnique({where:{slug:o}}),c={title:s,slug:o,content:n,status:u,parentId:l,template:e.Template||null,metaTitle:e["Meta Title"]||null,metaDescription:e["Meta Description"]||null};if("CREATE"===t){if(d)return void a.skippedCount++;await r.page.create({data:c}),a.successCount++}else if("UPDATE"===t){if(!d)return void a.skippedCount++;await r.page.update({where:{slug:o},data:c}),a.successCount++}else"UPSERT"===t&&(await r.page.upsert({where:{slug:o},create:c,update:c}),a.successCount++)}async function g(e,t,r,a,i){let s=e.URL?.trim(),o=e.Filename?.trim(),u=e["Original Name"]?.trim()||o;if(!s||!o)throw Error("Missing required fields: URL, Filename");let l=await (0,n.uploadImageFromUrl)(s),d=await r.file.findFirst({where:{url:l}}),c={filename:o,originalName:u,url:l,mimeType:e["MIME Type"]||"image/jpeg",fileSize:parseInt(e["File Size"])||0,altText:e["Alt Text"]||null,title:e.Title||null,caption:e.Caption||null};if("CREATE"===t){if(d)return void a.skippedCount++;await r.file.create({data:c}),a.successCount++}else"UPSERT"===t&&(d?await r.file.update({where:{id:d.id},data:c}):await r.file.create({data:c}),a.successCount++)}async function P(e,t,r,a,i){let s=e["Product SKU"]?.trim(),o=e["Customer Email"]?.trim(),n=parseInt(e.Rating),u=e.Comment?.trim();if(!s||!o||isNaN(n)||!u)throw Error("Missing required fields");let l=await r.product.findUnique({where:{sku:s}});if(!l)throw Error(`Product with SKU ${s} not found`);let d=await r.user.findUnique({where:{email:o}});if(!d)throw Error(`User with email ${o} not found`);let c=await r.review.findFirst({where:{productId:l.id,userId:d.id}}),p={productId:l.id,userId:d.id,rating:n,title:e.Title||null,comment:u,verified:e.Verified?.toLowerCase()==="yes",approved:e.Approved?.toLowerCase()==="yes"};if("CREATE"===t){if(c)return void a.skippedCount++;await r.review.create({data:p}),a.successCount++}else if("UPDATE"===t){if(!c)return void a.skippedCount++;await r.review.update({where:{id:c.id},data:p}),a.successCount++}else"UPSERT"===t&&(c?await r.review.update({where:{id:c.id},data:p}):await r.review.create({data:p}),a.successCount++)}async function T(e,t,r,a,i){let s=e.Email?.trim();if(!s)throw Error("Missing required field: Email");let o=await r.newsletterSubscriber.findUnique({where:{email:s}}),n={email:s,name:e.Name||null,active:e.Active?.toLowerCase()!=="no",source:e.Source||"IMPORT"};if("CREATE"===t){if(o)return void a.skippedCount++;await r.newsletterSubscriber.create({data:n}),a.successCount++}else if("UPDATE"===t){if(!o)return void a.skippedCount++;await r.newsletterSubscriber.update({where:{email:s},data:n}),a.successCount++}else"UPSERT"===t&&(await r.newsletterSubscriber.upsert({where:{email:s},create:n,update:n}),a.successCount++)}async function U(e,t,r,a,i){let s=e.Code?.trim(),o=e.Type?.toUpperCase(),n=parseFloat(e["Discount Value"]);if(!s||!o||isNaN(n))throw Error("Missing required fields: Code, Type, Discount Value");let u=await r.discountCode.findUnique({where:{code:s}}),d={code:s,type:o,discountValue:new l.Decimal(n),minOrderValue:e["Min Order Value"]?new l.Decimal(parseFloat(e["Min Order Value"])):null,maxUses:e["Max Uses"]?parseInt(e["Max Uses"]):null,validFrom:e["Valid From"]?new Date(e["Valid From"]):null,validUntil:e["Valid Until"]?new Date(e["Valid Until"]):null,active:e.Active?.toLowerCase()!=="no"};if("CREATE"===t){if(u)return void a.skippedCount++;await r.discountCode.create({data:d}),a.successCount++}else if("UPDATE"===t){if(!u)return void a.skippedCount++;await r.discountCode.update({where:{code:s},data:d}),a.successCount++}else"UPSERT"===t&&(await r.discountCode.upsert({where:{code:s},create:d,update:d}),a.successCount++)}[l]=d.then?(await d)():d,e.s(["POST",()=>c]),r()}catch(e){r(e)}},!1),914004,e=>e.a(async(t,r)=>{try{var a=e.i(747909),i=e.i(174017),s=e.i(996250),o=e.i(759756),n=e.i(561916),u=e.i(114444),l=e.i(837092),d=e.i(869741),c=e.i(316795),p=e.i(487718),w=e.i(995169),m=e.i(47587),f=e.i(666012),C=e.i(570101),h=e.i(626937),E=e.i(10372),R=e.i(193695);e.i(52474);var g=e.i(600220),P=e.i(316487),T=t([P]);[P]=T.then?(await T)():T;let v=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/import/[id]/process/route",pathname:"/api/admin/import/[id]/process",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/admin/import/[id]/process/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:A,workUnitAsyncStorage:y,serverHooks:D}=v;function U(){return(0,s.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:y})}async function S(e,t,r){v.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/admin/import/[id]/process/route";a=a.replace(/\/index$/,"")||"/";let s=await v.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:P,params:T,nextConfig:U,parsedUrl:S,isDraftMode:A,prerenderManifest:y,routerServerContext:D,isOnDemandRevalidate:I,revalidateOnlyGenerated:k,resolvedPathname:N,clientReferenceManifest:b,serverActionsManifest:O}=s,M=(0,d.normalizeAppPath)(a),x=!!(y.dynamicRoutes[M]||y.routes[N]),q=async()=>((null==D?void 0:D.render404)?await D.render404(e,t,S,!1):t.end("This page could not be found"),null);if(x&&!A){let e=!!y.routes[N],t=y.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(U.experimental.adapterPath)return await q();throw new R.NoFallbackError}}let F=null;!x||v.isDev||A||(F=N,F="/index"===F?"/":F);let _=!0===v.isDev||!x,L=x&&!_;O&&b&&(0,u.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:b,serverActionsManifest:O,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:O})});let V=e.method||"GET",$=(0,n.getTracer)(),K=$.getActiveScopeSpan(),H={params:T,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!U.experimental.authInterrupts},cacheComponents:!!U.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:U.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>v.onRequestError(e,t,a,D)},sharedContext:{buildId:P}},j=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),G=p.NextRequestAdapter.fromNodeNextRequest(j,(0,p.signalFromNodeResponse)(t));try{let s=async e=>v.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==w.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${V} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${V} ${a}`)}),u=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let d=async({previousCacheEntry:i})=>{try{if(!u&&I&&k&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=H.renderOpts.fetchMetrics;let n=H.renderOpts.pendingWaitUntil;n&&r.waitUntil&&(r.waitUntil(n),n=void 0);let l=H.renderOpts.collectedTags;if(!x)return await (0,f.sendResponse)(j,B,a,H.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,C.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[E.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=E.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=E.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:I})},D),t}},c=await v.handleResponse({req:e,nextConfig:U,cacheKey:F,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:u});if(!x)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",I?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,C.fromNodeOutgoingHttpHeaders)(c.value.headers);return u&&x||p.delete(E.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(j,B,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};K?await l(K):await $.withPropagatedContext(e.headers,()=>$.trace(w.BaseServerSpan.handleRequest,{spanName:`${V} ${a}`,kind:n.SpanKind.SERVER,attributes:{"http.method":V,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:I})}),x)throw t;return await (0,f.sendResponse)(j,B,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>U,"routeModule",()=>v,"serverHooks",()=>D,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>y]),r()}catch(e){r(e)}},!1)];

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="807f192a-f864-5912-99de-9975a9cb22ee")}catch(e){}}();
//# sourceMappingURL=%5Broot-of-the-server%5D__66d7524f._.js.map
//# debugId=807f192a-f864-5912-99de-9975a9cb22ee
