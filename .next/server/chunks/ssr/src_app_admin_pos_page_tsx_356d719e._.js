
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0d5b5511-9c53-5bfa-9036-510a7d946c46")}catch(e){}}();
module.exports=[86003,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(875003),e=a.i(241843),f=a.i(870611),g=a.i(699570),h=a.i(335732),i=a.i(872233),j=a.i(108448),k=a.i(546842),l=a.i(368114);let m=[{value:"DINE_IN",label:"Dine In"},{value:"TAKE_AWAY",label:"Take Away"},{value:"DELIVERY",label:"Deliver"}];function n({locationName:a}){let{data:c}=(0,d.useSession)(),n=(0,e.useAppDispatch)(),o=(0,e.useAppSelector)(a=>a.pos.orderType),p=(0,e.useAppSelector)(a=>a.pos.locationId);return(0,b.jsxs)("header",{className:"h-20 border-b bg-background flex items-center justify-between px-6 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Package2,{className:"h-7 w-7 text-primary"}),(0,b.jsx)("span",{className:"font-bold text-xl",children:"POS Terminal"})]}),(0,b.jsx)("div",{className:"flex items-center gap-1 ml-4",children:m.map(a=>(0,b.jsx)(g.Button,{variant:o===a.value?"default":"outline",size:"lg",onClick:()=>n((0,f.setOrderType)(a.value)),className:(0,l.cn)("h-12 px-6 text-base font-semibold rounded-lg",o===a.value&&"shadow-md"),children:a.label},a.value))})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[p&&(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Location"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:a||`ID: ${p.slice(0,8)}...`})]}),(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"ghost",className:"flex items-center gap-3 h-12 px-3",children:[(0,b.jsxs)(i.Avatar,{className:"h-10 w-10",children:[(0,b.jsx)(i.AvatarImage,{src:c?.user?.image||""}),(0,b.jsx)(i.AvatarFallback,{children:c?.user?.name?.charAt(0)||(0,b.jsx)(k.User,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:c?.user?.name||"Admin"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Cashier"})]})]})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,b.jsx)(h.DropdownMenuLabel,{children:"My Account"}),(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsx)(h.DropdownMenuItem,{children:"Settings"}),(0,b.jsx)(h.DropdownMenuItem,{children:"Logout"})]})]})]})]})}var o=a.i(50944),p=a.i(681010),q=a.i(940784),r=a.i(839761),s=a.i(321161),t=a.i(787654),u=a.i(220005);let v=[{icon:p.Home,label:"Home",path:"/admin/pos"},{icon:q.ShoppingBag,label:"Orders",path:"/admin/pos/orders"},{icon:r.BarChart3,label:"Reports",path:"/admin/pos/reports"},{icon:s.Settings,label:"Settings",path:"/admin/pos/settings"}];function w(){let a=(0,o.useRouter)(),e=(0,o.usePathname)(),[f,h]=(0,c.useState)(e);return(0,b.jsxs)("aside",{className:"w-16 border-r bg-background flex flex-col items-center py-4 gap-2",children:[v.map(c=>{let d=c.icon,e=f===c.path;return(0,b.jsx)(g.Button,{variant:e?"secondary":"ghost",size:"icon",className:(0,l.cn)("h-12 w-12 rounded-lg",e&&"bg-primary text-primary-foreground"),onClick:()=>{var b;h(b=c.path),a.push(b)},title:c.label,children:(0,b.jsx)(d,{className:"h-5 w-5"})},c.path)}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-lg",onClick:()=>window.location.reload(),title:"Refresh",children:(0,b.jsx)(t.RotateCcw,{className:"h-5 w-5"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-lg",onClick:()=>{(0,d.signOut)({callbackUrl:"/admin/login"})},title:"Logout",children:(0,b.jsx)(u.LogOut,{className:"h-5 w-5"})})]})}var x=a.i(972596),y=a.i(591119),z=a.i(786304),A=a.i(613749),B=a.i(50522),C=a.i(167453),D=a.i(641710);let E=async a=>{let b=await fetch(a);if(!b.ok)throw Error("An error occurred while fetching the data.");return b.json()};function F(){let[a,d]=(0,c.useState)(0),{data:e,error:f,isLoading:h,mutate:i}=(0,x.default)("/api/pos/orders?status=active",E,{refreshInterval:3e3,onError:a=>{console.error("Error fetching POS orders:",a)}}),j=Array.isArray(e)?e:[];if((0,c.useEffect)(()=>{let a=setInterval(()=>{i()},3e3);return()=>clearInterval(a)},[i]),h)return(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Sales Analytic"}),(0,b.jsx)("div",{className:"flex gap-4",children:[1,2,3].map(a=>(0,b.jsx)(y.Card,{className:"w-64 animate-pulse",children:(0,b.jsx)(y.CardContent,{className:"p-4",children:(0,b.jsx)("div",{className:"h-20 bg-muted rounded"})})},a))})]});let k=j||[],l=Math.ceil(k.length/3),m=3*a,n=k.slice(m,m+3);return(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold",children:["Sales Analytic ",k.length>0&&`(${k.length})`]}),l>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"icon",onClick:()=>d(a=>Math.max(0,a-1)),disabled:0===a,children:(0,b.jsx)(A.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsx)(g.Button,{variant:"outline",size:"icon",onClick:()=>d(a=>Math.min(l-1,a+1)),disabled:a>=l-1,children:(0,b.jsx)(B.ChevronRight,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2",children:n.length>0?n.map(a=>(0,b.jsxs)(y.Card,{className:"min-w-[240px] flex-shrink-0",children:[(0,b.jsx)(y.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(y.CardTitle,{className:"text-sm font-medium",children:a.orderNumber||`#${a.id.slice(-6)}`}),(0,b.jsxs)(z.Badge,{variant:"READY"===a.status||"DELIVERED"===a.status?"default":"secondary",className:"text-xs",children:["READY"===a.status||"DELIVERED"===a.status?(0,b.jsx)(C.CheckCircle2,{className:"h-3 w-3 mr-1"}):(0,b.jsx)(D.Clock,{className:"h-3 w-3 mr-1"}),"READY"===a.status||"DELIVERED"===a.status?"Ready to serve":"In Progress"]})]})}),(0,b.jsxs)(y.CardContent,{children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mb-3",children:[a.itemCount," Items"]}),(0,b.jsx)(g.Button,{size:"sm",variant:"READY"===a.status||"DELIVERED"===a.status?"default":"outline",className:"w-full",children:"READY"===a.status||"DELIVERED"===a.status?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Ready to serve"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(D.Clock,{className:"h-4 w-4 mr-2"}),"In Progress"]})})]})]},a.id)):(0,b.jsx)(y.Card,{className:"w-full",children:(0,b.jsx)(y.CardContent,{className:"p-6 text-center text-muted-foreground",children:"No active orders"})})})]})}var G=a.i(269876),H=a.i(325015),I=a.i(781560),J=a.i(406704),K=a.i(256711),L=a.i(814574);function M(){let a=(0,e.useAppSelector)(a=>a.pos.locationId),[d,f]=(0,c.useState)([]),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1);(0,c.useEffect)(()=>{n();let a=setInterval(n,5e3);return()=>clearInterval(a)},[a]);let n=async()=>{i(!0);try{let b=new URLSearchParams;a&&b.append("locationId",a);let c=await fetch(`/api/pos/orders/held?${b.toString()}`);if(c.ok){let a=await c.json();f(a.orders||[])}}catch(a){console.error("Error fetching held orders:",a)}finally{i(!1)}},o=async a=>{try{(await fetch(`/api/pos/orders/${a.id}/resume`,{method:"POST"})).ok?(J.default.success("Order resumed"),n(),m(!1),k(null)):J.default.error("Failed to resume order")}catch(a){console.error("Error resuming order:",a),J.default.error("An error occurred")}},p=async a=>{if(confirm("Are you sure you want to delete this held order?"))try{(await fetch(`/api/pos/orders/${a}`,{method:"DELETE"})).ok?(J.default.success("Order deleted"),n()):J.default.error("Failed to delete order")}catch(a){console.error("Error deleting order:",a),J.default.error("An error occurred")}};return 0!==d.length||h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-4 p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-900 rounded-lg",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D.Clock,{className:"h-4 w-4 text-orange-600"}),(0,b.jsxs)("h3",{className:"font-semibold text-sm",children:["Held Orders (",d.length,")"]})]})}),(0,b.jsx)(G.ScrollArea,{className:"max-h-[200px]",children:(0,b.jsx)("div",{className:"space-y-2",children:d.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background rounded border hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-mono font-semibold truncate",children:a.orderNumber}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["$",a.total.toFixed(2)," • ",(0,K.format)(new Date(a.createdAt),"HH:mm")]}),a.customer&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.customer.name||a.customer.email})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{k(a),m(!0)},title:"Resume order",children:(0,b.jsx)(H.Play,{className:"h-4 w-4"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>p(a.id),title:"Delete order",children:(0,b.jsx)(I.Trash2,{className:"h-4 w-4"})})]})]},a.id))})})]}),(0,b.jsx)(L.Dialog,{open:l,onOpenChange:m,children:(0,b.jsxs)(L.DialogContent,{children:[(0,b.jsxs)(L.DialogHeader,{children:[(0,b.jsx)(L.DialogTitle,{children:"Resume Held Order"}),(0,b.jsx)(L.DialogDescription,{children:"This will restore the order to active status. You can then complete the payment."})]}),j&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Order:"}),(0,b.jsx)("span",{className:"font-semibold",children:j.orderNumber})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["$",j.total.toFixed(2)]})]}),j.customer&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Customer:"}),(0,b.jsx)("span",{className:"font-semibold",children:j.customer.name||j.customer.email})]})]}),(0,b.jsxs)(L.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:()=>j&&o(j),children:"Resume Order"})]})]})})]}):null}var N=a.i(523025),O=a.i(915618),P=a.i(533441),Q=a.i(571987),R=a.i(299568),S=a.i(43542);function T({product:a}){let c=(0,e.useAppDispatch)(),d=(0,e.useAppSelector)(a=>a.pos.cart),{format:h}=(0,R.useCurrency)(),i="string"==typeof a.price?parseFloat(a.price):a.price,j=a.images?.[0]?.url||S.PLACEHOLDER_PRODUCT_IMAGE,k=d.find(b=>b.productId===a.id&&!b.variantId),m=k?.quantity||0,n=()=>{a.stock<=0||(0===m?c((0,f.addToPosCart)({id:`${a.id}-${Date.now()}`,productId:a.id,name:a.name,price:i,quantity:1,image:j})):c((0,f.updatePosCartQuantity)({id:k.id,quantity:m+1})))},o=a.stock<=0;return(0,b.jsxs)("div",{className:(0,l.cn)("border-2 rounded-xl overflow-hidden bg-card hover:shadow-lg transition-all cursor-pointer",m>0&&"ring-2 ring-primary border-primary",o&&"opacity-60"),children:[(0,b.jsxs)("div",{className:"relative aspect-square bg-muted cursor-pointer",onClick:a=>{a.stopPropagation(),o||n()},children:[(0,b.jsx)(Q.default,{src:j,alt:a.name,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",onError:a=>{let b=a.currentTarget;b.onerror=null,b.src=S.PLACEHOLDER_PRODUCT_IMAGE},unoptimized:j?.startsWith("data:")||!1}),o&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-bold text-lg",children:"Out of Stock"})}),m>0&&(0,b.jsx)("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground rounded-full h-10 w-10 flex items-center justify-center font-bold text-lg shadow-lg",children:m})]}),(0,b.jsxs)("div",{className:"p-5",children:[(0,b.jsx)("h3",{className:"font-semibold text-base mb-2 line-clamp-2 min-h-[3rem]",children:a.name}),(0,b.jsx)("p",{className:"text-2xl font-bold mb-4 text-primary",children:h(i)}),m>0?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"icon",className:"h-12 w-12 text-lg font-bold",onClick:a=>{a.stopPropagation(),k&&m>1?c((0,f.updatePosCartQuantity)({id:k.id,quantity:m-1})):k&&c((0,f.removeFromPosCart)(k.id))},disabled:o,children:(0,b.jsx)(N.Minus,{className:"h-5 w-5"})}),(0,b.jsx)("div",{className:"flex-1 text-center",children:(0,b.jsx)("span",{className:"text-2xl font-bold",children:m})}),(0,b.jsx)(g.Button,{variant:"outline",size:"icon",className:"h-12 w-12 text-lg font-bold",onClick:a=>{a.stopPropagation(),n()},disabled:o||a.stock<=m,children:(0,b.jsx)(O.Plus,{className:"h-5 w-5"})})]}),(0,b.jsxs)(g.Button,{variant:"default",size:"lg",className:"w-full h-12 text-base font-semibold",disabled:o,onClick:a=>{a.stopPropagation(),n()},children:[(0,b.jsx)(P.Check,{className:"h-5 w-5 mr-2"}),"In Cart"]})]}):(0,b.jsxs)(g.Button,{variant:"default",size:"lg",className:"w-full h-12 text-base font-semibold",onClick:a=>{a.stopPropagation(),n()},disabled:o,children:[(0,b.jsx)(O.Plus,{className:"h-5 w-5 mr-2"}),"Add Item"]})]})]})}var U=a.i(866718),V=a.i(875083),W=a.i(587532),X=a.i(369012);let Y=a=>fetch(a).then(a=>a.json());function Z(){let[a,d]=(0,c.useState)(""),[e,f]=(0,c.useState)(null),[i,j]=(0,c.useState)([]),{data:k,error:l,isLoading:m}=(0,x.default)(`/api/pos/products?${e?`categoryId=${e}`:""}${a?`&search=${a}`:""}`,Y);(0,c.useEffect)(()=>{fetch("/api/categories").then(a=>a.json()).then(a=>{j([{id:"all",name:"All Menu"},...a||[]])}).catch(console.error)},[]);let n=k?.filter(b=>{if(!a)return!0;let c=a.toLowerCase();return b.name.toLowerCase().includes(c)||b.description?.toLowerCase().includes(c)})||[];return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold",children:["Menu Items ",k&&`(${k.length})`]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(W.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(U.Input,{placeholder:"Search products...",value:a,onChange:a=>d(a.target.value),className:"pl-10 w-64"})]}),(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"outline",size:"icon",children:(0,b.jsx)(X.Filter,{className:"h-4 w-4"})})}),(0,b.jsxs)(h.DropdownMenuContent,{children:[(0,b.jsx)(h.DropdownMenuItem,{onClick:()=>f(null),children:"All Categories"}),i.slice(1).map(a=>(0,b.jsx)(h.DropdownMenuItem,{onClick:()=>f(a.id),children:a.name},a.id))]})]})]})]}),i.length>0&&(0,b.jsx)(V.Tabs,{value:e||"all",onValueChange:a=>f("all"===a?null:a),className:"mb-4",children:(0,b.jsx)(V.TabsList,{className:"grid w-full grid-cols-6",children:i.slice(0,6).map(a=>(0,b.jsx)(V.TabsTrigger,{value:"all"===a.id?"all":a.id,children:a.name},a.id))})}),m?(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[1,2,3,4,5,6,7,8].map(a=>(0,b.jsxs)("div",{className:"border rounded-lg animate-pulse",children:[(0,b.jsx)("div",{className:"aspect-square bg-muted"}),(0,b.jsxs)("div",{className:"p-4 space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,b.jsx)("div",{className:"h-4 bg-muted rounded w-1/2"})]})]},a))}):l?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Error loading products"}):0===n.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No products found"}):(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:n.map(a=>(0,b.jsx)(T,{product:a},a.id))})]})}var $=a.i(870430),_=a.i(334044),aa=a.i(790166);function ab({total:a,onPaymentSelect:d,defaultMethod:e="CASH"}){let[f,h]=(0,c.useState)(e),[i,j]=(0,c.useState)(""),[k,m]=(0,c.useState)(""),n=a=>{h("CASH"),j(a.toString()),d("CASH",a)},o=()=>{let b=parseFloat(k);b>=a&&(h("CASH"),j(k),d("CASH",b))},p=parseFloat(i)||0,q=p-a;return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)($.Label,{className:"text-xs text-muted-foreground mb-1.5 block",children:"Quick Cash"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-1.5",children:[(0,b.jsxs)(g.Button,{type:"button",variant:"CASH"===f&&"50"===i?"default":"outline",className:(0,l.cn)("h-11 text-sm font-semibold","CASH"===f&&"50"===i&&"bg-green-600 hover:bg-green-700"),onClick:()=>n(50),children:[(0,b.jsx)(aa.DollarSign,{className:"h-4 w-4 mr-1"}),"$50"]}),(0,b.jsxs)(g.Button,{type:"button",variant:"CASH"===f&&"100"===i?"default":"outline",className:(0,l.cn)("h-11 text-sm font-semibold","CASH"===f&&"100"===i&&"bg-green-600 hover:bg-green-700"),onClick:()=>n(100),children:[(0,b.jsx)(aa.DollarSign,{className:"h-4 w-4 mr-1"}),"$100"]}),(0,b.jsx)(g.Button,{type:"button",variant:"CASH"===f&&i===a.toString()?"default":"outline",className:(0,l.cn)("h-11 text-sm font-semibold","CASH"===f&&i===a.toString()&&"bg-blue-600 hover:bg-blue-700"),onClick:()=>{h("CASH"),j(a.toString()),d("CASH",a)},children:"Exact"})]})]}),"CASH"===f&&(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)($.Label,{className:"text-xs text-muted-foreground",children:"Custom Amount"}),(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(U.Input,{type:"number",placeholder:"Enter amount",value:k,onChange:a=>m(a.target.value),onKeyDown:a=>{"Enter"===a.key&&o()},className:"h-10 text-sm"}),(0,b.jsx)(g.Button,{type:"button",variant:"outline",className:"h-10 px-3",onClick:o,disabled:!k||parseFloat(k)<a,children:"Apply"})]}),p>0&&(0,b.jsxs)("div",{className:"p-2 bg-muted rounded-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs mb-0.5",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Received:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["$",p.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-base font-bold",children:[(0,b.jsx)("span",{children:"Change:"}),(0,b.jsxs)("span",{className:(0,l.cn)(q>=0?"text-green-600":"text-red-600"),children:["$",q>=0?q.toFixed(2):"0.00"]})]})]})]})]})}var ac=a.i(633508),ad=a.i(533350),ae=a.i(935718),ae=ae;function af({subtotal:a,onDiscountApply:d,appliedDiscount:e,className:f}){let[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("PERCENTAGE"),q=async()=>{if(!h.trim())return void J.default.error("Please enter a discount code");k(!0);try{let b=await fetch("/api/pos/discounts/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h.trim(),subtotal:a})});if(b.ok){let a=await b.json();d({code:a.code,type:a.type,amount:parseFloat(a.discountAmount)}),J.default.success("Discount applied"),i("")}else{let a=await b.json();J.default.error(a.error||"Invalid discount code")}}catch(a){console.error("Error validating discount:",a),J.default.error("Failed to validate discount")}finally{k(!1)}};return(0,b.jsxs)("div",{className:(0,l.cn)("space-y-2",f),children:[(0,b.jsx)($.Label,{className:"text-xs font-semibold",children:"Discount"}),e?(0,b.jsx)("div",{className:"p-2 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-900 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ad.Tag,{className:"h-4 w-4 text-green-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-green-800 dark:text-green-200",children:e.code}),(0,b.jsx)("p",{className:"text-xs text-green-600 dark:text-green-400",children:"PERCENTAGE"===e.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ae.default,{className:"h-3 w-3 inline"}),(e.amount/a*100).toFixed(0),"% off"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aa.DollarSign,{className:"h-3 w-3 inline"}),e.amount.toFixed(2)," off"]})})]})]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 text-green-600 hover:text-green-700",onClick:()=>{d(null),i(""),n(""),J.default.success("Discount removed")},children:(0,b.jsx)(ac.X,{className:"h-4 w-4"})})]})}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(U.Input,{placeholder:"Enter discount code",value:h,onChange:a=>i(a.target.value.toUpperCase()),onKeyDown:a=>{"Enter"===a.key&&q()},className:"h-10 text-sm flex-1"}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",className:"h-10 px-3",onClick:q,disabled:!h.trim()||j,children:j?"...":"Apply"})]}),(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(U.Input,{type:"number",placeholder:"Amount",value:m,onChange:a=>n(a.target.value),className:"h-10 text-sm flex-1"}),(0,b.jsxs)("select",{value:o,onChange:a=>p(a.target.value),className:"h-10 px-2 text-sm border rounded-md bg-background",children:[(0,b.jsx)("option",{value:"PERCENTAGE",children:"%"}),(0,b.jsx)("option",{value:"FIXED_AMOUNT",children:"$"})]}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",className:"h-10 px-3",onClick:()=>{let b=parseFloat(m);if(isNaN(b)||b<=0)return void J.default.error("Please enter a valid discount amount");let c=0;if("PERCENTAGE"===o){if(b>100)return void J.default.error("Percentage cannot exceed 100%");c=a*b/100}else{if(b>a)return void J.default.error("Discount cannot exceed subtotal");c=b}d({code:`MANUAL-${o}`,type:o,amount:c}),J.default.success("Manual discount applied"),n("")},disabled:!m||0>=parseFloat(m),children:"Apply"})]})]})]})}var ag=a.i(114548);function ah(){let a=(0,e.useAppDispatch)(),d=(0,e.useAppSelector)(a=>a.pos.cart),h=(0,e.useAppSelector)(a=>a.pos.orderType),i=(0,e.useAppSelector)(a=>a.pos.locationId),j=(0,e.useAppSelector)(a=>a.pos.cashierId),{format:k}=(0,R.useCurrency)(),[m]=(0,c.useState)("CASH"),[n,o]=(0,c.useState)(null),[p,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(`#${Date.now().toString().slice(-6)}`),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(null),A=d.reduce((a,b)=>a+b.price*b.quantity,0),B=.1*A,C=y?y.amount:0,D=A+B-C,E=n&&n>=D?n-D:0,F=(b,c)=>{c<=0?a((0,f.removeFromPosCart)(b)):a((0,f.updatePosCartQuantity)({id:b,quantity:c}))};(0,c.useEffect)(()=>{d.length>0&&D>0&&!n&&o(D)},[d.length,D]),(0,c.useEffect)(()=>{let a=a=>{"Enter"===a.key&&d.length>0&&!p&&(a.preventDefault(),K())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[d.length,p,m,n,D]);let H=async()=>{if(0===d.length)return void J.default.error("Cart is empty");if(!i||!j)return void J.default.error("Location and cashier must be set");r(!0);try{let b=await fetch("/api/pos/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderType:h,locationId:i,cashierId:j,customerId:u?.id||null,items:d.map(a=>({productId:a.productId,variantId:a.variantId,quantity:a.quantity,price:a.price})),subtotal:A,tax:B,discount:C,discountCode:y?.code||null,discountType:y?.type||null,total:D,paymentMethod:"CASH",notes:w||null})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to create POS order")}let c=await b.json();if(!(await fetch(`/api/pos/orders/${c.id}/hold`,{method:"POST"})).ok)throw Error("Failed to hold order");J.default.success("Order held successfully"),a((0,f.clearPosCart)()),o(null),v(null),x(""),z(null),t(`#${Date.now().toString().slice(-6)}`)}catch(a){console.error("Error holding order:",a),J.default.error("Failed to hold order")}finally{r(!1)}},K=async()=>{if(0===d.length)return void J.default.error("Cart is empty");if(!i||!j)return void J.default.error("Location and cashier must be set");let b="CASH";if(!n||n<D)return void J.default.error("Cash amount must be at least the total amount");r(!0);try{let c=await fetch("/api/pos/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderType:h,locationId:i,cashierId:j,customerId:u?.id||null,items:d.map(a=>({productId:a.productId,variantId:a.variantId,quantity:a.quantity,price:a.price})),subtotal:A,tax:B,discount:C,discountCode:y?.code||null,discountType:y?.type||null,total:D,paymentMethod:b,paymentDetails:n?{cashAmount:n,change:E}:null,notes:w||null})});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Failed to create POS order")}let e=await c.json(),g=await fetch(`/api/pos/orders/${e.id}/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:d.map(a=>({productId:a.productId,variantId:a.variantId,quantity:a.quantity,price:a.price})),subtotal:A,tax:B,discount:C,discountCode:y?.code||null,total:D})});if(!g.ok){let a=await g.json().catch(()=>({}));throw Error(a.error||"Failed to complete order")}let{order:k}=await g.json();(await fetch("/api/pos/payment/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({posOrderId:e.id,paymentMethod:b,amount:D,paymentDetails:n?{cashAmount:n,change:E}:null})})).ok||console.warn("Payment processing failed, but order was created"),J.default.success(`Order ${k.orderNumber} placed successfully!`),a((0,f.clearPosCart)()),o(null),v(null),x(""),z(null),t(`#${Date.now().toString().slice(-6)}`)}catch(a){console.error("Error processing order:",a),J.default.error("Failed to process order")}finally{r(!1)}};return(0,b.jsxs)("aside",{className:"w-96 border-l bg-background flex flex-col h-full overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-3 border-b flex items-center justify-between bg-primary/5 flex-shrink-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base",children:"Order's Summary"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:s})]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(_.Maximize2,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"px-3 py-2 border-b bg-muted/30 flex-shrink-0",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.ShoppingBag,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:["Items (",d.length,")"]})]})}),(0,b.jsx)(G.ScrollArea,{className:"flex-1 min-h-0 overflow-y-auto",children:(0,b.jsx)("div",{className:"p-3",children:0===d.length?(0,b.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,b.jsx)(q.ShoppingBag,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Cart is empty"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Add items to get started"})]}):(0,b.jsx)("div",{className:"space-y-2",children:d.map(c=>(0,b.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded-lg border hover:bg-muted/50 transition-colors",children:[(0,b.jsx)("div",{className:"relative w-12 h-12 rounded overflow-hidden bg-muted flex-shrink-0 border",children:c.image&&(0,b.jsx)(Q.default,{src:c.image,alt:c.name,fill:!0,className:"object-cover",sizes:"48px"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:c.name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[k(c.price)," × ",c.quantity," = ",k(c.price*c.quantity)]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>F(c.id,c.quantity-1),title:"Decrease quantity",children:(0,b.jsx)("span",{className:"text-base font-bold",children:"−"})}),(0,b.jsx)("div",{className:"w-8 text-center",children:(0,b.jsx)("span",{className:"text-sm font-bold",children:c.quantity})}),(0,b.jsx)(g.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>F(c.id,c.quantity+1),title:"Increase quantity",children:(0,b.jsx)("span",{className:"text-base font-bold",children:"+"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{var b;return b=c.id,void a((0,f.removeFromPosCart)(b))},title:"Remove item",children:(0,b.jsx)(I.Trash2,{className:"h-4 w-4"})})]})]},c.id))})})}),(0,b.jsxs)("div",{className:"p-3 border-t space-y-3 bg-muted/20 flex-shrink-0 overflow-y-auto max-h-[60vh]",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Price:"}),(0,b.jsx)("span",{className:"font-medium",children:k(A)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Taxes:"}),(0,b.jsx)("span",{className:"font-medium",children:k(B)})]}),C>0&&(0,b.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Discount:"}),(0,b.jsxs)("span",{className:"font-medium text-green-600",children:["-",k(C)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-1.5 border-t",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsx)("span",{className:"text-primary",children:k(D)})]})]}),d.length>0&&(0,b.jsx)(af,{subtotal:A,onDiscountApply:z,appliedDiscount:y}),d.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)($.Label,{className:"text-xs font-semibold",children:"Order Notes (Optional)"}),(0,b.jsx)("textarea",{className:"w-full min-h-[60px] p-2 text-sm border rounded-md resize-none",placeholder:"Add special instructions or notes...",value:w,onChange:a=>x(a.target.value)})]}),d.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)($.Label,{className:"text-xs font-semibold",children:"Payment Method"}),(0,b.jsx)(ab,{total:D,onPaymentSelect:(a,b)=>{"CASH"===a&&b&&o(b)},defaultMethod:m})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",className:(0,l.cn)("flex-1 h-12 text-sm font-semibold",0===d.length&&"opacity-50 cursor-not-allowed"),onClick:H,disabled:0===d.length||p,children:[(0,b.jsx)(ag.Save,{className:"h-4 w-4 mr-2"}),"Hold"]}),(0,b.jsx)(g.Button,{className:(0,l.cn)("flex-1 h-14 text-base font-bold",0===d.length&&"opacity-50 cursor-not-allowed"),size:"lg",onClick:K,disabled:0===d.length||p||!n||n<D,children:p?"Processing...":(0,b.jsxs)(b.Fragment,{children:["Place Order ",d.length>0&&`(${d.length})`,(0,b.jsx)("span",{className:"ml-2 text-xs font-normal opacity-75",children:"(Enter)"})]})})]})]})]})}let ai=[{key:"Enter",action:"place-order",description:"Place order"},{key:"Escape",action:"clear-cart",description:"Clear cart"},{key:"F1",action:"payment-cash",description:"Cash payment"},{key:"F2",action:"payment-card",description:"Card payment"},{key:"F3",action:"payment-digital",description:"Digital wallet"},{key:"ArrowUp",action:"navigate-up",description:"Navigate up"},{key:"ArrowDown",action:"navigate-down",description:"Navigate down"},{key:"ArrowLeft",action:"navigate-left",description:"Navigate left"},{key:"ArrowRight",action:"navigate-right",description:"Navigate right"},{key:"+",action:"increase-quantity",description:"Increase quantity"},{key:"-",action:"decrease-quantity",description:"Decrease quantity"},{key:"Delete",action:"remove-item",description:"Remove item"}];function aj({onPlaceOrder:a,onPaymentSelect:b,onNavigate:d,enabled:g=!0}){let h=(0,e.useAppDispatch)(),i=(0,e.useAppSelector)(a=>a.pos.cart),j=(0,c.useCallback)((c,e)=>{if(g)switch(c){case"place-order":e.preventDefault(),a?.();break;case"clear-cart":e.preventDefault(),confirm("Clear cart?")&&h((0,f.clearPosCart)());break;case"payment-cash":e.preventDefault(),b?.("CASH");break;case"payment-card":e.preventDefault(),b?.("CARD");break;case"payment-digital":e.preventDefault(),b?.("DIGITAL_WALLET");break;case"increase-quantity":if(i.length>0){let a=i[i.length-1];h((0,f.updatePosCartQuantity)({id:a.id,quantity:a.quantity+1}))}break;case"decrease-quantity":if(i.length>0){let a=i[i.length-1];a.quantity>1?h((0,f.updatePosCartQuantity)({id:a.id,quantity:a.quantity-1})):h((0,f.removeFromPosCart)(a.id))}break;case"remove-item":if(i.length>0){let a=i[i.length-1];h((0,f.removeFromPosCart)(a.id))}break;case"navigate-up":d?.("up");break;case"navigate-down":d?.("down");break;case"navigate-left":d?.("left");break;case"navigate-right":d?.("right")}},[g,h,i,a,b,d]);return(0,c.useEffect)(()=>{if(!g)return;let a=a=>{let b,c=!isNaN(b=parseInt(a.key))&&b>=1&&b<=9?b:null;if(c&&i.length>0&&!a.ctrlKey&&!a.altKey&&!a.shiftKey){let a=i[i.length-1];h((0,f.updatePosCartQuantity)({id:a.id,quantity:c}));return}for(let b of ai){let c=b.key===a.key||b.key.toLowerCase()===a.key.toLowerCase(),d=b.ctrl?a.ctrlKey:!a.ctrlKey,e=b.shift?a.shiftKey:!a.shiftKey,f=b.alt?a.altKey:!a.altKey;if(c&&d&&e&&f){j(b.action,a);break}}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[g,i,h,j]),null}function ak(){let{data:a}=(0,d.useSession)(),g=(0,e.useAppDispatch)();(0,e.useAppSelector)(a=>a.pos.locationId),(0,e.useAppSelector)(a=>a.pos.cashierId);let[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(null),l=(0,c.useRef)();return((0,c.useEffect)(()=>{let b=async()=>{try{let a=await fetch("/api/pos/cashiers/me");if(a.ok){let b=await a.json();b&&(g((0,f.setLocation)(b.locationId)),g((0,f.setCashier)(b.id)),k(b.location?.name||null))}else if(404===a.status){let[a,b]=await Promise.all([fetch("/api/pos/locations"),fetch("/api/pos/cashiers")]);if(a.ok&&b.ok){let c=await a.json(),d=await b.json(),e=c?.find(a=>a.isActive);if(e){g((0,f.setLocation)(e.id)),k(e.name);let a=d?.find(a=>a.locationId===e.id&&a.isActive);a?g((0,f.setCashier)(a.id)):d?.length>0&&d[0]?.isActive&&g((0,f.setCashier)(d[0].id))}else J.default.error("No active location found. Please create a location first.")}}else J.default.error("Failed to load POS session")}catch(a){console.error("Error initializing POS:",a),J.default.error("Failed to initialize POS session")}finally{i(!1)}};a?b():i(!1)},[a,g]),h)?(0,b.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading POS..."})]})}):(0,b.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,b.jsx)(aj,{onPlaceOrder:()=>{l.current?.()},onPaymentSelect:a=>{},enabled:!0}),(0,b.jsx)(n,{locationName:j}),(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,b.jsx)(w,{}),(0,b.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,b.jsx)(M,{}),(0,b.jsx)(F,{}),(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(Z,{})})]})}),(0,b.jsx)(ah,{})]})]})}function al(){return(0,b.jsx)(ak,{})}a.s(["default",()=>al],86003)}];

//# sourceMappingURL=src_app_admin_pos_page_tsx_356d719e._.js.map
//# debugId=0d5b5511-9c53-5bfa-9036-510a7d946c46
