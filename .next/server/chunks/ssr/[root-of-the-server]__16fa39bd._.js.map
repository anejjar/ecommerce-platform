{"version":3,"sources":["../../../../src/lib/permissions.ts","../../../../src/components/admin/ActivityLogViewer.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/admin/%28protected%29/activity-logs/page.tsx"],"sourcesContent":["import { UserRole } from '@prisma/client'\n\nexport type PermissionResource =\n  | 'PRODUCT'\n  | 'ORDER'\n  | 'CUSTOMER'\n  | 'CATEGORY'\n  | 'REVIEW'\n  | 'DISCOUNT'\n  | 'SETTINGS'\n  | 'ANALYTICS'\n  | 'FEATURES'\n  | 'ADMIN_USER'\n  | 'STOCK_ALERT'\n  | 'NEWSLETTER'\n  | 'REFUND'\n  | 'INVENTORY'\n  | 'SUPPLIER'\n  | 'PURCHASE_ORDER'\n\nexport type PermissionAction =\n  | 'VIEW'\n  | 'CREATE'\n  | 'UPDATE'\n  | 'DELETE'\n  | 'MANAGE'\n\n/**\n * Default permissions for each role\n * Format: \"RESOURCE:ACTION\"\n */\nconst ROLE_PERMISSIONS: Record<string, string[]> = {\n  SUPERADMIN: [\n    // Has ALL permissions including feature management\n    'PRODUCT:MANAGE',\n    'ORDER:MANAGE',\n    'CUSTOMER:MANAGE',\n    'CATEGORY:MANAGE',\n    'REVIEW:MANAGE',\n    'DISCOUNT:MANAGE',\n    'SETTINGS:MANAGE',\n    'ANALYTICS:MANAGE',\n    'FEATURES:MANAGE',\n    'ADMIN_USER:MANAGE',\n    'STOCK_ALERT:MANAGE',\n    'NEWSLETTER:MANAGE',\n    'REFUND:MANAGE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:MANAGE',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  ADMIN: [\n    // Has all permissions EXCEPT feature management\n    'PRODUCT:MANAGE',\n    'ORDER:MANAGE',\n    'CUSTOMER:MANAGE',\n    'CATEGORY:MANAGE',\n    'REVIEW:MANAGE',\n    'DISCOUNT:MANAGE',\n    'SETTINGS:MANAGE',\n    'ANALYTICS:MANAGE',\n    'ADMIN_USER:MANAGE',\n    'STOCK_ALERT:MANAGE',\n    'NEWSLETTER:MANAGE',\n    'REFUND:MANAGE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:MANAGE',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  MANAGER: [\n    // Can manage orders, view/update customers and products\n    'ORDER:MANAGE',\n    'CUSTOMER:VIEW',\n    'CUSTOMER:UPDATE',\n    'PRODUCT:VIEW',\n    'PRODUCT:UPDATE',\n    'PRODUCT:CREATE',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'REVIEW:UPDATE',\n    'STOCK_ALERT:VIEW',\n    'REFUND:VIEW',\n    'REFUND:UPDATE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:VIEW',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  EDITOR: [\n    // Can edit products and categories\n    'PRODUCT:VIEW',\n    'PRODUCT:CREATE',\n    'PRODUCT:UPDATE',\n    'CATEGORY:MANAGE',\n    'REVIEW:VIEW',\n    'STOCK_ALERT:VIEW',\n  ],\n\n  SUPPORT: [\n    // View-only access to orders and customers\n    'ORDER:VIEW',\n    'CUSTOMER:VIEW',\n    'PRODUCT:VIEW',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'REFUND:VIEW',\n  ],\n\n  VIEWER: [\n    // Read-only access to all resources\n    'PRODUCT:VIEW',\n    'ORDER:VIEW',\n    'CUSTOMER:VIEW',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'DISCOUNT:VIEW',\n    'ANALYTICS:VIEW',\n    'STOCK_ALERT:VIEW',\n    'NEWSLETTER:VIEW',\n    'REFUND:VIEW',\n  ],\n\n  CUSTOMER: [],\n}\n\n/**\n * Get default permissions for a given role\n */\nexport function getDefaultPermissionsForRole(role: UserRole | string): string[] {\n  return ROLE_PERMISSIONS[role] || []\n}\n\n/**\n * Check if a role has a specific permission\n * MANAGE permission grants all sub-permissions (VIEW, CREATE, UPDATE, DELETE)\n */\nexport function hasPermission(\n  role: UserRole | string | undefined,\n  resource: PermissionResource | string,\n  action: PermissionAction | string\n): boolean {\n  if (!role) return false\n  \n  // SUPERADMIN has all permissions\n  if (role === 'SUPERADMIN') return true\n\n  const permissions = getDefaultPermissionsForRole(role)\n  \n  // Check exact permission\n  const exactPermission = `${resource}:${action}`\n  if (permissions.includes(exactPermission)) return true\n\n  // If resource has MANAGE permission, it includes all actions\n  const managePermission = `${resource}:MANAGE`\n  if (permissions.includes(managePermission)) {\n    // MANAGE grants VIEW, CREATE, UPDATE, DELETE\n    if (['VIEW', 'CREATE', 'UPDATE', 'DELETE'].includes(action)) {\n      return true\n    }\n  }\n\n  return false\n}\n\n/**\n * Helper functions for common permission checks\n */\nexport function canViewResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'VIEW')\n}\n\nexport function canCreateResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'CREATE')\n}\n\nexport function canUpdateResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'UPDATE')\n}\n\nexport function canDeleteResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'DELETE')\n}\n\nexport function canManageResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'MANAGE')\n}\n\n/**\n * Check if user is an admin (any admin role)\n */\nexport function isAdmin(role: UserRole | string | undefined): boolean {\n  if (!role) return false\n  return ['ADMIN', 'SUPERADMIN', 'MANAGER', 'EDITOR', 'SUPPORT', 'VIEWER'].includes(role)\n}\n\n/**\n * Check if user is a super admin\n */\nexport function isSuperAdmin(role: UserRole | string | undefined): boolean {\n  return role === 'SUPERADMIN'\n}\n\n/**\n * Get user's effective permissions (for display purposes)\n */\nexport function getUserPermissions(role: UserRole | string): {\n  resource: string\n  actions: string[]\n}[] {\n  const permissions = getDefaultPermissionsForRole(role)\n  const grouped: Record<string, Set<string>> = {}\n\n  permissions.forEach(permission => {\n    const [resource, action] = permission.split(':')\n    if (!grouped[resource]) {\n      grouped[resource] = new Set()\n    }\n    \n    if (action === 'MANAGE') {\n      // MANAGE implies all actions\n      grouped[resource].add('VIEW')\n      grouped[resource].add('CREATE')\n      grouped[resource].add('UPDATE')\n      grouped[resource].add('DELETE')\n      grouped[resource].add('MANAGE')\n    } else {\n      grouped[resource].add(action)\n    }\n  })\n\n  return Object.entries(grouped).map(([resource, actions]) => ({\n    resource,\n    actions: Array.from(actions).sort(),\n  }))\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/admin/ActivityLogViewer.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/admin/ActivityLogViewer.tsx\",\n    \"default\",\n);\n","import { redirect, notFound } from 'next/navigation'\nimport { getServerSession } from 'next-auth/next'\nimport { authOptions } from '@/lib/auth'\nimport { hasPermission } from '@/lib/permissions'\nimport ActivityLogViewer from '@/components/admin/ActivityLogViewer'\n\nexport const metadata = {\n  title: 'Activity Logs - Admin',\n  description: 'View admin activity logs and audit trail',\n}\n\nexport default async function ActivityLogsPage() {\n  // Check authentication\n  const session = await getServerSession(authOptions)\n  if (!session?.user) {\n    redirect('/admin/login')\n  }\n\n  // Check permissions - only users with ADMIN_USER:VIEW can see activity logs\n  if (!hasPermission(session.user.role, 'ADMIN_USER', 'VIEW')) {\n    notFound()\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold\">Activity Logs</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          View and monitor all administrative actions and changes\n        </p>\n      </div>\n\n      <ActivityLogViewer />\n    </div>\n  )\n}\n"],"names":[],"mappings":"4WA+BA,IAAM,EAA6C,CACjD,WAAY,CAEV,iBACA,eACA,kBACA,kBACA,gBACA,kBACA,kBACA,mBACA,kBACA,oBACA,qBACA,oBACA,gBACA,mBACA,kBACA,wBACD,CAED,MAAO,CAEL,iBACA,eACA,kBACA,kBACA,gBACA,kBACA,kBACA,mBACA,oBACA,qBACA,oBACA,gBACA,mBACA,kBACA,wBACD,CAED,QAAS,CAEP,eACA,gBACA,kBACA,eACA,iBACA,iBACA,gBACA,cACA,gBACA,mBACA,cACA,gBACA,mBACA,gBACA,wBACD,CAED,OAAQ,CAEN,eACA,iBACA,iBACA,kBACA,cACA,mBACD,CAED,QAAS,CAEP,aACA,gBACA,eACA,gBACA,cACA,cACD,CAED,OAAQ,CAEN,eACA,aACA,gBACA,gBACA,cACA,gBACA,iBACA,mBACA,kBACA,cACD,CAED,SAAU,EACZ,AADc,EAcP,SAAS,EACd,CAAmC,CACnC,CAAqC,CACrC,CAAiC,EAEjC,GAAI,CAAC,EAAM,OAAO,EAGlB,GAAa,eAAT,EAAuB,OAAO,EAElC,IAAM,EAjBC,CAAgB,CAiB0B,AAjBzB,EAAK,EAAI,EAAE,CAoB7B,EAAkB,CAHJ,AAGI,EAAG,EAAS,CAAC,EAAE,EAAA,CAAQ,CAC/C,GAAI,EAAY,QAAQ,CAAC,GAAkB,OAAO,EAGlD,IAAM,EAAmB,CAAA,EAAG,EAAS,OAAO,CAAC,UACzC,EAAY,QAAQ,CAAC,IAEnB,CAAC,OAAQ,SAAU,SAAU,SAAS,CAAC,QAAQ,CAAC,EAF7B,CAQ3B,EAR8C,IAEmB,uDC5JlD,CAAA,EADf,AACe,EADf,CAAA,CAAA,QACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,4SAA8S,EAC3U,2EACA,+DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,QACe,uBAAA,AAAuB,EAClC,WAAa,MAAU,AAAJ,MAAU,wRAA0R,EACvT,uDACA,yICLJ,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAOe,eAAe,IAE5B,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,EAAA,WAAW,EAUlD,OATI,AAAC,GAAS,MAAM,AAClB,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,gBAIP,AAAC,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,EAAQ,IAAI,CAAC,IAAI,CAAE,aAAc,SAClD,AAD2D,CAC3D,EAAA,EAAA,QAAA,AAAQ,IAIR,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8BAAqB,kBACnC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,+DAK5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAiB,CAAA,CAAA,KAGxB,mCA7BwB,CACtB,MAAO,wBACP,YAAa,0CACf","ignoreList":[1]}