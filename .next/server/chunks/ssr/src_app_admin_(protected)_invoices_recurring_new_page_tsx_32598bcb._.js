module.exports=[110177,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(238246),f=a.i(699570),g=a.i(591119),h=a.i(866718),i=a.i(870430),j=a.i(429246),k=a.i(580701),l=a.i(596221),m=a.i(400210),n=a.i(114548),o=a.i(915618),p=a.i(781560),q=a.i(406704),r=a.i(901359);function s(){let a=(0,d.useRouter)(),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)({name:"",description:"",customerId:"",customerEmail:"",frequency:"MONTHLY",interval:1,customInterval:30,dayOfMonth:1,dayOfWeek:1,templateId:"",startDate:new Date().toISOString().split("T")[0],endDate:"",autoSend:!0}),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)({description:"",sku:"",quantity:1,unitPrice:0,discount:0});(0,c.useEffect)(()=>{E(),F()},[]);let E=async()=>{try{let a=await fetch("/api/admin/customers?limit=100");if(a.ok){let b=await a.json();v(b.customers||[])}}catch(a){console.error("Error fetching customers:",a)}},F=async()=>{try{let a=await fetch("/api/invoices/templates");if(a.ok){let b=await a.json();x(b.templates||[])}}catch(a){console.error("Error fetching templates:",a)}},G=async()=>{if(!y.name)return void q.default.error("Please enter a name for the recurring invoice");if(0===A.length)return void q.default.error("Please add at least one item");try{t(!0);let b=y.customerEmail;if(y.customerId&&!b){let a=u.find(a=>a.id===y.customerId);b=a?.email}let c=A.reduce((a,b)=>a+b.total,0),d={items:A.map((a,b)=>({...a,position:b})),subtotal:c,tax:0,shipping:0,discount:0,total:c,customerName:u.find(a=>a.id===y.customerId)?.name,customerEmail:b},e=await fetch("/api/invoices/recurring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...y,customerEmail:b,invoiceSettings:d})});if(e.ok){let b=await e.json();q.default.success("Recurring invoice created successfully"),a.push(`/admin/invoices/recurring/${b.id}`)}else{let a=await e.json();q.default.error(a.error||"Failed to create recurring invoice")}}catch(a){console.error("Error creating recurring invoice:",a),q.default.error("Failed to create recurring invoice")}finally{t(!1)}},H=A.reduce((a,b)=>a+b.total,0);return(0,b.jsxs)("div",{className:"container mx-auto py-8 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/admin/invoices/recurring",children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",children:[(0,b.jsx)(m.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Create Recurring Invoice"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Set up automated invoice generation"})]})]}),(0,b.jsx)(f.Button,{onClick:G,disabled:s,children:s?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Save,{className:"mr-2 h-4 w-4"}),"Create"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Basic Information"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Name *"}),(0,b.jsx)(h.Input,{value:y.name,onChange:a=>z({...y,name:a.target.value}),placeholder:"Monthly Subscription Invoice"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Description"}),(0,b.jsx)(j.Textarea,{value:y.description,onChange:a=>z({...y,description:a.target.value}),rows:3,placeholder:"Description of this recurring invoice..."})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Customer"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Customer"}),(0,b.jsxs)(k.Select,{value:y.customerId,onValueChange:a=>{let b=u.find(b=>b.id===a);z({...y,customerId:a,customerEmail:b?.email||""})},children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Select customer"})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"",children:"None (Manual Email)"}),u.map(a=>(0,b.jsx)(k.SelectItem,{value:a.id,children:a.name||a.email},a.id))]})]})]}),!y.customerId&&(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Email Address *"}),(0,b.jsx)(h.Input,{type:"email",value:y.customerEmail,onChange:a=>z({...y,customerEmail:a.target.value}),placeholder:"customer@example.com"})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Schedule"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Frequency *"}),(0,b.jsxs)(k.Select,{value:y.frequency,onValueChange:a=>z({...y,frequency:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"DAILY",children:"Daily"}),(0,b.jsx)(k.SelectItem,{value:"WEEKLY",children:"Weekly"}),(0,b.jsx)(k.SelectItem,{value:"MONTHLY",children:"Monthly"}),(0,b.jsx)(k.SelectItem,{value:"QUARTERLY",children:"Quarterly"}),(0,b.jsx)(k.SelectItem,{value:"YEARLY",children:"Yearly"}),(0,b.jsx)(k.SelectItem,{value:"CUSTOM",children:"Custom"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Interval"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:y.interval,onChange:a=>z({...y,interval:parseInt(a.target.value)||1})}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Every X ",y.frequency.toLowerCase(),"(s)"]})]})]}),"CUSTOM"===y.frequency&&(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Custom Interval (Days)"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:y.customInterval,onChange:a=>z({...y,customInterval:parseInt(a.target.value)||30})})]}),("WEEKLY"===y.frequency||"MONTHLY"===y.frequency||"QUARTERLY"===y.frequency||"YEARLY"===y.frequency)&&(0,b.jsxs)("div",{children:[(0,b.jsxs)(i.Label,{children:["Day of ","WEEKLY"===y.frequency?"Week":"Month"]}),"WEEKLY"===y.frequency?(0,b.jsxs)(k.Select,{value:y.dayOfWeek.toString(),onValueChange:a=>z({...y,dayOfWeek:parseInt(a)}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"0",children:"Sunday"}),(0,b.jsx)(k.SelectItem,{value:"1",children:"Monday"}),(0,b.jsx)(k.SelectItem,{value:"2",children:"Tuesday"}),(0,b.jsx)(k.SelectItem,{value:"3",children:"Wednesday"}),(0,b.jsx)(k.SelectItem,{value:"4",children:"Thursday"}),(0,b.jsx)(k.SelectItem,{value:"5",children:"Friday"}),(0,b.jsx)(k.SelectItem,{value:"6",children:"Saturday"})]})]}):(0,b.jsx)(h.Input,{type:"number",min:"1",max:"31",value:y.dayOfMonth,onChange:a=>z({...y,dayOfMonth:parseInt(a.target.value)||1})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Start Date *"}),(0,b.jsx)(h.Input,{type:"date",value:y.startDate,onChange:a=>z({...y,startDate:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"End Date (Optional)"}),(0,b.jsx)(h.Input,{type:"date",value:y.endDate,onChange:a=>z({...y,endDate:a.target.value})})]})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Invoice Items"}),(0,b.jsx)(g.CardDescription,{children:"Items to include in each generated invoice"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Description *"}),(0,b.jsx)(h.Input,{value:C.description,onChange:a=>D({...C,description:a.target.value}),placeholder:"Item description"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"SKU"}),(0,b.jsx)(h.Input,{value:C.sku,onChange:a=>D({...C,sku:a.target.value}),placeholder:"SKU"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Quantity *"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:C.quantity,onChange:a=>D({...C,quantity:parseInt(a.target.value)||1})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Unit Price *"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",min:"0",value:C.unitPrice,onChange:a=>D({...C,unitPrice:parseFloat(a.target.value)||0})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Discount"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",min:"0",value:C.discount,onChange:a=>D({...C,discount:parseFloat(a.target.value)||0})})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)(f.Button,{onClick:()=>{if(!C.description||C.quantity<=0||C.unitPrice<=0)return void q.default.error("Please fill in all required item fields");let a=C.quantity*C.unitPrice-C.discount;B([...A,{...C,total:a}]),D({description:"",sku:"",quantity:1,unitPrice:0,discount:0})},className:"w-full",children:[(0,b.jsx)(o.Plus,{className:"mr-2 h-4 w-4"}),"Add"]})})]})]}),A.length>0&&(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left p-2",children:"Description"}),(0,b.jsx)("th",{className:"text-left p-2",children:"SKU"}),(0,b.jsx)("th",{className:"text-right p-2",children:"Qty"}),(0,b.jsx)("th",{className:"text-right p-2",children:"Price"}),(0,b.jsx)("th",{className:"text-right p-2",children:"Total"}),(0,b.jsx)("th",{className:"w-[50px]"})]})}),(0,b.jsx)("tbody",{children:A.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("td",{className:"p-2",children:a.description}),(0,b.jsx)("td",{className:"p-2",children:a.sku||"-"}),(0,b.jsx)("td",{className:"p-2 text-right",children:a.quantity}),(0,b.jsx)("td",{className:"p-2 text-right",children:(0,r.formatCurrencyWithSymbol)(a.unitPrice,"$")}),(0,b.jsx)("td",{className:"p-2 text-right",children:(0,r.formatCurrencyWithSymbol)(a.total,"$")}),(0,b.jsx)("td",{className:"p-2",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{B(A.filter((a,b)=>b!==c))},children:(0,b.jsx)(p.Trash2,{className:"h-4 w-4 text-red-600"})})})]},c))})]})})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Settings"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Template"}),(0,b.jsxs)(k.Select,{value:y.templateId,onValueChange:a=>z({...y,templateId:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Default template"})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"",children:"Default"}),w.map(a=>(0,b.jsx)(k.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Auto-send"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Automatically email invoices when generated"})]}),(0,b.jsx)("input",{type:"checkbox",checked:y.autoSend,onChange:a=>z({...y,autoSend:a.target.checked}),className:"w-4 h-4"})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Summary"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsx)("span",{children:(0,r.formatCurrencyWithSymbol)(H,"$")})]}),(0,b.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsx)("span",{children:(0,r.formatCurrencyWithSymbol)(H,"$")})]})]})})]})]})]})]})}a.s(["default",()=>s])}];

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9fec6d4b-e927-5f63-b9d6-775ab97bd499")}catch(e){}}();
//# sourceMappingURL=src_app_admin_%28protected%29_invoices_recurring_new_page_tsx_32598bcb._.js.map
//# debugId=9fec6d4b-e927-5f63-b9d6-775ab97bd499
