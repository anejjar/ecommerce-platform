module.exports=[841072,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(50944),f=a.i(591119),g=a.i(699570),h=a.i(786304),i=a.i(206015),j=a.i(814574),k=a.i(866718),l=a.i(883497),m=a.i(406704);function n({isOpen:a,onClose:d,order:e,products:f,onSuccess:h}){let[n,o]=(0,c.useState)(()=>{let a={};return e.items.forEach(b=>{a[b.id]=b.quantity-b.receivedQuantity}),a}),[p,q]=(0,c.useState)(!1),r=async()=>{if(e.items.some(a=>{let b=n[a.id]||0,c=a.quantity-a.receivedQuantity;return b<0||b>c}))return void m.default.error("Invalid quantities. Please check the received quantities.");if(0===Object.values(n).reduce((a,b)=>a+b,0))return void m.default.error("Please enter at least one quantity to receive");q(!0);try{let a=await fetch(`/api/admin/purchase-orders/${e.id}/receive`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e.items.map(a=>({id:a.id,productId:a.productId,receivedQuantity:n[a.id]||0}))})});if(a.ok)m.default.success("Items received successfully"),h(),d();else{let b=await a.json();m.default.error(b.error||"Failed to receive items")}}catch(a){console.error("Receive error:",a),m.default.error("An error occurred while receiving items")}finally{q(!1)}};return(0,b.jsx)(j.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsxs)(j.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Package,{className:"w-5 h-5"}),"Receive Purchase Order: ",e.orderNumber]}),(0,b.jsx)(j.DialogDescription,{children:"Enter the quantity received for each item. This will update your inventory stock levels."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter quantities below or receive all at once"}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>{let a={};e.items.forEach(b=>{a[b.id]=b.quantity-b.receivedQuantity}),o(a)},children:"Receive All"})]}),(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Product"}),(0,b.jsx)(i.TableHead,{children:"SKU"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Ordered"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Already Received"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Remaining"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Receive Now"})]})}),(0,b.jsx)(i.TableBody,{children:e.items.map(a=>{let c=f[a.productId],d=a.quantity-a.receivedQuantity;return(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("span",{className:"font-medium",children:c?.name||"Loading..."})}),(0,b.jsx)(i.TableCell,{className:"text-sm text-muted-foreground",children:c?.sku||"N/A"}),(0,b.jsx)(i.TableCell,{className:"text-right",children:a.quantity}),(0,b.jsx)(i.TableCell,{className:"text-right",children:a.receivedQuantity}),(0,b.jsx)(i.TableCell,{className:"text-right font-medium",children:d}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(k.Input,{type:"number",min:"0",max:d,value:n[a.id]||0,onChange:b=>{var c,d;return c=a.id,d=parseInt(b.target.value)||0,void o(a=>({...a,[c]:d}))},className:"w-20 text-right"})})]},a.id)})})]})}),(0,b.jsxs)("div",{className:"bg-muted p-4 rounded-md",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-2",children:"Summary"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Total Items:"}),(0,b.jsx)("span",{className:"font-medium",children:e.items.length})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Total Receiving:"}),(0,b.jsxs)("span",{className:"font-medium",children:[Object.values(n).reduce((a,b)=>a+b,0)," units"]})]})]})]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:d,disabled:p,children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:r,disabled:p,children:p?"Receiving...":"Confirm Receipt"})]})]})})}var o=a.i(400210),p=a.i(699464),q=a.i(781560),r=a.i(941675),s=a.i(463910),t=a.i(104720),u=a.i(816201),v=a.i(410227),w=a.i(862722),x=a.i(771931);let y={DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300",PENDING:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",CONFIRMED:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",SHIPPED:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",RECEIVED:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",CANCELLED:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"};function z(){let a=(0,e.useRouter)(),j=(0,e.useParams)().id,[k,z]=(0,c.useState)(null),[A,B]=(0,c.useState)({}),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1);(0,c.useEffect)(()=>{j&&I()},[j]);let I=async()=>{try{let b=await fetch(`/api/admin/purchase-orders/${j}`);if(b.ok){let a=await b.json();z(a);let c=a.items.map(a=>a.productId);await J(c)}else 404===b.status&&(m.default.error("Purchase order not found"),a.push("/admin/inventory/purchase-orders"))}catch(a){console.error("Failed to fetch purchase order:",a),m.default.error("Failed to load purchase order details")}finally{D(!1)}},J=async a=>{try{let b=a.map(a=>fetch(`/api/products/${a}`)),c=await Promise.all(b),d=await Promise.all(c.map(a=>a.json())),e={};d.forEach(a=>{e[a.id]={id:a.id,name:a.name,sku:a.sku,slug:a.slug}}),B(e)}catch(a){console.error("Failed to fetch products:",a)}},K=async a=>{if(k){H(!0);try{let b=await fetch(`/api/admin/purchase-orders/${j}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a})});if(b.ok)m.default.success("Status updated successfully"),I();else{let a=await b.json();m.default.error(a.error||"Failed to update status")}}catch(a){console.error("Update error:",a),m.default.error("An error occurred while updating status")}finally{H(!1)}}},L=async()=>{if(k&&confirm(`Are you sure you want to delete purchase order ${k.orderNumber}? This action cannot be undone.`))try{let b=await fetch(`/api/admin/purchase-orders/${j}`,{method:"DELETE"});if(b.ok)m.default.success("Purchase order deleted successfully"),a.push("/admin/inventory/purchase-orders");else{let a=await b.json();m.default.error(a.error||"Failed to delete purchase order")}}catch(a){console.error("Delete error:",a),m.default.error("An error occurred while deleting")}};if(C)return(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Loading purchase order..."})});if(!k)return(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsx)("div",{className:"text-center py-12 text-destructive",children:"Purchase order not found"})});let M="DRAFT"===k.status,N="DRAFT"===k.status,O="PENDING"===k.status||"CONFIRMED"===k.status,P="SHIPPED"===k.status,Q="RECEIVED"!==k.status&&"CANCELLED"!==k.status;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between print:hidden",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(d.default,{href:"/admin/inventory/purchase-orders",children:(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",children:[(0,b.jsx)(o.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:k.orderNumber}),(0,b.jsx)(h.Badge,{className:y[k.status]||"",children:k.status})]}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"Purchase order details"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>{window.print()},children:[(0,b.jsx)(x.Printer,{className:"w-4 h-4 mr-2"}),"Print"]}),M&&(0,b.jsx)(d.default,{href:`/admin/inventory/purchase-orders/${j}/edit`,children:(0,b.jsxs)(g.Button,{variant:"outline",children:[(0,b.jsx)(p.Pencil,{className:"w-4 h-4 mr-2"}),"Edit"]})}),"DRAFT"===k.status&&(0,b.jsxs)(g.Button,{variant:"destructive",onClick:L,children:[(0,b.jsx)(q.Trash2,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),(N||O||P||Q)&&(0,b.jsx)(f.Card,{className:"print:hidden",children:(0,b.jsx)(f.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[N&&(0,b.jsxs)(g.Button,{onClick:()=>K("PENDING"),disabled:G,children:[(0,b.jsx)(u.CheckCircle,{className:"w-4 h-4 mr-2"}),"Confirm Order"]}),O&&(0,b.jsxs)(g.Button,{onClick:()=>K("SHIPPED"),disabled:G,children:[(0,b.jsx)(v.Truck,{className:"w-4 h-4 mr-2"}),"Mark as Shipped"]}),P&&(0,b.jsxs)(g.Button,{onClick:()=>F(!0),disabled:G,children:[(0,b.jsx)(l.Package,{className:"w-4 h-4 mr-2"}),"Receive Items"]}),Q&&(0,b.jsxs)(g.Button,{variant:"destructive",onClick:()=>K("CANCELLED"),disabled:G,children:[(0,b.jsx)(w.XCircle,{className:"w-4 h-4 mr-2"}),"Cancel Order"]})]})})}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Building,{className:"w-5 h-5"}),"Supplier Information"]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Supplier Name"}),(0,b.jsx)(d.default,{href:`/admin/inventory/suppliers/${k.supplier.id}`,className:"text-primary hover:underline",children:k.supplier.name})]}),k.supplier.contactName&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Contact Person"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:k.supplier.contactName})]}),k.supplier.email&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Email"}),(0,b.jsx)("a",{href:`mailto:${k.supplier.email}`,className:"text-sm text-primary hover:underline",children:k.supplier.email})]}),k.supplier.phone&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Phone"}),(0,b.jsx)("a",{href:`tel:${k.supplier.phone}`,className:"text-sm text-primary hover:underline",children:k.supplier.phone})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Calendar,{className:"w-5 h-5"}),"Order Dates"]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Order Date"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(k.orderDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),k.expectedDate&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Expected Delivery"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(k.expectedDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),k.receivedDate&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Received Date"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(k.receivedDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Created"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(k.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Order Items"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Product"}),(0,b.jsx)(i.TableHead,{children:"SKU"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Quantity"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Unit Cost"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Total"}),"RECEIVED"===k.status&&(0,b.jsx)(i.TableHead,{className:"text-right",children:"Received"})]})}),(0,b.jsx)(i.TableBody,{children:k.items.map(a=>{let c=A[a.productId];return(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:c?(0,b.jsx)(d.default,{href:`/admin/products/${c.slug}`,className:"font-medium hover:text-primary hover:underline",children:c.name}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"Loading..."})}),(0,b.jsx)(i.TableCell,{className:"text-sm text-muted-foreground",children:c?.sku||"N/A"}),(0,b.jsx)(i.TableCell,{className:"text-right",children:a.quantity}),(0,b.jsxs)(i.TableCell,{className:"text-right",children:["$",parseFloat(a.unitCost).toFixed(2)]}),(0,b.jsxs)(i.TableCell,{className:"text-right font-medium",children:["$",parseFloat(a.total).toFixed(2)]}),"RECEIVED"===k.status&&(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(h.Badge,{variant:a.receivedQuantity===a.quantity?"default":"secondary",children:a.receivedQuantity})})]},a.id)})})]})}),(0,b.jsxs)("div",{className:"mt-4 space-y-2 max-w-xs ml-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",parseFloat(k.subtotal).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Tax:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",parseFloat(k.tax).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Shipping:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",parseFloat(k.shipping).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("span",{children:["$",parseFloat(k.total).toFixed(2)]})]})]})]})]}),k.notes&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t.FileText,{className:"w-5 h-5"}),"Notes"]})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-line",children:k.notes})})]}),(0,b.jsx)(n,{isOpen:E,onClose:()=>F(!1),order:k,products:A,onSuccess:I})]})}a.s(["default",()=>z],841072)}];

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4a72d245-e96d-50b3-88df-4db4d394fe48")}catch(e){}}();
//# sourceMappingURL=src_app_admin_%28protected%29_inventory_purchase-orders_%5Bid%5D_page_tsx_4215331d._.js.map
//# debugId=4a72d245-e96d-50b3-88df-4db4d394fe48
