module.exports=[93366,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(699570),e=a.i(591119),f=a.i(814574),g=a.i(870430),h=a.i(315055),i=a.i(48468),j=a.i(786304),k=a.i(206015),l=a.i(486192),m=a.i(284505),n=a.i(781560),o=a.i(787654),p=a.i(294632),q=a.i(406704);function r({backups:a,onRefresh:e,onRestore:f,onDelete:g}){let[h,i]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)({previewMode:!1,conflictResolution:"SKIP"}),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),F=async a=>{if(!a.fileUrl)return void q.default.error("Backup file not available");try{let b=await fetch(a.fileUrl),c=await b.blob(),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=a.filename,document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(d),document.body.removeChild(e),q.default.success("Backup downloaded")}catch(a){console.error("Download error:",a),q.default.error("Failed to download backup")}},G=async()=>{if(r&&z){C(!0);try{await f(r.id,x),q.default.success(x.previewMode?"Preview completed":"Backup restored successfully"),i(!1),s(null),A(!1),e()}catch(a){console.error("Restore error:",a),q.default.error("Failed to restore backup")}finally{C(!1)}}},H=async()=>{if(v){E(!0);try{await g(v),q.default.success("Backup deleted"),u(!1),w(null),e()}catch(a){console.error("Delete error:",a),q.default.error("Failed to delete backup")}finally{E(!1)}}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Date"}),(0,b.jsx)(k.TableHead,{children:"Filename"}),(0,b.jsx)(k.TableHead,{children:"Size"}),(0,b.jsx)(k.TableHead,{children:"Type"}),(0,b.jsx)(k.TableHead,{children:"Records"}),(0,b.jsx)(k.TableHead,{children:"Status"}),(0,b.jsx)(k.TableHead,{children:"Created By"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(k.TableBody,{children:0===a.length?(0,b.jsx)(k.TableRow,{children:(0,b.jsx)(k.TableCell,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No backups found"})}):a.map(a=>{var c;return(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableCell,{children:(0,p.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,b.jsx)(k.TableCell,{className:"font-medium",children:a.filename}),(0,b.jsx)(k.TableCell,{children:(a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB","GB"][b]})(a.fileSize)}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)(j.Badge,{variant:"outline",children:a.type})}),(0,b.jsx)(k.TableCell,{children:null!==a.recordCount?a.recordCount.toLocaleString():"-"}),(0,b.jsx)(k.TableCell,{children:(c=a.status,(0,b.jsx)(j.Badge,{variant:{PENDING:"secondary",IN_PROGRESS:"default",COMPLETED:"outline",FAILED:"destructive"}[c]||"default",children:c}))}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("div",{children:a.createdBy.name||"Unknown"}),(0,b.jsx)("div",{className:"text-gray-500 text-xs",children:a.createdBy.email})]})}),(0,b.jsx)(k.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:["COMPLETED"===a.status&&a.fileUrl&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>F(a),title:"Download backup",children:(0,b.jsx)(m.Download,{className:"h-4 w-4"})}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>{s(a),i(!0),A(!1)},title:"Restore backup",children:(0,b.jsx)(o.RotateCcw,{className:"h-4 w-4"})})]}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>{w(a.id),u(!0)},title:"Delete backup",children:(0,b.jsx)(n.Trash2,{className:"h-4 w-4 text-red-500"})})]})})]},a.id)})})]})}),(0,b.jsx)(l.AlertDialog,{open:h,onOpenChange:i,children:(0,b.jsxs)(l.AlertDialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(l.AlertDialogHeader,{children:[(0,b.jsx)(l.AlertDialogTitle,{children:"Restore Backup"}),(0,b.jsxs)(l.AlertDialogDescription,{children:["You are about to restore the backup: ",(0,b.jsx)("strong",{children:r?.filename})]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:"Warning"}),(0,b.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Restoring this backup will modify your database. Make sure you understand the implications."})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"previewMode",checked:x.previewMode,onChange:a=>y({...x,previewMode:a.target.checked}),className:"rounded"}),(0,b.jsx)("label",{htmlFor:"previewMode",className:"text-sm font-medium",children:"Preview mode (dry run - no changes will be made)"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Conflict Resolution"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"radio",name:"conflictResolution",value:"SKIP",checked:"SKIP"===x.conflictResolution,onChange:a=>y({...x,conflictResolution:a.target.value})}),(0,b.jsx)("span",{className:"text-sm",children:"Skip existing records"})]}),(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"radio",name:"conflictResolution",value:"OVERWRITE",checked:"OVERWRITE"===x.conflictResolution,onChange:a=>y({...x,conflictResolution:a.target.value})}),(0,b.jsx)("span",{className:"text-sm",children:"Overwrite existing records"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-2 pt-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"confirmation",checked:z,onChange:a=>A(a.target.checked),className:"mt-1 rounded"}),(0,b.jsx)("label",{htmlFor:"confirmation",className:"text-sm",children:"I understand this will modify the database and I have reviewed the options above"})]})]})]}),(0,b.jsxs)(l.AlertDialogFooter,{children:[(0,b.jsx)(l.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(l.AlertDialogAction,{onClick:G,disabled:!z||B,className:"bg-blue-600 hover:bg-blue-700",children:B?"Restoring...":x.previewMode?"Preview":"Restore"})]})]})}),(0,b.jsx)(l.AlertDialog,{open:t,onOpenChange:u,children:(0,b.jsxs)(l.AlertDialogContent,{children:[(0,b.jsxs)(l.AlertDialogHeader,{children:[(0,b.jsx)(l.AlertDialogTitle,{children:"Delete Backup"}),(0,b.jsx)(l.AlertDialogDescription,{children:"Are you sure you want to delete this backup? This action cannot be undone."})]}),(0,b.jsxs)(l.AlertDialogFooter,{children:[(0,b.jsx)(l.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(l.AlertDialogAction,{onClick:H,disabled:D,className:"bg-red-600 hover:bg-red-700",children:D?"Deleting...":"Delete"})]})]})})]})}var s=a.i(220494),t=a.i(915618),u=a.i(669520);function v(){let[a,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),[v,w]=(0,c.useState)({includeProducts:!0,includeOrders:!0,includeCustomers:!0,includeMedia:!1,includeSettings:!0,type:"MANUAL"}),x=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/admin/backup");if(!a.ok)throw Error("Failed to fetch backups");let b=await a.json();j(b.backups)}catch(a){console.error("Error fetching backups:",a),q.default.error("Failed to load backups")}finally{l(!1)}},[]);(0,c.useEffect)(()=>{x();let b=setInterval(()=>{a.some(a=>"IN_PROGRESS"===a.status||"PENDING"===a.status)&&x()},5e3);return()=>clearInterval(b)},[x,a]);let y=async()=>{p(!0);try{let a=await fetch("/api/admin/backup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to create backup")}await a.json(),q.default.success("Backup started successfully"),n(!1),w({includeProducts:!0,includeOrders:!0,includeCustomers:!0,includeMedia:!1,includeSettings:!0,type:"MANUAL"}),x()}catch(a){console.error("Error creating backup:",a),q.default.error(a instanceof Error?a.message:"Failed to create backup")}finally{p(!1)}},z=async(a,b)=>{try{let c=await fetch(`/api/admin/backup/${a}/restore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to restore backup")}let d=await c.json();b.previewMode?(q.default.success("Preview completed successfully"),console.log("Preview results:",d)):q.default.success("Backup restored successfully")}catch(a){throw console.error("Error restoring backup:",a),a}},A=async a=>{try{let b=await fetch(`/api/admin/backup/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to delete backup")}}catch(a){throw console.error("Error deleting backup:",a),a}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,b.jsx)(s.Database,{className:"w-8 h-8"}),"Backup Management"]}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"Create and manage database backups for disaster recovery"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(d.Button,{variant:"outline",onClick:x,disabled:k,children:[(0,b.jsx)(u.RefreshCw,{className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`}),"Refresh"]}),(0,b.jsxs)(f.Dialog,{open:m,onOpenChange:n,children:[(0,b.jsx)(f.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{children:[(0,b.jsx)(t.Plus,{className:"w-4 h-4 mr-2"}),"Create Backup"]})}),(0,b.jsxs)(f.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(f.DialogHeader,{children:[(0,b.jsx)(f.DialogTitle,{children:"Create New Backup"}),(0,b.jsx)(f.DialogDescription,{children:"Select what to include in the backup"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(g.Label,{className:"text-base font-medium",children:"Include in Backup"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Checkbox,{id:"includeProducts",checked:v.includeProducts,onCheckedChange:a=>w({...v,includeProducts:!!a})}),(0,b.jsx)(g.Label,{htmlFor:"includeProducts",className:"font-normal",children:"Products"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Checkbox,{id:"includeOrders",checked:v.includeOrders,onCheckedChange:a=>w({...v,includeOrders:!!a})}),(0,b.jsx)(g.Label,{htmlFor:"includeOrders",className:"font-normal",children:"Orders"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Checkbox,{id:"includeCustomers",checked:v.includeCustomers,onCheckedChange:a=>w({...v,includeCustomers:!!a})}),(0,b.jsx)(g.Label,{htmlFor:"includeCustomers",className:"font-normal",children:"Customers"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Checkbox,{id:"includeMedia",checked:v.includeMedia,onCheckedChange:a=>w({...v,includeMedia:!!a})}),(0,b.jsx)(g.Label,{htmlFor:"includeMedia",className:"font-normal",children:"Media (metadata only)"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Checkbox,{id:"includeSettings",checked:v.includeSettings,onCheckedChange:a=>w({...v,includeSettings:!!a})}),(0,b.jsx)(g.Label,{htmlFor:"includeSettings",className:"font-normal",children:"Settings"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(g.Label,{className:"text-base font-medium",children:"Backup Type"}),(0,b.jsxs)(i.RadioGroup,{value:v.type,onValueChange:a=>w({...v,type:a}),children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(i.RadioGroupItem,{value:"MANUAL",id:"manual"}),(0,b.jsx)(g.Label,{htmlFor:"manual",className:"font-normal",children:"Manual"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(i.RadioGroupItem,{value:"SCHEDULED",id:"scheduled"}),(0,b.jsx)(g.Label,{htmlFor:"scheduled",className:"font-normal",children:"Scheduled"})]})]})]})]}),(0,b.jsxs)(f.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:y,disabled:o,children:o?"Creating...":"Create Backup"})]})]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Total Backups"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:a.length})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Completed"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:a.filter(a=>"COMPLETED"===a.status).length})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600",children:"In Progress"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a.filter(a=>"IN_PROGRESS"===a.status).length})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Failed"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:a.filter(a=>"FAILED"===a.status).length})})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"All Backups"}),(0,b.jsx)(e.CardDescription,{children:"View and manage your database backups"})]}),(0,b.jsx)(e.CardContent,{children:k?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(u.RefreshCw,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-gray-400"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading backups..."})]}):(0,b.jsx)(r,{backups:a,onRefresh:x,onRestore:z,onDelete:A})})]})]})}a.s(["default",()=>v],93366)}];

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f6bbec79-429f-51db-bc15-b565401a9ab5")}catch(e){}}();
//# sourceMappingURL=src_app_admin_%28protected%29_backup_page_tsx_9806906a._.js.map
//# debugId=f6bbec79-429f-51db-bc15-b565401a9ab5
