module.exports=[93813,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(238246),f=a.i(699570),g=a.i(591119),h=a.i(866718),i=a.i(870430),j=a.i(429246),k=a.i(580701),l=a.i(206015),m=a.i(596221),n=a.i(400210),o=a.i(915618),p=a.i(781560),q=a.i(114548),r=a.i(406704),s=a.i(901359);function t(){let a=(0,d.useRouter)(),t=(0,d.useSearchParams)().get("orderId"),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)({invoiceType:"STANDARD",customerId:"",customerEmail:"",customerName:"",customerCompany:"",invoiceDate:new Date().toISOString().split("T")[0],dueDate:"",billingAddress:null,shippingAddress:null,tax:0,taxRate:0,shipping:0,discount:0,discountType:"FIXED_AMOUNT",termsAndConditions:"",notes:""}),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)({description:"",sku:"",quantity:1,unitPrice:0,taxRate:0,discount:0});(0,c.useEffect)(()=>{t&&G()},[t]);let G=async()=>{try{v(!0);let a=await fetch(`/api/orders/${t}`);if(a.ok){let b=await a.json();z(b),B({...A,customerId:b.userId||"",customerEmail:b.user?.email||b.guestEmail||"",customerName:b.user?.name||(b.shippingAddress?`${b.shippingAddress.firstName} ${b.shippingAddress.lastName}`:""),invoiceDate:new Date().toISOString().split("T")[0],billingAddress:b.billingAddress,shippingAddress:b.shippingAddress,tax:Number(b.tax),shipping:Number(b.shipping),discount:Number(b.discountAmount||0)});let c=b.items.map(a=>({productId:a.productId,variantId:a.variantId,description:a.product.name,sku:a.product.sku||a.variant?.sku||"",quantity:a.quantity,unitPrice:Number(a.price),taxRate:0,discount:0,total:Number(a.total)}));D(c)}else r.default.error("Failed to fetch order")}catch(a){console.error("Error fetching order:",a),r.default.error("An error occurred")}finally{v(!1)}},H=()=>{let a=C.reduce((a,b)=>a+b.total,0),b=A.tax||a*(A.taxRate/100),c=A.shipping||0,d=A.discount||0;return{subtotal:a,tax:b,shipping:c,discount:d,total:a+b+c-d}},I=async()=>{if(0===C.length)return void r.default.error("Please add at least one item");try{x(!0);let b=H(),c=A.dueDate;if(!c){let a=new Date(A.invoiceDate);a.setDate(a.getDate()+30),c=a.toISOString().split("T")[0]}let d=await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...A,dueDate:c,subtotal:b.subtotal,tax:b.tax,shipping:b.shipping,discount:b.discount,total:b.total,amountPaid:0,balanceDue:b.total,currency:"USD",currencySymbol:"$",items:C.map((a,b)=>({...a,position:b})),orderId:t||null})});if(d.ok){let b=await d.json();r.default.success("Invoice created successfully"),a.push(`/admin/invoices/${b.id}`)}else{let a=await d.json();r.default.error(a.error||"Failed to create invoice")}}catch(a){console.error("Error creating invoice:",a),r.default.error("Failed to create invoice")}finally{x(!1)}},J=H();return u?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-gray-600"})}):(0,b.jsxs)("div",{className:"container mx-auto py-8 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/admin/invoices",children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",children:[(0,b.jsx)(n.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Create New Invoice"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:t?"Creating invoice from order":"Create a new invoice from scratch"})]})]}),(0,b.jsx)(f.Button,{onClick:I,disabled:w,children:w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Save,{className:"mr-2 h-4 w-4"}),"Create Invoice"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Basic Information"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Invoice Type"}),(0,b.jsxs)(k.Select,{value:A.invoiceType,onValueChange:a=>B({...A,invoiceType:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"STANDARD",children:"Standard"}),(0,b.jsx)(k.SelectItem,{value:"PROFORMA",children:"Proforma"}),(0,b.jsx)(k.SelectItem,{value:"QUOTE",children:"Quote"}),(0,b.jsx)(k.SelectItem,{value:"CREDIT_NOTE",children:"Credit Note"}),(0,b.jsx)(k.SelectItem,{value:"RECEIPT",children:"Receipt"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Invoice Date"}),(0,b.jsx)(h.Input,{type:"date",value:A.invoiceDate,onChange:a=>B({...A,invoiceDate:a.target.value})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Due Date"}),(0,b.jsx)(h.Input,{type:"date",value:A.dueDate,onChange:a=>B({...A,dueDate:a.target.value})})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Customer Information"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Customer Name"}),(0,b.jsx)(h.Input,{value:A.customerName,onChange:a=>B({...A,customerName:a.target.value}),placeholder:"Customer name"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Customer Email"}),(0,b.jsx)(h.Input,{type:"email",value:A.customerEmail,onChange:a=>B({...A,customerEmail:a.target.value}),placeholder:"customer@example.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Company (Optional)"}),(0,b.jsx)(h.Input,{value:A.customerCompany,onChange:a=>B({...A,customerCompany:a.target.value}),placeholder:"Company name"})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Items"}),(0,b.jsx)(g.CardDescription,{children:"Add items to this invoice"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Description *"}),(0,b.jsx)(h.Input,{value:E.description,onChange:a=>F({...E,description:a.target.value}),placeholder:"Item description"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"SKU"}),(0,b.jsx)(h.Input,{value:E.sku,onChange:a=>F({...E,sku:a.target.value}),placeholder:"SKU"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Quantity *"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:E.quantity,onChange:a=>F({...E,quantity:parseInt(a.target.value)||1})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Unit Price *"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",min:"0",value:E.unitPrice,onChange:a=>F({...E,unitPrice:parseFloat(a.target.value)||0})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Discount"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",min:"0",value:E.discount,onChange:a=>F({...E,discount:parseFloat(a.target.value)||0})})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)(f.Button,{onClick:()=>{if(!E.description||E.quantity<=0||E.unitPrice<=0)return void r.default.error("Please fill in all required item fields");let a=E.quantity*E.unitPrice-E.discount;D([...C,{...E,total:a}]),F({description:"",sku:"",quantity:1,unitPrice:0,taxRate:0,discount:0})},className:"w-full",children:[(0,b.jsx)(o.Plus,{className:"mr-2 h-4 w-4"}),"Add"]})})]})]}),C.length>0&&(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{children:(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableHead,{children:"Description"}),(0,b.jsx)(l.TableHead,{children:"SKU"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Qty"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Unit Price"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Total"}),(0,b.jsx)(l.TableHead,{className:"w-[50px]"})]})}),(0,b.jsx)(l.TableBody,{children:C.map((a,c)=>(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableCell,{children:a.description}),(0,b.jsx)(l.TableCell,{children:a.sku||"-"}),(0,b.jsx)(l.TableCell,{className:"text-right",children:a.quantity}),(0,b.jsx)(l.TableCell,{className:"text-right",children:(0,s.formatCurrencyWithSymbol)(a.unitPrice,"$")}),(0,b.jsx)(l.TableCell,{className:"text-right",children:(0,s.formatCurrencyWithSymbol)(a.total,"$")}),(0,b.jsx)(l.TableCell,{children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{D(C.filter((a,b)=>b!==c))},children:(0,b.jsx)(p.Trash2,{className:"h-4 w-4 text-red-600"})})})]},c))})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Additional Information"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Terms & Conditions"}),(0,b.jsx)(j.Textarea,{value:A.termsAndConditions,onChange:a=>B({...A,termsAndConditions:a.target.value}),rows:4,placeholder:"Enter terms and conditions..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Notes"}),(0,b.jsx)(j.Textarea,{value:A.notes,onChange:a=>B({...A,notes:a.target.value}),rows:3,placeholder:"Enter notes..."})]})]})]})]}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Summary"})}),(0,b.jsx)(g.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsx)("span",{children:(0,s.formatCurrencyWithSymbol)(J.subtotal,"$")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Tax:"}),(0,b.jsx)("span",{children:(0,s.formatCurrencyWithSymbol)(J.tax,"$")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Shipping:"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",value:A.shipping,onChange:a=>B({...A,shipping:parseFloat(a.target.value)||0}),className:"w-24 h-8"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Discount:"}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",value:A.discount,onChange:a=>B({...A,discount:parseFloat(a.target.value)||0}),className:"w-24 h-8"})]}),(0,b.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsx)("span",{children:(0,s.formatCurrencyWithSymbol)(J.total,"$")})]})]})})]})})]})]})}a.s(["default",()=>t])}];

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1a77ecf9-eef3-564b-ba74-295e9251448c")}catch(e){}}();
//# sourceMappingURL=src_app_admin_%28protected%29_invoices_new_page_tsx_dd726026._.js.map
//# debugId=1a77ecf9-eef3-564b-ba74-295e9251448c
