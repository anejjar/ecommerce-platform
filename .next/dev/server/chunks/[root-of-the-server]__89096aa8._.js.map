{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/app/api/popups/active/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\n/**\n * GET /api/popups/active\n * Get active popups for current page\n * Query params: ?page=homepage|product_page|cart|checkout|blog|custom&url=/custom/path\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const page = searchParams.get('page') || 'ALL_PAGES';\n    const url = searchParams.get('url') || '';\n\n    const now = new Date();\n\n    // Build where clause\n    const where: any = {\n      isActive: true,\n      OR: [\n        { startDate: null },\n        { startDate: { lte: now } },\n      ],\n      AND: [\n        {\n          OR: [\n            { endDate: null },\n            { endDate: { gte: now } },\n          ],\n        },\n      ],\n    };\n\n    // Add target filtering\n    if (page === 'ALL_PAGES') {\n      where.target = 'ALL_PAGES';\n    } else {\n      where.OR = [\n        { target: 'ALL_PAGES' },\n        { target: page.toUpperCase() },\n      ];\n\n      // If custom URL, also check customUrls field\n      if (url) {\n        where.OR.push({\n          target: 'CUSTOM_URL',\n          customUrls: {\n            contains: url,\n          },\n        });\n      }\n    }\n\n    const popups = await prisma.popup.findMany({\n      where,\n      orderBy: {\n        priority: 'desc', // Higher priority first\n      },\n      select: {\n        id: true,\n        title: true,\n        content: true,\n        type: true,\n        triggerValue: true,\n        position: true,\n        width: true,\n        height: true,\n        backgroundColor: true,\n        textColor: true,\n        buttonText: true,\n        buttonColor: true,\n        buttonTextColor: true,\n        showCloseButton: true,\n        overlayColor: true,\n        imageUrl: true,\n        frequency: true,\n        delaySeconds: true,\n        ctaType: true,\n        ctaUrl: true,\n        discountCode: true,\n      },\n    });\n\n    return NextResponse.json(popups);\n  } catch (error) {\n    console.error('Error fetching active popups:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,MAAM,aAAa,GAAG,CAAC,UAAU;QAEvC,MAAM,MAAM,IAAI;QAEhB,qBAAqB;QACrB,MAAM,QAAa;YACjB,UAAU;YACV,IAAI;gBACF;oBAAE,WAAW;gBAAK;gBAClB;oBAAE,WAAW;wBAAE,KAAK;oBAAI;gBAAE;aAC3B;YACD,KAAK;gBACH;oBACE,IAAI;wBACF;4BAAE,SAAS;wBAAK;wBAChB;4BAAE,SAAS;gCAAE,KAAK;4BAAI;wBAAE;qBACzB;gBACH;aACD;QACH;QAEA,uBAAuB;QACvB,IAAI,SAAS,aAAa;YACxB,MAAM,MAAM,GAAG;QACjB,OAAO;YACL,MAAM,EAAE,GAAG;gBACT;oBAAE,QAAQ;gBAAY;gBACtB;oBAAE,QAAQ,KAAK,WAAW;gBAAG;aAC9B;YAED,6CAA6C;YAC7C,IAAI,KAAK;gBACP,MAAM,EAAE,CAAC,IAAI,CAAC;oBACZ,QAAQ;oBACR,YAAY;wBACV,UAAU;oBACZ;gBACF;YACF;QACF;QAEA,MAAM,SAAS,MAAM,gIAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACzC;YACA,SAAS;gBACP,UAAU;YACZ;YACA,QAAQ;gBACN,IAAI;gBACJ,OAAO;gBACP,SAAS;gBACT,MAAM;gBACN,cAAc;gBACd,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,iBAAiB;gBACjB,WAAW;gBACX,YAAY;gBACZ,aAAa;gBACb,iBAAiB;gBACjB,iBAAiB;gBACjB,cAAc;gBACd,UAAU;gBACV,WAAW;gBACX,cAAc;gBACd,SAAS;gBACT,QAAQ;gBACR,cAAc;YAChB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}