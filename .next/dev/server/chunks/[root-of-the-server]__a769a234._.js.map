{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport { PrismaAdapter } from '@next-auth/prisma-adapter';\nimport { prisma } from './prisma';\nimport { compare } from 'bcryptjs';\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  session: {\n    strategy: 'jwt',\n  },\n  pages: {\n    signIn: '/admin/login',\n  },\n  providers: [\n    CredentialsProvider({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.password) {\n          return null;\n        }\n\n        const isPasswordValid = await compare(\n          credentials.password,\n          user.password\n        );\n\n        if (!isPasswordValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          role: user.role,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user, trigger }) {\n      if (user) {\n        return {\n          ...token,\n          id: user.id,\n          role: user.role,\n        };\n      }\n\n      // Validate session hasn't been invalidated\n      if (token.id) {\n        const dbUser = await prisma.user.findUnique({\n          where: { id: token.id as string },\n          select: { sessionsInvalidatedAt: true, role: true },\n        });\n\n        if (dbUser) {\n          // Check if JWT was issued before sessions were invalidated\n          if (dbUser.sessionsInvalidatedAt) {\n            const tokenIssuedAt = token.iat ? token.iat * 1000 : 0; // Convert to milliseconds\n            const invalidatedAt = new Date(dbUser.sessionsInvalidatedAt).getTime();\n\n            if (tokenIssuedAt < invalidatedAt) {\n              // Session has been invalidated - return null to force re-login\n              return null as any;\n            }\n          }\n\n          // Update role in token if it changed\n          token.role = dbUser.role;\n        } else {\n          // User no longer exists\n          return null as any;\n        }\n      }\n\n      return token;\n    },\n    async session({ session, token }) {\n      // If token is null, session is invalid\n      if (!token) {\n        return null as any;\n      }\n\n      return {\n        ...session,\n        user: {\n          ...session.user,\n          id: token.id,\n          role: token.role,\n        },\n      };\n    },\n  },\n};\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,IAAA,uLAAa,EAAC,gIAAM;IAC7B,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,IAAA,8IAAO,EACnC,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE;YAChC,IAAI,MAAM;gBACR,OAAO;oBACL,GAAG,KAAK;oBACR,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;gBACjB;YACF;YAEA,2CAA2C;YAC3C,IAAI,MAAM,EAAE,EAAE;gBACZ,MAAM,SAAS,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAC1C,OAAO;wBAAE,IAAI,MAAM,EAAE;oBAAW;oBAChC,QAAQ;wBAAE,uBAAuB;wBAAM,MAAM;oBAAK;gBACpD;gBAEA,IAAI,QAAQ;oBACV,2DAA2D;oBAC3D,IAAI,OAAO,qBAAqB,EAAE;wBAChC,MAAM,gBAAgB,MAAM,GAAG,GAAG,MAAM,GAAG,GAAG,OAAO,GAAG,0BAA0B;wBAClF,MAAM,gBAAgB,IAAI,KAAK,OAAO,qBAAqB,EAAE,OAAO;wBAEpE,IAAI,gBAAgB,eAAe;4BACjC,+DAA+D;4BAC/D,OAAO;wBACT;oBACF;oBAEA,qCAAqC;oBACrC,MAAM,IAAI,GAAG,OAAO,IAAI;gBAC1B,OAAO;oBACL,wBAAwB;oBACxB,OAAO;gBACT;YACF;YAEA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,uCAAuC;YACvC,IAAI,CAAC,OAAO;gBACV,OAAO;YACT;YAEA,OAAO;gBACL,GAAG,OAAO;gBACV,MAAM;oBACJ,GAAG,QAAQ,IAAI;oBACf,IAAI,MAAM,EAAE;oBACZ,MAAM,MAAM,IAAI;gBAClB;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\ncloudinary.config({\n  cloud_name: process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nexport default cloudinary;\n\nexport const uploadToCloudinary = async (file: File, folder: string = 'ecommerce/products'): Promise<any> => {\n  const arrayBuffer = await file.arrayBuffer();\n  const buffer = Buffer.from(arrayBuffer);\n\n  return new Promise((resolve, reject) => {\n    cloudinary.uploader\n      .upload_stream(\n        {\n          folder: folder,\n          resource_type: 'auto', // Allow video/audio/docs\n        },\n        (error, result) => {\n          if (error) reject(error);\n          else resolve(result);\n        }\n      )\n      .end(buffer);\n  });\n};\n\nexport const deleteFromCloudinary = async (publicId: string): Promise<void> => {\n  await cloudinary.uploader.destroy(publicId);\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,gJAAU,CAAC,MAAM,CAAC;IAChB,UAAU;IACV,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;uCAEe,gJAAU;AAElB,MAAM,qBAAqB,OAAO,MAAY,SAAiB,oBAAoB;IACxF,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;IAE3B,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,gJAAU,CAAC,QAAQ,CAChB,aAAa,CACZ;YACE,QAAQ;YACR,eAAe;QACjB,GACA,CAAC,OAAO;YACN,IAAI,OAAO,OAAO;iBACb,QAAQ;QACf,GAED,GAAG,CAAC;IACT;AACF;AAEO,MAAM,uBAAuB,OAAO;IACzC,MAAM,gJAAU,CAAC,QAAQ,CAAC,OAAO,CAAC;AACpC"}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/activity-log.ts"],"sourcesContent":["import { prisma } from './prisma'\n\nexport interface ActivityLogInput {\n  userId: string\n  action: string\n  resource: string\n  resourceId?: string\n  details?: string\n  ipAddress?: string\n  userAgent?: string\n}\n\nexport interface ActivityLogFilters {\n  page?: number\n  limit?: number\n  userId?: string\n  action?: string\n  resource?: string\n  resourceId?: string\n  startDate?: Date\n  endDate?: Date\n}\n\nexport interface ActivityLogResult {\n  logs: any[]\n  total: number\n  page: number\n  limit: number\n  totalPages: number\n}\n\n/**\n * Log an admin activity\n */\nexport async function logActivity(input: ActivityLogInput) {\n  try {\n    const log = await prisma.adminActivityLog.create({\n      data: {\n        userId: input.userId,\n        action: input.action,\n        resource: input.resource,\n        resourceId: input.resourceId,\n        details: input.details,\n        ipAddress: input.ipAddress,\n        userAgent: input.userAgent,\n      },\n    })\n    return log\n  } catch (error) {\n    console.error('Error logging activity:', error)\n    throw error\n  }\n}\n\n/**\n * Get activity logs with filters and pagination\n */\nexport async function getActivityLogs(\n  filters: ActivityLogFilters = {}\n): Promise<ActivityLogResult> {\n  const {\n    page = 1,\n    limit = 20,\n    userId,\n    action,\n    resource,\n    resourceId,\n    startDate,\n    endDate,\n  } = filters\n\n  const where: any = {}\n\n  if (userId) {\n    where.userId = userId\n  }\n\n  if (action) {\n    where.action = action\n  }\n\n  if (resource) {\n    where.resource = resource\n  }\n\n  if (resourceId) {\n    where.resourceId = resourceId\n  }\n\n  if (startDate || endDate) {\n    where.createdAt = {}\n    if (startDate) {\n      where.createdAt.gte = startDate\n    }\n    if (endDate) {\n      where.createdAt.lte = endDate\n    }\n  }\n\n  const [logs, total] = await Promise.all([\n    prisma.adminActivityLog.findMany({\n      where,\n      include: {\n        user: {\n          select: {\n            name: true,\n            email: true,\n            role: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      skip: (page - 1) * limit,\n      take: limit,\n    }),\n    prisma.adminActivityLog.count({ where }),\n  ])\n\n  return {\n    logs,\n    total,\n    page,\n    limit,\n    totalPages: Math.ceil(total / limit) || 0,\n  }\n}\n\n/**\n * Get activity logs by user ID\n */\nexport async function getActivityLogsByUser(\n  userId: string,\n  options: { page?: number; limit?: number } = {}\n): Promise<ActivityLogResult> {\n  return getActivityLogs({\n    userId,\n    page: options.page,\n    limit: options.limit,\n  })\n}\n\n/**\n * Get activity logs by resource\n */\nexport async function getActivityLogsByResource(\n  resource: string,\n  resourceId?: string,\n  options: { page?: number; limit?: number } = {}\n): Promise<ActivityLogResult> {\n  return getActivityLogs({\n    resource,\n    resourceId,\n    page: options.page,\n    limit: options.limit,\n  })\n}\n\n/**\n * Helper to extract IP address from request\n */\nexport function getClientIp(request: Request): string | undefined {\n  const forwardedFor = request.headers.get('x-forwarded-for')\n  if (forwardedFor) {\n    return forwardedFor.split(',')[0].trim()\n  }\n  const realIp = request.headers.get('x-real-ip')\n  if (realIp) {\n    return realIp\n  }\n  return undefined\n}\n\n/**\n * Helper to extract user agent from request\n */\nexport function getUserAgent(request: Request): string | undefined {\n  return request.headers.get('user-agent') || undefined\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAkCO,eAAe,YAAY,KAAuB;IACvD,IAAI;QACF,MAAM,MAAM,MAAM,gIAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC;YAC/C,MAAM;gBACJ,QAAQ,MAAM,MAAM;gBACpB,QAAQ,MAAM,MAAM;gBACpB,UAAU,MAAM,QAAQ;gBACxB,YAAY,MAAM,UAAU;gBAC5B,SAAS,MAAM,OAAO;gBACtB,WAAW,MAAM,SAAS;gBAC1B,WAAW,MAAM,SAAS;YAC5B;QACF;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;AACF;AAKO,eAAe,gBACpB,UAA8B,CAAC,CAAC;IAEhC,MAAM,EACJ,OAAO,CAAC,EACR,QAAQ,EAAE,EACV,MAAM,EACN,MAAM,EACN,QAAQ,EACR,UAAU,EACV,SAAS,EACT,OAAO,EACR,GAAG;IAEJ,MAAM,QAAa,CAAC;IAEpB,IAAI,QAAQ;QACV,MAAM,MAAM,GAAG;IACjB;IAEA,IAAI,QAAQ;QACV,MAAM,MAAM,GAAG;IACjB;IAEA,IAAI,UAAU;QACZ,MAAM,QAAQ,GAAG;IACnB;IAEA,IAAI,YAAY;QACd,MAAM,UAAU,GAAG;IACrB;IAEA,IAAI,aAAa,SAAS;QACxB,MAAM,SAAS,GAAG,CAAC;QACnB,IAAI,WAAW;YACb,MAAM,SAAS,CAAC,GAAG,GAAG;QACxB;QACA,IAAI,SAAS;YACX,MAAM,SAAS,CAAC,GAAG,GAAG;QACxB;IACF;IAEA,MAAM,CAAC,MAAM,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;QACtC,gIAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC;YAC/B;YACA,SAAS;gBACP,MAAM;oBACJ,QAAQ;wBACN,MAAM;wBACN,OAAO;wBACP,MAAM;oBACR;gBACF;YACF;YACA,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM,CAAC,OAAO,CAAC,IAAI;YACnB,MAAM;QACR;QACA,gIAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC;YAAE;QAAM;KACvC;IAED,OAAO;QACL;QACA;QACA;QACA;QACA,YAAY,KAAK,IAAI,CAAC,QAAQ,UAAU;IAC1C;AACF;AAKO,eAAe,sBACpB,MAAc,EACd,UAA6C,CAAC,CAAC;IAE/C,OAAO,gBAAgB;QACrB;QACA,MAAM,QAAQ,IAAI;QAClB,OAAO,QAAQ,KAAK;IACtB;AACF;AAKO,eAAe,0BACpB,QAAgB,EAChB,UAAmB,EACnB,UAA6C,CAAC,CAAC;IAE/C,OAAO,gBAAgB;QACrB;QACA;QACA,MAAM,QAAQ,IAAI;QAClB,OAAO,QAAQ,KAAK;IACtB;AACF;AAKO,SAAS,YAAY,OAAgB;IAC1C,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC;IACzC,IAAI,cAAc;QAChB,OAAO,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IACxC;IACA,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,QAAQ;QACV,OAAO;IACT;IACA,OAAO;AACT;AAKO,SAAS,aAAa,OAAgB;IAC3C,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;AAC9C"}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/app/api/admin/backup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth/next'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport cloudinary from '@/lib/cloudinary'\nimport { logActivity, getClientIp, getUserAgent } from '@/lib/activity-log'\n\n/**\n * GET /api/admin/backup\n * List all backups with status and metadata\n */\nexport async function GET(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions)\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Check if user is ADMIN or SUPERADMIN\n    if (!['ADMIN', 'SUPERADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 })\n    }\n\n    // Parse query parameters\n    const searchParams = request.nextUrl.searchParams\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '20')\n    const type = searchParams.get('type')\n    const status = searchParams.get('status')\n\n    // Build where clause\n    const where: any = {}\n    if (type) {\n      where.type = type\n    }\n    if (status) {\n      where.status = status\n    }\n\n    // Get backups with pagination\n    const [backups, total] = await Promise.all([\n      prisma.backup.findMany({\n        where,\n        include: {\n          createdBy: {\n            select: {\n              id: true,\n              name: true,\n              email: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        skip: (page - 1) * limit,\n        take: limit,\n      }),\n      prisma.backup.count({ where }),\n    ])\n\n    return NextResponse.json({\n      backups,\n      total,\n      page,\n      limit,\n      totalPages: Math.ceil(total / limit),\n    })\n  } catch (error) {\n    console.error('Error fetching backups:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\n/**\n * POST /api/admin/backup\n * Create a new database backup\n */\nexport async function POST(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions)\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Check if user is ADMIN or SUPERADMIN\n    if (!['ADMIN', 'SUPERADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 })\n    }\n\n    // Parse request body\n    const body = await request.json()\n    const {\n      includeProducts = true,\n      includeOrders = true,\n      includeCustomers = true,\n      includeMedia = false,\n      includeSettings = true,\n      type = 'MANUAL',\n    } = body\n\n    // Create backup record\n    const backup = await prisma.backup.create({\n      data: {\n        filename: `backup-${Date.now()}.json`,\n        fileSize: 0, // Will be updated after generation\n        type,\n        status: 'IN_PROGRESS',\n        includeProducts,\n        includeOrders,\n        includeCustomers,\n        includeMedia,\n        includeSettings,\n        createdById: session.user.id,\n      },\n    })\n\n    // Log activity\n    await logActivity({\n      userId: session.user.id,\n      action: 'CREATE',\n      resource: 'BACKUP',\n      resourceId: backup.id,\n      details: `Started backup with ID: ${backup.id}`,\n      ipAddress: getClientIp(request),\n      userAgent: getUserAgent(request),\n    })\n\n    // Generate backup data asynchronously\n    // In a production environment, this should be done in a background job\n    setImmediate(async () => {\n      try {\n        const backupData: any = {\n          version: '1.0',\n          createdAt: new Date().toISOString(),\n          metadata: {\n            includeProducts,\n            includeOrders,\n            includeCustomers,\n            includeMedia,\n            includeSettings,\n          },\n          data: {},\n        }\n\n        let recordCount = 0\n\n        // Export Products\n        if (includeProducts) {\n          const products = await prisma.product.findMany({\n            include: {\n              images: true,\n              variants: true,\n              variantOptions: {\n                include: {\n                  values: true,\n                },\n              },\n              category: true,\n              translations: true,\n              customizationFields: {\n                include: {\n                  options: true,\n                },\n              },\n            },\n          })\n          backupData.data.products = products\n          recordCount += products.length\n\n          const categories = await prisma.category.findMany({\n            include: {\n              translations: true,\n            },\n          })\n          backupData.data.categories = categories\n          recordCount += categories.length\n        }\n\n        // Export Orders\n        if (includeOrders) {\n          const orders = await prisma.order.findMany({\n            include: {\n              items: {\n                include: {\n                  customizations: true,\n                },\n              },\n              shippingAddress: true,\n              billingAddress: true,\n              orderNotes: true,\n              refunds: {\n                include: {\n                  refundItems: true,\n                },\n              },\n            },\n          })\n          backupData.data.orders = orders\n          recordCount += orders.length\n        }\n\n        // Export Customers\n        if (includeCustomers) {\n          const customers = await prisma.user.findMany({\n            where: {\n              role: 'CUSTOMER',\n            },\n            select: {\n              id: true,\n              name: true,\n              email: true,\n              emailVerified: true,\n              image: true,\n              role: true,\n              communicationPreferences: true,\n              createdAt: true,\n              updatedAt: true,\n              addresses: true,\n            },\n          })\n          backupData.data.customers = customers\n          recordCount += customers.length\n        }\n\n        // Export Settings\n        if (includeSettings) {\n          const settings = await prisma.storeSetting.findMany()\n          backupData.data.settings = settings\n          recordCount += settings.length\n\n          const discountCodes = await prisma.discountCode.findMany()\n          backupData.data.discountCodes = discountCodes\n          recordCount += discountCodes.length\n\n          const featureFlags = await prisma.featureFlag.findMany()\n          backupData.data.featureFlags = featureFlags\n          recordCount += featureFlags.length\n        }\n\n        // Export Media metadata (not files)\n        if (includeMedia) {\n          const media = await prisma.mediaLibrary.findMany({\n            include: {\n              folder: true,\n              tags: true,\n              variants: true,\n            },\n          })\n          backupData.data.media = media\n          recordCount += media.length\n        }\n\n        // Convert to JSON string\n        const jsonData = JSON.stringify(backupData, null, 2)\n        const fileSize = Buffer.byteLength(jsonData, 'utf8')\n\n        // Upload to Cloudinary as raw file\n        const uploadResult = await cloudinary.uploader.upload(\n          `data:application/json;base64,${Buffer.from(jsonData).toString('base64')}`,\n          {\n            folder: 'ecommerce/backups',\n            resource_type: 'raw',\n            public_id: `backup-${backup.id}`,\n            format: 'json',\n          }\n        )\n\n        // Update backup record\n        await prisma.backup.update({\n          where: { id: backup.id },\n          data: {\n            status: 'COMPLETED',\n            fileUrl: uploadResult.secure_url,\n            fileSize,\n            recordCount,\n            completedAt: new Date(),\n          },\n        })\n\n        console.log(`Backup ${backup.id} completed successfully`)\n      } catch (error) {\n        console.error(`Error generating backup ${backup.id}:`, error)\n        await prisma.backup.update({\n          where: { id: backup.id },\n          data: {\n            status: 'FAILED',\n            errorMessage: error instanceof Error ? error.message : 'Unknown error',\n          },\n        })\n      }\n    })\n\n    return NextResponse.json({\n      backup: {\n        id: backup.id,\n        status: backup.status,\n        message: 'Backup started. Check status at /api/admin/backup/' + backup.id,\n      },\n    }, { status: 201 })\n  } catch (error) {\n    console.error('Error creating backup:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}