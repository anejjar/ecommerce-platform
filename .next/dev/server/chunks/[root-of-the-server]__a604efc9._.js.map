{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport { PrismaAdapter } from '@next-auth/prisma-adapter';\nimport { prisma } from './prisma';\nimport { compare } from 'bcryptjs';\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  session: {\n    strategy: 'jwt',\n  },\n  pages: {\n    signIn: '/admin/login',\n  },\n  providers: [\n    CredentialsProvider({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.password) {\n          return null;\n        }\n\n        const isPasswordValid = await compare(\n          credentials.password,\n          user.password\n        );\n\n        if (!isPasswordValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          role: user.role,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user, trigger }) {\n      if (user) {\n        return {\n          ...token,\n          id: user.id,\n          role: user.role,\n        };\n      }\n\n      // Validate session hasn't been invalidated\n      if (token.id) {\n        const dbUser = await prisma.user.findUnique({\n          where: { id: token.id as string },\n          select: { sessionsInvalidatedAt: true, role: true },\n        });\n\n        if (dbUser) {\n          // Check if JWT was issued before sessions were invalidated\n          if (dbUser.sessionsInvalidatedAt) {\n            const tokenIssuedAt = token.iat ? token.iat * 1000 : 0; // Convert to milliseconds\n            const invalidatedAt = new Date(dbUser.sessionsInvalidatedAt).getTime();\n\n            if (tokenIssuedAt < invalidatedAt) {\n              // Session has been invalidated - return null to force re-login\n              return null as any;\n            }\n          }\n\n          // Update role in token if it changed\n          token.role = dbUser.role;\n        } else {\n          // User no longer exists\n          return null as any;\n        }\n      }\n\n      return token;\n    },\n    async session({ session, token }) {\n      // If token is null, session is invalid\n      if (!token) {\n        return null as any;\n      }\n\n      return {\n        ...session,\n        user: {\n          ...session.user,\n          id: token.id,\n          role: token.role,\n        },\n      };\n    },\n  },\n};\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,IAAA,uLAAa,EAAC,gIAAM;IAC7B,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,IAAA,8IAAO,EACnC,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE;YAChC,IAAI,MAAM;gBACR,OAAO;oBACL,GAAG,KAAK;oBACR,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;gBACjB;YACF;YAEA,2CAA2C;YAC3C,IAAI,MAAM,EAAE,EAAE;gBACZ,MAAM,SAAS,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAC1C,OAAO;wBAAE,IAAI,MAAM,EAAE;oBAAW;oBAChC,QAAQ;wBAAE,uBAAuB;wBAAM,MAAM;oBAAK;gBACpD;gBAEA,IAAI,QAAQ;oBACV,2DAA2D;oBAC3D,IAAI,OAAO,qBAAqB,EAAE;wBAChC,MAAM,gBAAgB,MAAM,GAAG,GAAG,MAAM,GAAG,GAAG,OAAO,GAAG,0BAA0B;wBAClF,MAAM,gBAAgB,IAAI,KAAK,OAAO,qBAAqB,EAAE,OAAO;wBAEpE,IAAI,gBAAgB,eAAe;4BACjC,+DAA+D;4BAC/D,OAAO;wBACT;oBACF;oBAEA,qCAAqC;oBACrC,MAAM,IAAI,GAAG,OAAO,IAAI;gBAC1B,OAAO;oBACL,wBAAwB;oBACxB,OAAO;gBACT;YACF;YAEA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,uCAAuC;YACvC,IAAI,CAAC,OAAO;gBACV,OAAO;YACT;YAEA,OAAO;gBACL,GAAG,OAAO;gBACV,MAAM;oBACJ,GAAG,QAAQ,IAAI;oBACf,IAAI,MAAM,EAAE;oBACZ,MAAM,MAAM,IAAI;gBAClB;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/formatting.ts"],"sourcesContent":["/**\r\n * Localized formatting utilities for currency, dates, and numbers\r\n */\r\n\r\n/**\r\n * Format currency based on locale\r\n */\r\nexport function formatCurrency(\r\n  amount: number | string,\r\n  locale: string = 'en',\r\n  currency: string = 'USD'\r\n): string {\r\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\r\n\r\n  try {\r\n    return new Intl.NumberFormat(locale, {\r\n      style: 'currency',\r\n      currency,\r\n    }).format(numAmount);\r\n  } catch (error) {\r\n    // Fallback to USD if currency not supported\r\n    return new Intl.NumberFormat(locale, {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n    }).format(numAmount);\r\n  }\r\n}\r\n\r\n/**\r\n * Format date based on locale\r\n */\r\nexport function formatDate(\r\n  date: Date | string,\r\n  locale: string = 'en',\r\n  options?: Intl.DateTimeFormatOptions\r\n): string {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n\r\n  const defaultOptions: Intl.DateTimeFormatOptions = {\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    ...options,\r\n  };\r\n\r\n  return new Intl.DateTimeFormat(locale, defaultOptions).format(dateObj);\r\n}\r\n\r\n/**\r\n * Format date and time based on locale\r\n */\r\nexport function formatDateTime(\r\n  date: Date | string,\r\n  locale: string = 'en',\r\n  options?: Intl.DateTimeFormatOptions\r\n): string {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n\r\n  const defaultOptions: Intl.DateTimeFormatOptions = {\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    ...options,\r\n  };\r\n\r\n  return new Intl.DateTimeFormat(locale, defaultOptions).format(dateObj);\r\n}\r\n\r\n/**\r\n * Format number based on locale\r\n */\r\nexport function formatNumber(\r\n  number: number | string,\r\n  locale: string = 'en',\r\n  options?: Intl.NumberFormatOptions\r\n): string {\r\n  const num = typeof number === 'string' ? parseFloat(number) : number;\r\n\r\n  return new Intl.NumberFormat(locale, options).format(num);\r\n}\r\n\r\n/**\r\n * Format percentage based on locale\r\n */\r\nexport function formatPercentage(\r\n  value: number | string,\r\n  locale: string = 'en',\r\n  decimals: number = 0\r\n): string {\r\n  const num = typeof value === 'string' ? parseFloat(value) : value;\r\n\r\n  return new Intl.NumberFormat(locale, {\r\n    style: 'percent',\r\n    minimumFractionDigits: decimals,\r\n    maximumFractionDigits: decimals,\r\n  }).format(num / 100);\r\n}\r\n\r\n/**\r\n * Format relative time (e.g., \"2 days ago\", \"in 3 hours\")\r\n */\r\nexport function formatRelativeTime(\r\n  date: Date | string,\r\n  locale: string = 'en'\r\n): string {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n  const now = new Date();\r\n  const diffInSeconds = Math.floor((now.getTime() - dateObj.getTime()) / 1000);\r\n\r\n  const rtf = new Intl.RelativeTimeFormat(locale, { numeric: 'auto' });\r\n\r\n  const intervals: { unit: Intl.RelativeTimeFormatUnit; seconds: number }[] = [\r\n    { unit: 'year', seconds: 31536000 },\r\n    { unit: 'month', seconds: 2592000 },\r\n    { unit: 'week', seconds: 604800 },\r\n    { unit: 'day', seconds: 86400 },\r\n    { unit: 'hour', seconds: 3600 },\r\n    { unit: 'minute', seconds: 60 },\r\n    { unit: 'second', seconds: 1 },\r\n  ];\r\n\r\n  for (const interval of intervals) {\r\n    const count = Math.floor(Math.abs(diffInSeconds) / interval.seconds);\r\n    if (count >= 1) {\r\n      return rtf.format(diffInSeconds > 0 ? -count : count, interval.unit);\r\n    }\r\n  }\r\n\r\n  return rtf.format(0, 'second');\r\n}\r\n\r\n/**\r\n * Format file size with locale-specific number formatting\r\n */\r\nexport function formatFileSize(\r\n  bytes: number,\r\n  locale: string = 'en',\r\n  decimals: number = 2\r\n): string {\r\n  if (bytes === 0) return '0 Bytes';\r\n\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n  const value = bytes / Math.pow(k, i);\r\n  const formatted = formatNumber(value, locale, {\r\n    minimumFractionDigits: decimals,\r\n    maximumFractionDigits: decimals,\r\n  });\r\n\r\n  return `${formatted} ${sizes[i]}`;\r\n}\r\n\r\n/**\r\n * Get locale-specific currency symbol\r\n */\r\nexport function getCurrencySymbol(locale: string = 'en', currency: string = 'USD'): string {\r\n  const formatted = new Intl.NumberFormat(locale, {\r\n    style: 'currency',\r\n    currency,\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0,\r\n  }).format(0);\r\n\r\n  // Extract symbol by removing the number\r\n  return formatted.replace(/\\d/g, '').trim();\r\n}\r\n\r\n/**\r\n * Format currency amount with custom symbol\r\n * This is used when you want to use the currency symbol from settings\r\n */\r\nexport function formatCurrencyWithSymbol(\r\n  amount: number | string,\r\n  symbol: string = '$',\r\n  locale: string = 'en-US'\r\n): string {\r\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\r\n  \r\n  if (isNaN(numAmount)) {\r\n    return `${symbol}0.00`;\r\n  }\r\n\r\n  // Format the number with locale-specific formatting\r\n  const formatted = new Intl.NumberFormat(locale, {\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  }).format(numAmount);\r\n\r\n  return `${symbol}${formatted}`;\r\n}\r\n\r\n/**\r\n * Format currency amount with custom symbol (no decimals)\r\n */\r\nexport function formatCurrencyWithSymbolNoDecimals(\r\n  amount: number | string,\r\n  symbol: string = '$',\r\n  locale: string = 'en-US'\r\n): string {\r\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\r\n  \r\n  if (isNaN(numAmount)) {\r\n    return `${symbol}0`;\r\n  }\r\n\r\n  // Format the number with locale-specific formatting\r\n  const formatted = new Intl.NumberFormat(locale, {\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0,\r\n  }).format(numAmount);\r\n\r\n  return `${symbol}${formatted}`;\r\n}\r\n\r\n/**\r\n * Format list of items based on locale\r\n */\r\nexport function formatList(\r\n  items: string[],\r\n  locale: string = 'en',\r\n  type: 'conjunction' | 'disjunction' = 'conjunction'\r\n): string {\r\n  if (items.length === 0) return '';\r\n  if (items.length === 1) return items[0];\r\n\r\n  const formatter = new Intl.ListFormat(locale, {\r\n    style: 'long',\r\n    type,\r\n  });\r\n\r\n  return formatter.format(items);\r\n}\r\n\r\n/**\r\n * Format compact number (e.g., 1K, 1M)\r\n */\r\nexport function formatCompactNumber(\r\n  number: number | string,\r\n  locale: string = 'en'\r\n): string {\r\n  const num = typeof number === 'string' ? parseFloat(number) : number;\r\n\r\n  return new Intl.NumberFormat(locale, {\r\n    notation: 'compact',\r\n    compactDisplay: 'short',\r\n  }).format(num);\r\n}\r\n\r\n/**\r\n * Locale configuration for specific locales\r\n */\r\nexport const localeConfigs = {\r\n  en: {\r\n    currency: 'USD',\r\n    dateFormat: 'MM/DD/YYYY',\r\n    timeFormat: '12h',\r\n  },\r\n  fr: {\r\n    currency: 'EUR',\r\n    dateFormat: 'DD/MM/YYYY',\r\n    timeFormat: '24h',\r\n  },\r\n} as const;\r\n\r\n/**\r\n * Get locale configuration\r\n */\r\nexport function getLocaleConfig(locale: string) {\r\n  return localeConfigs[locale as keyof typeof localeConfigs] || localeConfigs.en;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 479, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/invoice-generator.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { formatCurrencyWithSymbol } from './formatting';\r\nimport { Invoice, InvoiceSettings, InvoiceTemplate } from '@/types/invoice';\r\n\r\n// Define types based on the Prisma schema and what we expect to be passed\r\ninterface Address {\r\n    firstName: string;\r\n    lastName: string;\r\n    company?: string | null;\r\n    address1: string;\r\n    address2?: string | null;\r\n    city: string;\r\n    state?: string | null;\r\n    postalCode: string;\r\n    country: string;\r\n    phone?: string | null;\r\n}\r\n\r\ninterface OrderItem {\r\n    quantity: number;\r\n    price: number | string; // Can be Decimal or number\r\n    total: number | string;\r\n    product: {\r\n        name: string;\r\n        sku?: string | null;\r\n    };\r\n    variant?: {\r\n        sku?: string | null;\r\n        optionValues?: string; // JSON string\r\n    } | null;\r\n}\r\n\r\ninterface Order {\r\n    id: string;\r\n    orderNumber: string;\r\n    createdAt: Date | string;\r\n    status: string;\r\n    subtotal: number | string;\r\n    tax: number | string;\r\n    shipping: number | string;\r\n    total: number | string;\r\n    discountAmount?: number | string;\r\n    items: OrderItem[];\r\n    shippingAddress?: Address | null;\r\n    billingAddress?: Address | null;\r\n    user?: {\r\n        email: string;\r\n        firstName?: string | null;\r\n        lastName?: string | null;\r\n    } | null;\r\n}\r\n\r\n// Helper function to get currency symbol from settings\r\nconst getCurrencySymbol = async (): Promise<string> => {\r\n    try {\r\n        const response = await fetch('/api/settings?category=general');\r\n        if (response.ok) {\r\n            const data = await response.json();\r\n            return data.general_currency_symbol || '$';\r\n        }\r\n    } catch (error) {\r\n        console.error('Error fetching currency symbol:', error);\r\n    }\r\n    return '$';\r\n};\r\n\r\n// Helper function to format currency with symbol from settings\r\nconst formatCurrency = async (amount: number | string, symbol: string): Promise<string> => {\r\n    return formatCurrencyWithSymbol(amount, symbol);\r\n};\r\n\r\n// Helper function to format date\r\nconst formatDate = (date: Date | string): string => {\r\n    const d = typeof date === 'string' ? new Date(date) : date;\r\n    return d.toLocaleDateString('en-US', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n    });\r\n};\r\n\r\n// Helper function to format address\r\nconst formatAddress = (address: Address | null | undefined): string => {\r\n    if (!address) return 'N/A';\r\n\r\n    const lines = [\r\n        `${address.firstName} ${address.lastName}`,\r\n        address.company || '',\r\n        address.address1,\r\n        address.address2 || '',\r\n        `${address.city}, ${address.state || ''} ${address.postalCode}`,\r\n        address.country,\r\n        address.phone || ''\r\n    ].filter(line => line.trim() !== '');\r\n\r\n    return lines.join('\\n');\r\n};\r\n\r\nexport const generateInvoice = async (order: Order) => {\r\n    const doc = new jsPDF();\r\n    const currencySymbol = await getCurrencySymbol();\r\n\r\n    // Header\r\n    doc.setFontSize(24);\r\n    doc.text('INVOICE', 105, 20, { align: 'center' });\r\n\r\n    // Order info\r\n    doc.setFontSize(12);\r\n    doc.text(`Order Number: ${order.orderNumber}`, 20, 40);\r\n    doc.text(`Date: ${formatDate(order.createdAt)}`, 20, 47);\r\n    doc.text(`Status: ${order.status}`, 20, 54);\r\n\r\n    // Customer info\r\n    doc.setFontSize(10);\r\n    doc.text('Bill To:', 20, 70);\r\n    const billingText = formatAddress(order.billingAddress);\r\n    doc.text(billingText, 20, 77);\r\n\r\n    doc.text('Ship To:', 110, 70);\r\n    const shippingText = formatAddress(order.shippingAddress);\r\n    doc.text(shippingText, 110, 77);\r\n\r\n    // Items table\r\n    const tableData = await Promise.all(order.items.map(async item => [\r\n        item.product.name,\r\n        item.product.sku || item.variant?.sku || '-',\r\n        item.quantity.toString(),\r\n        await formatCurrency(item.price, currencySymbol),\r\n        await formatCurrency(item.total, currencySymbol)\r\n    ]));\r\n\r\n    autoTable(doc, {\r\n        startY: 120,\r\n        head: [['Product', 'SKU', 'Qty', 'Price', 'Total']],\r\n        body: tableData,\r\n        theme: 'striped',\r\n        headStyles: { fillColor: [66, 66, 66] }\r\n    });\r\n\r\n    // Totals\r\n    const finalY = (doc as any).lastAutoTable.finalY || 120;\r\n    doc.text(`Subtotal: ${await formatCurrency(order.subtotal, currencySymbol)}`, 150, finalY + 10);\r\n    doc.text(`Tax: ${await formatCurrency(order.tax, currencySymbol)}`, 150, finalY + 17);\r\n    doc.text(`Shipping: ${await formatCurrency(order.shipping, currencySymbol)}`, 150, finalY + 24);\r\n    if (order.discountAmount) {\r\n        doc.text(`Discount: -${await formatCurrency(order.discountAmount, currencySymbol)}`, 150, finalY + 31);\r\n    }\r\n    doc.setFontSize(14);\r\n    doc.text(`Total: ${await formatCurrency(order.total, currencySymbol)}`, 150, finalY + (order.discountAmount ? 41 : 34));\r\n\r\n    // Footer\r\n    doc.setFontSize(10);\r\n    doc.text('Thank you for your business!', 105, 280, { align: 'center' });\r\n\r\n    doc.save(`Invoice-${order.orderNumber}.pdf`);\r\n};\r\n\r\nexport const generatePackingSlip = async (order: Order) => {\r\n    const doc = new jsPDF();\r\n\r\n    // Header\r\n    doc.setFontSize(24);\r\n    doc.text('PACKING SLIP', 105, 20, { align: 'center' });\r\n\r\n    // Order info\r\n    doc.setFontSize(12);\r\n    doc.text(`Order Number: ${order.orderNumber}`, 20, 40);\r\n    doc.text(`Date: ${formatDate(order.createdAt)}`, 20, 47);\r\n\r\n    // Shipping address\r\n    doc.setFontSize(10);\r\n    doc.text('Ship To:', 20, 65);\r\n    const shippingText = formatAddress(order.shippingAddress);\r\n    doc.text(shippingText, 20, 72);\r\n\r\n    // Items table\r\n    const tableData = order.items.map(item => [\r\n        item.product.name,\r\n        item.product.sku || item.variant?.sku || '-',\r\n        item.quantity.toString(),\r\n        '[ ]' // Checkbox for picked items\r\n    ]);\r\n\r\n    autoTable(doc, {\r\n        startY: 110,\r\n        head: [['Product', 'SKU', 'Quantity', 'Picked']],\r\n        body: tableData,\r\n        theme: 'grid',\r\n        headStyles: { fillColor: [66, 66, 66] }\r\n    });\r\n\r\n    // Footer\r\n    doc.setFontSize(10);\r\n    doc.text('Please check contents against this slip.', 105, 280, { align: 'center' });\r\n\r\n    doc.save(`PackingSlip-${order.orderNumber}.pdf`);\r\n};\r\n\r\n// Enhanced invoice generation for premium invoice system\r\nexport const generateInvoicePDF = async (\r\n    invoice: Invoice,\r\n    template?: InvoiceTemplate | null,\r\n    settings?: InvoiceSettings | null\r\n): Promise<Buffer> => {\r\n    const doc = new jsPDF();\r\n    \r\n    // Get settings defaults\r\n    const primaryColor = settings?.primaryColor || '#000000';\r\n    const secondaryColor = settings?.secondaryColor || '#666666';\r\n    const accentColor = settings?.accentColor || '#3182ce';\r\n    const fontFamily = settings?.fontFamily || 'Helvetica';\r\n    const fontSize = settings?.fontSize || 10;\r\n    const currencySymbol = invoice.currencySymbol || settings?.currencySymbol || '$';\r\n    \r\n    // Parse colors\r\n    const parseColor = (color: string): [number, number, number] => {\r\n        const hex = color.replace('#', '');\r\n        const r = parseInt(hex.substring(0, 2), 16);\r\n        const g = parseInt(hex.substring(2, 4), 16);\r\n        const b = parseInt(hex.substring(4, 6), 16);\r\n        return [r, g, b];\r\n    };\r\n    \r\n    const primaryRGB = parseColor(primaryColor);\r\n    const accentRGB = parseColor(accentColor);\r\n    \r\n    // Set font\r\n    doc.setFont(fontFamily);\r\n    doc.setFontSize(fontSize);\r\n    \r\n    let yPos = 20;\r\n    \r\n    // Header with logo\r\n    if (settings?.logoUrl) {\r\n        try {\r\n            // Note: jsPDF doesn't directly support images from URLs in server-side\r\n            // In production, you'd need to fetch and convert the image\r\n            // For now, we'll just add space for the logo\r\n            yPos += 20;\r\n        } catch (error) {\r\n            console.error('Error loading logo:', error);\r\n        }\r\n    }\r\n    \r\n    // Company information\r\n    if (settings?.companyName) {\r\n        doc.setFontSize(18);\r\n        doc.setTextColor(...primaryRGB);\r\n        doc.text(settings.companyName, 20, yPos);\r\n        yPos += 8;\r\n    }\r\n    \r\n    if (settings?.companyAddress) {\r\n        doc.setFontSize(fontSize);\r\n        doc.setTextColor(0, 0, 0);\r\n        const addressLines = settings.companyAddress.split('\\n');\r\n        addressLines.forEach((line: string) => {\r\n            if (line.trim()) {\r\n                doc.text(line, 20, yPos);\r\n                yPos += 5;\r\n            }\r\n        });\r\n    }\r\n    \r\n    if (settings?.companyPhone || settings?.companyEmail || settings?.companyWebsite) {\r\n        yPos += 2;\r\n        if (settings.companyPhone) {\r\n            doc.text(`Phone: ${settings.companyPhone}`, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (settings.companyEmail) {\r\n            doc.text(`Email: ${settings.companyEmail}`, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (settings.companyWebsite) {\r\n            doc.text(`Website: ${settings.companyWebsite}`, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n    }\r\n    \r\n    // Invoice title and number\r\n    yPos = 20;\r\n    doc.setFontSize(24);\r\n    doc.setTextColor(...primaryRGB);\r\n    doc.text('INVOICE', 150, yPos, { align: 'right' });\r\n    \r\n    yPos += 10;\r\n    doc.setFontSize(12);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text(`Invoice #: ${invoice.invoiceNumber}`, 150, yPos, { align: 'right' });\r\n    \r\n    yPos += 6;\r\n    doc.text(`Date: ${formatDate(invoice.invoiceDate)}`, 150, yPos, { align: 'right' });\r\n    \r\n    if (invoice.dueDate) {\r\n        yPos += 6;\r\n        doc.text(`Due Date: ${formatDate(invoice.dueDate)}`, 150, yPos, { align: 'right' });\r\n    }\r\n    \r\n    yPos += 6;\r\n    doc.text(`Status: ${invoice.status}`, 150, yPos, { align: 'right' });\r\n    \r\n    // Customer information\r\n    yPos = Math.max(yPos + 10, 80);\r\n    doc.setFontSize(12);\r\n    doc.setTextColor(...primaryRGB);\r\n    doc.text('Bill To:', 20, yPos);\r\n    \r\n    yPos += 7;\r\n    doc.setFontSize(fontSize);\r\n    doc.setTextColor(0, 0, 0);\r\n    \r\n    if (invoice.customerName) {\r\n        doc.text(invoice.customerName, 20, yPos);\r\n        yPos += 5;\r\n    }\r\n    \r\n    if (invoice.customerCompany) {\r\n        doc.text(invoice.customerCompany, 20, yPos);\r\n        yPos += 5;\r\n    }\r\n    \r\n    if (invoice.customerEmail) {\r\n        doc.text(invoice.customerEmail, 20, yPos);\r\n        yPos += 5;\r\n    }\r\n    \r\n    if (invoice.billingAddress) {\r\n        const address = typeof invoice.billingAddress === 'string' \r\n            ? JSON.parse(invoice.billingAddress) \r\n            : invoice.billingAddress;\r\n        \r\n        if (address.address1) {\r\n            doc.text(address.address1, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (address.address2) {\r\n            doc.text(address.address2, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (address.city || address.state || address.postalCode) {\r\n            const cityState = [\r\n                address.city,\r\n                address.state,\r\n                address.postalCode\r\n            ].filter(Boolean).join(', ');\r\n            doc.text(cityState, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (address.country) {\r\n            doc.text(address.country, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n        if (address.phone) {\r\n            doc.text(`Phone: ${address.phone}`, 20, yPos);\r\n            yPos += 5;\r\n        }\r\n    }\r\n    \r\n    // Items table\r\n    const startY = yPos + 10;\r\n    const tableData = invoice.items?.map(item => [\r\n        item.description || 'Item',\r\n        item.sku || '-',\r\n        item.quantity.toString(),\r\n        formatCurrencyWithSymbol(item.unitPrice, currencySymbol),\r\n        formatCurrencyWithSymbol(item.total, currencySymbol)\r\n    ]) || [];\r\n    \r\n    autoTable(doc, {\r\n        startY,\r\n        head: [['Description', 'SKU', 'Qty', 'Price', 'Total']],\r\n        body: tableData,\r\n        theme: 'striped',\r\n        headStyles: { \r\n            fillColor: primaryRGB,\r\n            textColor: [255, 255, 255],\r\n            fontStyle: 'bold'\r\n        },\r\n        styles: {\r\n            fontSize: fontSize,\r\n            font: fontFamily,\r\n        },\r\n        alternateRowStyles: {\r\n            fillColor: [245, 245, 245]\r\n        }\r\n    });\r\n    \r\n    // Totals\r\n    const finalY = (doc as any).lastAutoTable.finalY || startY;\r\n    let totalsY = finalY + 10;\r\n    \r\n    doc.setFontSize(fontSize);\r\n    doc.setTextColor(0, 0, 0);\r\n    \r\n    // Subtotal\r\n    doc.text('Subtotal:', 150, totalsY, { align: 'right' });\r\n    doc.text(formatCurrencyWithSymbol(invoice.subtotal, currencySymbol), 190, totalsY, { align: 'right' });\r\n    totalsY += 6;\r\n    \r\n    // Tax\r\n    if (invoice.tax > 0) {\r\n        const taxLabel = settings?.taxLabel || 'Tax';\r\n        doc.text(`${taxLabel}:`, 150, totalsY, { align: 'right' });\r\n        doc.text(formatCurrencyWithSymbol(invoice.tax, currencySymbol), 190, totalsY, { align: 'right' });\r\n        totalsY += 6;\r\n    }\r\n    \r\n    // Shipping\r\n    if (invoice.shipping > 0) {\r\n        doc.text('Shipping:', 150, totalsY, { align: 'right' });\r\n        doc.text(formatCurrencyWithSymbol(invoice.shipping, currencySymbol), 190, totalsY, { align: 'right' });\r\n        totalsY += 6;\r\n    }\r\n    \r\n    // Discount\r\n    if (invoice.discount > 0) {\r\n        doc.text('Discount:', 150, totalsY, { align: 'right' });\r\n        doc.text(`-${formatCurrencyWithSymbol(invoice.discount, currencySymbol)}`, 190, totalsY, { align: 'right' });\r\n        totalsY += 6;\r\n    }\r\n    \r\n    // Total\r\n    totalsY += 3;\r\n    doc.setFontSize(14);\r\n    doc.setTextColor(...primaryRGB);\r\n    doc.setFont(fontFamily, 'bold');\r\n    doc.text('Total:', 150, totalsY, { align: 'right' });\r\n    doc.text(formatCurrencyWithSymbol(invoice.total, currencySymbol), 190, totalsY, { align: 'right' });\r\n    \r\n    // Payment information\r\n    if (invoice.amountPaid > 0 || invoice.balanceDue > 0) {\r\n        totalsY += 8;\r\n        doc.setFontSize(fontSize);\r\n        doc.setFont(fontFamily, 'normal');\r\n        doc.setTextColor(0, 0, 0);\r\n        \r\n        if (invoice.amountPaid > 0) {\r\n            doc.text('Amount Paid:', 150, totalsY, { align: 'right' });\r\n            doc.text(formatCurrencyWithSymbol(invoice.amountPaid, currencySymbol), 190, totalsY, { align: 'right' });\r\n            totalsY += 6;\r\n        }\r\n        \r\n        if (invoice.balanceDue > 0) {\r\n            doc.setFont(fontFamily, 'bold');\r\n            doc.setTextColor(...accentRGB);\r\n            doc.text('Balance Due:', 150, totalsY, { align: 'right' });\r\n            doc.text(formatCurrencyWithSymbol(invoice.balanceDue, currencySymbol), 190, totalsY, { align: 'right' });\r\n        }\r\n    }\r\n    \r\n    // Terms and conditions\r\n    if (invoice.termsAndConditions || settings?.defaultTerms) {\r\n        totalsY += 15;\r\n        doc.setFontSize(fontSize - 1);\r\n        doc.setTextColor(0, 0, 0);\r\n        doc.setFont(fontFamily, 'normal');\r\n        \r\n        const terms = invoice.termsAndConditions || settings?.defaultTerms || '';\r\n        const termsLines = doc.splitTextToSize(terms, 170);\r\n        doc.text('Terms & Conditions:', 20, totalsY);\r\n        totalsY += 6;\r\n        doc.text(termsLines, 20, totalsY);\r\n        totalsY += termsLines.length * 5;\r\n    }\r\n    \r\n    // Notes\r\n    if (invoice.notes) {\r\n        totalsY += 5;\r\n        doc.setFontSize(fontSize - 1);\r\n        const notesLines = doc.splitTextToSize(invoice.notes, 170);\r\n        doc.text('Notes:', 20, totalsY);\r\n        totalsY += 6;\r\n        doc.text(notesLines, 20, totalsY);\r\n    }\r\n    \r\n    // Footer\r\n    const pageHeight = doc.internal.pageSize.height;\r\n    const footerY = pageHeight - 20;\r\n    \r\n    if (settings?.footerText && settings?.showFooter) {\r\n        doc.setFontSize(fontSize - 2);\r\n        doc.setTextColor(100, 100, 100);\r\n        const footerLines = doc.splitTextToSize(settings.footerText, 170);\r\n        doc.text(footerLines, 105, footerY, { align: 'center' });\r\n    } else {\r\n        doc.setFontSize(fontSize - 2);\r\n        doc.setTextColor(100, 100, 100);\r\n        doc.text('Thank you for your business!', 105, footerY, { align: 'center' });\r\n    }\r\n    \r\n    // Convert to buffer\r\n    const pdfOutput = doc.output('arraybuffer');\r\n    return Buffer.from(pdfOutput);\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAmDA,uDAAuD;AACvD,MAAM,oBAAoB;IACtB,IAAI;QACA,MAAM,WAAW,MAAM,MAAM;QAC7B,IAAI,SAAS,EAAE,EAAE;YACb,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,OAAO,KAAK,uBAAuB,IAAI;QAC3C;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mCAAmC;IACrD;IACA,OAAO;AACX;AAEA,+DAA+D;AAC/D,MAAM,iBAAiB,OAAO,QAAyB;IACnD,OAAO,IAAA,sJAAwB,EAAC,QAAQ;AAC5C;AAEA,iCAAiC;AACjC,MAAM,aAAa,CAAC;IAChB,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,OAAO,EAAE,kBAAkB,CAAC,SAAS;QACjC,MAAM;QACN,OAAO;QACP,KAAK;IACT;AACJ;AAEA,oCAAoC;AACpC,MAAM,gBAAgB,CAAC;IACnB,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,QAAQ;QACV,GAAG,QAAQ,SAAS,CAAC,CAAC,EAAE,QAAQ,QAAQ,EAAE;QAC1C,QAAQ,OAAO,IAAI;QACnB,QAAQ,QAAQ;QAChB,QAAQ,QAAQ,IAAI;QACpB,GAAG,QAAQ,IAAI,CAAC,EAAE,EAAE,QAAQ,KAAK,IAAI,GAAG,CAAC,EAAE,QAAQ,UAAU,EAAE;QAC/D,QAAQ,OAAO;QACf,QAAQ,KAAK,IAAI;KACpB,CAAC,MAAM,CAAC,CAAA,OAAQ,KAAK,IAAI,OAAO;IAEjC,OAAO,MAAM,IAAI,CAAC;AACtB;AAEO,MAAM,kBAAkB,OAAO;IAClC,MAAM,MAAM,IAAI,kKAAK;IACrB,MAAM,iBAAiB,MAAM;IAE7B,SAAS;IACT,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,WAAW,KAAK,IAAI;QAAE,OAAO;IAAS;IAE/C,aAAa;IACb,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,CAAC,cAAc,EAAE,MAAM,WAAW,EAAE,EAAE,IAAI;IACnD,IAAI,IAAI,CAAC,CAAC,MAAM,EAAE,WAAW,MAAM,SAAS,GAAG,EAAE,IAAI;IACrD,IAAI,IAAI,CAAC,CAAC,QAAQ,EAAE,MAAM,MAAM,EAAE,EAAE,IAAI;IAExC,gBAAgB;IAChB,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,YAAY,IAAI;IACzB,MAAM,cAAc,cAAc,MAAM,cAAc;IACtD,IAAI,IAAI,CAAC,aAAa,IAAI;IAE1B,IAAI,IAAI,CAAC,YAAY,KAAK;IAC1B,MAAM,eAAe,cAAc,MAAM,eAAe;IACxD,IAAI,IAAI,CAAC,cAAc,KAAK;IAE5B,cAAc;IACd,MAAM,YAAY,MAAM,QAAQ,GAAG,CAAC,MAAM,KAAK,CAAC,GAAG,CAAC,OAAM,OAAQ;YAC9D,KAAK,OAAO,CAAC,IAAI;YACjB,KAAK,OAAO,CAAC,GAAG,IAAI,KAAK,OAAO,EAAE,OAAO;YACzC,KAAK,QAAQ,CAAC,QAAQ;YACtB,MAAM,eAAe,KAAK,KAAK,EAAE;YACjC,MAAM,eAAe,KAAK,KAAK,EAAE;SACpC;IAED,IAAA,wLAAS,EAAC,KAAK;QACX,QAAQ;QACR,MAAM;YAAC;gBAAC;gBAAW;gBAAO;gBAAO;gBAAS;aAAQ;SAAC;QACnD,MAAM;QACN,OAAO;QACP,YAAY;YAAE,WAAW;gBAAC;gBAAI;gBAAI;aAAG;QAAC;IAC1C;IAEA,SAAS;IACT,MAAM,SAAS,AAAC,IAAY,aAAa,CAAC,MAAM,IAAI;IACpD,IAAI,IAAI,CAAC,CAAC,UAAU,EAAE,MAAM,eAAe,MAAM,QAAQ,EAAE,iBAAiB,EAAE,KAAK,SAAS;IAC5F,IAAI,IAAI,CAAC,CAAC,KAAK,EAAE,MAAM,eAAe,MAAM,GAAG,EAAE,iBAAiB,EAAE,KAAK,SAAS;IAClF,IAAI,IAAI,CAAC,CAAC,UAAU,EAAE,MAAM,eAAe,MAAM,QAAQ,EAAE,iBAAiB,EAAE,KAAK,SAAS;IAC5F,IAAI,MAAM,cAAc,EAAE;QACtB,IAAI,IAAI,CAAC,CAAC,WAAW,EAAE,MAAM,eAAe,MAAM,cAAc,EAAE,iBAAiB,EAAE,KAAK,SAAS;IACvG;IACA,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,CAAC,OAAO,EAAE,MAAM,eAAe,MAAM,KAAK,EAAE,iBAAiB,EAAE,KAAK,SAAS,CAAC,MAAM,cAAc,GAAG,KAAK,EAAE;IAErH,SAAS;IACT,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,gCAAgC,KAAK,KAAK;QAAE,OAAO;IAAS;IAErE,IAAI,IAAI,CAAC,CAAC,QAAQ,EAAE,MAAM,WAAW,CAAC,IAAI,CAAC;AAC/C;AAEO,MAAM,sBAAsB,OAAO;IACtC,MAAM,MAAM,IAAI,kKAAK;IAErB,SAAS;IACT,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI;QAAE,OAAO;IAAS;IAEpD,aAAa;IACb,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,CAAC,cAAc,EAAE,MAAM,WAAW,EAAE,EAAE,IAAI;IACnD,IAAI,IAAI,CAAC,CAAC,MAAM,EAAE,WAAW,MAAM,SAAS,GAAG,EAAE,IAAI;IAErD,mBAAmB;IACnB,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,YAAY,IAAI;IACzB,MAAM,eAAe,cAAc,MAAM,eAAe;IACxD,IAAI,IAAI,CAAC,cAAc,IAAI;IAE3B,cAAc;IACd,MAAM,YAAY,MAAM,KAAK,CAAC,GAAG,CAAC,CAAA,OAAQ;YACtC,KAAK,OAAO,CAAC,IAAI;YACjB,KAAK,OAAO,CAAC,GAAG,IAAI,KAAK,OAAO,EAAE,OAAO;YACzC,KAAK,QAAQ,CAAC,QAAQ;YACtB,MAAM,4BAA4B;SACrC;IAED,IAAA,wLAAS,EAAC,KAAK;QACX,QAAQ;QACR,MAAM;YAAC;gBAAC;gBAAW;gBAAO;gBAAY;aAAS;SAAC;QAChD,MAAM;QACN,OAAO;QACP,YAAY;YAAE,WAAW;gBAAC;gBAAI;gBAAI;aAAG;QAAC;IAC1C;IAEA,SAAS;IACT,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,4CAA4C,KAAK,KAAK;QAAE,OAAO;IAAS;IAEjF,IAAI,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,WAAW,CAAC,IAAI,CAAC;AACnD;AAGO,MAAM,qBAAqB,OAC9B,SACA,UACA;IAEA,MAAM,MAAM,IAAI,kKAAK;IAErB,wBAAwB;IACxB,MAAM,eAAe,UAAU,gBAAgB;IAC/C,MAAM,iBAAiB,UAAU,kBAAkB;IACnD,MAAM,cAAc,UAAU,eAAe;IAC7C,MAAM,aAAa,UAAU,cAAc;IAC3C,MAAM,WAAW,UAAU,YAAY;IACvC,MAAM,iBAAiB,QAAQ,cAAc,IAAI,UAAU,kBAAkB;IAE7E,eAAe;IACf,MAAM,aAAa,CAAC;QAChB,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK;QAC/B,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,OAAO;YAAC;YAAG;YAAG;SAAE;IACpB;IAEA,MAAM,aAAa,WAAW;IAC9B,MAAM,YAAY,WAAW;IAE7B,WAAW;IACX,IAAI,OAAO,CAAC;IACZ,IAAI,WAAW,CAAC;IAEhB,IAAI,OAAO;IAEX,mBAAmB;IACnB,IAAI,UAAU,SAAS;QACnB,IAAI;YACA,uEAAuE;YACvE,2DAA2D;YAC3D,6CAA6C;YAC7C,QAAQ;QACZ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;QACzC;IACJ;IAEA,sBAAsB;IACtB,IAAI,UAAU,aAAa;QACvB,IAAI,WAAW,CAAC;QAChB,IAAI,YAAY,IAAI;QACpB,IAAI,IAAI,CAAC,SAAS,WAAW,EAAE,IAAI;QACnC,QAAQ;IACZ;IAEA,IAAI,UAAU,gBAAgB;QAC1B,IAAI,WAAW,CAAC;QAChB,IAAI,YAAY,CAAC,GAAG,GAAG;QACvB,MAAM,eAAe,SAAS,cAAc,CAAC,KAAK,CAAC;QACnD,aAAa,OAAO,CAAC,CAAC;YAClB,IAAI,KAAK,IAAI,IAAI;gBACb,IAAI,IAAI,CAAC,MAAM,IAAI;gBACnB,QAAQ;YACZ;QACJ;IACJ;IAEA,IAAI,UAAU,gBAAgB,UAAU,gBAAgB,UAAU,gBAAgB;QAC9E,QAAQ;QACR,IAAI,SAAS,YAAY,EAAE;YACvB,IAAI,IAAI,CAAC,CAAC,OAAO,EAAE,SAAS,YAAY,EAAE,EAAE,IAAI;YAChD,QAAQ;QACZ;QACA,IAAI,SAAS,YAAY,EAAE;YACvB,IAAI,IAAI,CAAC,CAAC,OAAO,EAAE,SAAS,YAAY,EAAE,EAAE,IAAI;YAChD,QAAQ;QACZ;QACA,IAAI,SAAS,cAAc,EAAE;YACzB,IAAI,IAAI,CAAC,CAAC,SAAS,EAAE,SAAS,cAAc,EAAE,EAAE,IAAI;YACpD,QAAQ;QACZ;IACJ;IAEA,2BAA2B;IAC3B,OAAO;IACP,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,IAAI;IACpB,IAAI,IAAI,CAAC,WAAW,KAAK,MAAM;QAAE,OAAO;IAAQ;IAEhD,QAAQ;IACR,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,CAAC,GAAG,GAAG;IACvB,IAAI,IAAI,CAAC,CAAC,WAAW,EAAE,QAAQ,aAAa,EAAE,EAAE,KAAK,MAAM;QAAE,OAAO;IAAQ;IAE5E,QAAQ;IACR,IAAI,IAAI,CAAC,CAAC,MAAM,EAAE,WAAW,QAAQ,WAAW,GAAG,EAAE,KAAK,MAAM;QAAE,OAAO;IAAQ;IAEjF,IAAI,QAAQ,OAAO,EAAE;QACjB,QAAQ;QACR,IAAI,IAAI,CAAC,CAAC,UAAU,EAAE,WAAW,QAAQ,OAAO,GAAG,EAAE,KAAK,MAAM;YAAE,OAAO;QAAQ;IACrF;IAEA,QAAQ;IACR,IAAI,IAAI,CAAC,CAAC,QAAQ,EAAE,QAAQ,MAAM,EAAE,EAAE,KAAK,MAAM;QAAE,OAAO;IAAQ;IAElE,uBAAuB;IACvB,OAAO,KAAK,GAAG,CAAC,OAAO,IAAI;IAC3B,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,IAAI;IACpB,IAAI,IAAI,CAAC,YAAY,IAAI;IAEzB,QAAQ;IACR,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,CAAC,GAAG,GAAG;IAEvB,IAAI,QAAQ,YAAY,EAAE;QACtB,IAAI,IAAI,CAAC,QAAQ,YAAY,EAAE,IAAI;QACnC,QAAQ;IACZ;IAEA,IAAI,QAAQ,eAAe,EAAE;QACzB,IAAI,IAAI,CAAC,QAAQ,eAAe,EAAE,IAAI;QACtC,QAAQ;IACZ;IAEA,IAAI,QAAQ,aAAa,EAAE;QACvB,IAAI,IAAI,CAAC,QAAQ,aAAa,EAAE,IAAI;QACpC,QAAQ;IACZ;IAEA,IAAI,QAAQ,cAAc,EAAE;QACxB,MAAM,UAAU,OAAO,QAAQ,cAAc,KAAK,WAC5C,KAAK,KAAK,CAAC,QAAQ,cAAc,IACjC,QAAQ,cAAc;QAE5B,IAAI,QAAQ,QAAQ,EAAE;YAClB,IAAI,IAAI,CAAC,QAAQ,QAAQ,EAAE,IAAI;YAC/B,QAAQ;QACZ;QACA,IAAI,QAAQ,QAAQ,EAAE;YAClB,IAAI,IAAI,CAAC,QAAQ,QAAQ,EAAE,IAAI;YAC/B,QAAQ;QACZ;QACA,IAAI,QAAQ,IAAI,IAAI,QAAQ,KAAK,IAAI,QAAQ,UAAU,EAAE;YACrD,MAAM,YAAY;gBACd,QAAQ,IAAI;gBACZ,QAAQ,KAAK;gBACb,QAAQ,UAAU;aACrB,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC;YACvB,IAAI,IAAI,CAAC,WAAW,IAAI;YACxB,QAAQ;QACZ;QACA,IAAI,QAAQ,OAAO,EAAE;YACjB,IAAI,IAAI,CAAC,QAAQ,OAAO,EAAE,IAAI;YAC9B,QAAQ;QACZ;QACA,IAAI,QAAQ,KAAK,EAAE;YACf,IAAI,IAAI,CAAC,CAAC,OAAO,EAAE,QAAQ,KAAK,EAAE,EAAE,IAAI;YACxC,QAAQ;QACZ;IACJ;IAEA,cAAc;IACd,MAAM,SAAS,OAAO;IACtB,MAAM,YAAY,QAAQ,KAAK,EAAE,IAAI,CAAA,OAAQ;YACzC,KAAK,WAAW,IAAI;YACpB,KAAK,GAAG,IAAI;YACZ,KAAK,QAAQ,CAAC,QAAQ;YACtB,IAAA,sJAAwB,EAAC,KAAK,SAAS,EAAE;YACzC,IAAA,sJAAwB,EAAC,KAAK,KAAK,EAAE;SACxC,KAAK,EAAE;IAER,IAAA,wLAAS,EAAC,KAAK;QACX;QACA,MAAM;YAAC;gBAAC;gBAAe;gBAAO;gBAAO;gBAAS;aAAQ;SAAC;QACvD,MAAM;QACN,OAAO;QACP,YAAY;YACR,WAAW;YACX,WAAW;gBAAC;gBAAK;gBAAK;aAAI;YAC1B,WAAW;QACf;QACA,QAAQ;YACJ,UAAU;YACV,MAAM;QACV;QACA,oBAAoB;YAChB,WAAW;gBAAC;gBAAK;gBAAK;aAAI;QAC9B;IACJ;IAEA,SAAS;IACT,MAAM,SAAS,AAAC,IAAY,aAAa,CAAC,MAAM,IAAI;IACpD,IAAI,UAAU,SAAS;IAEvB,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,CAAC,GAAG,GAAG;IAEvB,WAAW;IACX,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS;QAAE,OAAO;IAAQ;IACrD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,QAAQ,EAAE,iBAAiB,KAAK,SAAS;QAAE,OAAO;IAAQ;IACpG,WAAW;IAEX,MAAM;IACN,IAAI,QAAQ,GAAG,GAAG,GAAG;QACjB,MAAM,WAAW,UAAU,YAAY;QACvC,IAAI,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC,EAAE,KAAK,SAAS;YAAE,OAAO;QAAQ;QACxD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,GAAG,EAAE,iBAAiB,KAAK,SAAS;YAAE,OAAO;QAAQ;QAC/F,WAAW;IACf;IAEA,WAAW;IACX,IAAI,QAAQ,QAAQ,GAAG,GAAG;QACtB,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS;YAAE,OAAO;QAAQ;QACrD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,QAAQ,EAAE,iBAAiB,KAAK,SAAS;YAAE,OAAO;QAAQ;QACpG,WAAW;IACf;IAEA,WAAW;IACX,IAAI,QAAQ,QAAQ,GAAG,GAAG;QACtB,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS;YAAE,OAAO;QAAQ;QACrD,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,IAAA,sJAAwB,EAAC,QAAQ,QAAQ,EAAE,iBAAiB,EAAE,KAAK,SAAS;YAAE,OAAO;QAAQ;QAC1G,WAAW;IACf;IAEA,QAAQ;IACR,WAAW;IACX,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,IAAI;IACpB,IAAI,OAAO,CAAC,YAAY;IACxB,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS;QAAE,OAAO;IAAQ;IAClD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,KAAK,EAAE,iBAAiB,KAAK,SAAS;QAAE,OAAO;IAAQ;IAEjG,sBAAsB;IACtB,IAAI,QAAQ,UAAU,GAAG,KAAK,QAAQ,UAAU,GAAG,GAAG;QAClD,WAAW;QACX,IAAI,WAAW,CAAC;QAChB,IAAI,OAAO,CAAC,YAAY;QACxB,IAAI,YAAY,CAAC,GAAG,GAAG;QAEvB,IAAI,QAAQ,UAAU,GAAG,GAAG;YACxB,IAAI,IAAI,CAAC,gBAAgB,KAAK,SAAS;gBAAE,OAAO;YAAQ;YACxD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,UAAU,EAAE,iBAAiB,KAAK,SAAS;gBAAE,OAAO;YAAQ;YACtG,WAAW;QACf;QAEA,IAAI,QAAQ,UAAU,GAAG,GAAG;YACxB,IAAI,OAAO,CAAC,YAAY;YACxB,IAAI,YAAY,IAAI;YACpB,IAAI,IAAI,CAAC,gBAAgB,KAAK,SAAS;gBAAE,OAAO;YAAQ;YACxD,IAAI,IAAI,CAAC,IAAA,sJAAwB,EAAC,QAAQ,UAAU,EAAE,iBAAiB,KAAK,SAAS;gBAAE,OAAO;YAAQ;QAC1G;IACJ;IAEA,uBAAuB;IACvB,IAAI,QAAQ,kBAAkB,IAAI,UAAU,cAAc;QACtD,WAAW;QACX,IAAI,WAAW,CAAC,WAAW;QAC3B,IAAI,YAAY,CAAC,GAAG,GAAG;QACvB,IAAI,OAAO,CAAC,YAAY;QAExB,MAAM,QAAQ,QAAQ,kBAAkB,IAAI,UAAU,gBAAgB;QACtE,MAAM,aAAa,IAAI,eAAe,CAAC,OAAO;QAC9C,IAAI,IAAI,CAAC,uBAAuB,IAAI;QACpC,WAAW;QACX,IAAI,IAAI,CAAC,YAAY,IAAI;QACzB,WAAW,WAAW,MAAM,GAAG;IACnC;IAEA,QAAQ;IACR,IAAI,QAAQ,KAAK,EAAE;QACf,WAAW;QACX,IAAI,WAAW,CAAC,WAAW;QAC3B,MAAM,aAAa,IAAI,eAAe,CAAC,QAAQ,KAAK,EAAE;QACtD,IAAI,IAAI,CAAC,UAAU,IAAI;QACvB,WAAW;QACX,IAAI,IAAI,CAAC,YAAY,IAAI;IAC7B;IAEA,SAAS;IACT,MAAM,aAAa,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM;IAC/C,MAAM,UAAU,aAAa;IAE7B,IAAI,UAAU,cAAc,UAAU,YAAY;QAC9C,IAAI,WAAW,CAAC,WAAW;QAC3B,IAAI,YAAY,CAAC,KAAK,KAAK;QAC3B,MAAM,cAAc,IAAI,eAAe,CAAC,SAAS,UAAU,EAAE;QAC7D,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS;YAAE,OAAO;QAAS;IAC1D,OAAO;QACH,IAAI,WAAW,CAAC,WAAW;QAC3B,IAAI,YAAY,CAAC,KAAK,KAAK;QAC3B,IAAI,IAAI,CAAC,gCAAgC,KAAK,SAAS;YAAE,OAAO;QAAS;IAC7E;IAEA,oBAAoB;IACpB,MAAM,YAAY,IAAI,MAAM,CAAC;IAC7B,OAAO,OAAO,IAAI,CAAC;AACvB"}},
    {"offset": {"line": 967, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/app/api/orders/%5Bid%5D/invoice/download/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getServerSession } from 'next-auth';\r\nimport { authOptions } from '@/lib/auth';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { generateInvoicePDF } from '@/lib/invoice-generator';\r\nimport { Invoice } from '@/types/invoice';\r\n\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const session = await getServerSession(authOptions);\r\n        if (!session) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const { id } = await params;\r\n\r\n        // Get order\r\n        const order = await prisma.order.findUnique({\r\n            where: { id },\r\n            include: {\r\n                user: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        email: true,\r\n                    },\r\n                },\r\n                items: {\r\n                    include: {\r\n                        product: {\r\n                            select: {\r\n                                id: true,\r\n                                name: true,\r\n                                sku: true,\r\n                            },\r\n                        },\r\n                        variant: {\r\n                            select: {\r\n                                sku: true,\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n                billingAddress: true,\r\n                shippingAddress: true,\r\n            },\r\n        });\r\n\r\n        if (!order) {\r\n            return NextResponse.json({ error: 'Order not found' }, { status: 404 });\r\n        }\r\n\r\n        // Check permissions\r\n        if (!['ADMIN', 'SUPERADMIN', 'MANAGER'].includes(session.user.role)) {\r\n            if (order.userId !== session.user.id) {\r\n                return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\r\n            }\r\n        }\r\n\r\n        // Get invoice settings\r\n        let settings = await prisma.invoiceSettings.findFirst();\r\n        if (!settings) {\r\n            // Create default settings if they don't exist\r\n            settings = await prisma.invoiceSettings.create({\r\n                data: {\r\n                    invoiceNumberPrefix: 'INV',\r\n                    invoiceNumberFormat: '{{prefix}}-{{number}}',\r\n                    nextInvoiceNumber: 1,\r\n                    defaultDueDays: 30,\r\n                    primaryColor: '#000000',\r\n                    secondaryColor: '#666666',\r\n                    accentColor: '#3182ce',\r\n                    fontFamily: 'Helvetica',\r\n                    fontSize: 10,\r\n                    autoSendOnCreate: false,\r\n                    sendCopyToAdmin: false,\r\n                    taxLabel: 'Tax',\r\n                    showTaxBreakdown: true,\r\n                    showPaymentLink: true,\r\n                    showQRCode: false,\r\n                    enableSignatures: false,\r\n                    multiLanguage: false,\r\n                    defaultLanguage: 'en',\r\n                    showFooter: true,\r\n                },\r\n            });\r\n        }\r\n\r\n        // Convert order to invoice format\r\n        const invoice: Invoice = {\r\n            id: order.id,\r\n            invoiceNumber: order.orderNumber,\r\n            invoiceType: 'STANDARD',\r\n            status: 'DRAFT',\r\n            invoiceDate: order.createdAt,\r\n            dueDate: null,\r\n            sentAt: null,\r\n            viewedAt: null,\r\n            paidAt: null,\r\n            customerId: order.userId || undefined,\r\n            customerEmail: order.user?.email || order.guestEmail || undefined,\r\n            customerName: order.user?.name || \r\n                (order.shippingAddress ? `${order.shippingAddress.firstName} ${order.shippingAddress.lastName}` : undefined),\r\n            customerCompany: order.billingAddress?.company || undefined,\r\n            billingAddress: order.billingAddress ? {\r\n                firstName: order.billingAddress.firstName,\r\n                lastName: order.billingAddress.lastName,\r\n                company: order.billingAddress.company || undefined,\r\n                address1: order.billingAddress.address1,\r\n                address2: order.billingAddress.address2 || undefined,\r\n                city: order.billingAddress.city,\r\n                state: order.billingAddress.state || undefined,\r\n                postalCode: order.billingAddress.postalCode,\r\n                country: order.billingAddress.country,\r\n                phone: order.billingAddress.phone || undefined,\r\n            } : undefined,\r\n            shippingAddress: order.shippingAddress ? {\r\n                firstName: order.shippingAddress.firstName,\r\n                lastName: order.shippingAddress.lastName,\r\n                company: order.shippingAddress.company || undefined,\r\n                address1: order.shippingAddress.address1,\r\n                address2: order.shippingAddress.address2 || undefined,\r\n                city: order.shippingAddress.city,\r\n                state: order.shippingAddress.state || undefined,\r\n                postalCode: order.shippingAddress.postalCode,\r\n                country: order.shippingAddress.country,\r\n                phone: order.shippingAddress.phone || undefined,\r\n            } : undefined,\r\n            orderId: order.id,\r\n            subtotal: Number(order.subtotal),\r\n            tax: Number(order.tax),\r\n            taxRate: null,\r\n            shipping: Number(order.shipping),\r\n            discount: Number(order.discountAmount || 0),\r\n            discountType: undefined,\r\n            total: Number(order.total),\r\n            amountPaid: 0,\r\n            balanceDue: Number(order.total),\r\n            currency: settings.currency || 'USD',\r\n            currencySymbol: settings.currencySymbol || '$',\r\n            templateId: null,\r\n            customFields: null,\r\n            termsAndConditions: settings.defaultTerms || undefined,\r\n            notes: settings.defaultNotes || order.notes || undefined,\r\n            footerText: settings.footerText || undefined,\r\n            paymentMethod: undefined,\r\n            paymentInstructions: undefined,\r\n            paymentLink: undefined,\r\n            isRecurring: false,\r\n            recurringId: undefined,\r\n            qrCodeUrl: undefined,\r\n            signatureUrl: undefined,\r\n            signedAt: undefined,\r\n            signedBy: undefined,\r\n            createdById: undefined,\r\n            updatedById: undefined,\r\n            createdAt: order.createdAt,\r\n            updatedAt: order.updatedAt,\r\n            items: order.items.map((item, index) => ({\r\n                id: item.id,\r\n                productId: item.productId,\r\n                variantId: item.variantId || undefined,\r\n                description: item.product.name,\r\n                sku: item.product.sku || item.variant?.sku || undefined,\r\n                quantity: item.quantity,\r\n                unitPrice: Number(item.price),\r\n                taxRate: undefined,\r\n                discount: 0,\r\n                total: Number(item.total),\r\n                customFields: undefined,\r\n                position: index,\r\n            })),\r\n            payments: [],\r\n            history: [],\r\n        };\r\n\r\n        // Generate PDF using the enhanced generator with settings\r\n        const pdfBuffer = await generateInvoicePDF(invoice, null, settings);\r\n\r\n        return new NextResponse(pdfBuffer, {\r\n            headers: {\r\n                'Content-Type': 'application/pdf',\r\n                'Content-Disposition': `attachment; filename=\"Invoice-${order.orderNumber}.pdf\"`,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error('Error generating invoice from order:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to generate invoice' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}