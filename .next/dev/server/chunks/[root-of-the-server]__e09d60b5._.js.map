{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport { PrismaAdapter } from '@next-auth/prisma-adapter';\nimport { prisma } from './prisma';\nimport { compare } from 'bcryptjs';\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  session: {\n    strategy: 'jwt',\n  },\n  pages: {\n    signIn: '/admin/login',\n  },\n  providers: [\n    CredentialsProvider({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !user.password) {\n          return null;\n        }\n\n        const isPasswordValid = await compare(\n          credentials.password,\n          user.password\n        );\n\n        if (!isPasswordValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          role: user.role,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user, trigger }) {\n      if (user) {\n        return {\n          ...token,\n          id: user.id,\n          role: user.role,\n        };\n      }\n\n      // Validate session hasn't been invalidated\n      if (token.id) {\n        const dbUser = await prisma.user.findUnique({\n          where: { id: token.id as string },\n          select: { sessionsInvalidatedAt: true, role: true },\n        });\n\n        if (dbUser) {\n          // Check if JWT was issued before sessions were invalidated\n          if (dbUser.sessionsInvalidatedAt) {\n            const tokenIssuedAt = token.iat ? token.iat * 1000 : 0; // Convert to milliseconds\n            const invalidatedAt = new Date(dbUser.sessionsInvalidatedAt).getTime();\n\n            if (tokenIssuedAt < invalidatedAt) {\n              // Session has been invalidated - return null to force re-login\n              return null as any;\n            }\n          }\n\n          // Update role in token if it changed\n          token.role = dbUser.role;\n        } else {\n          // User no longer exists\n          return null as any;\n        }\n      }\n\n      return token;\n    },\n    async session({ session, token }) {\n      // If token is null, session is invalid\n      if (!token) {\n        return null as any;\n      }\n\n      return {\n        ...session,\n        user: {\n          ...session.user,\n          id: token.id,\n          role: token.role,\n        },\n      };\n    },\n  },\n};\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,IAAA,uLAAa,EAAC,gIAAM;IAC7B,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,IAAA,8IAAO,EACnC,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE;YAChC,IAAI,MAAM;gBACR,OAAO;oBACL,GAAG,KAAK;oBACR,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;gBACjB;YACF;YAEA,2CAA2C;YAC3C,IAAI,MAAM,EAAE,EAAE;gBACZ,MAAM,SAAS,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAC1C,OAAO;wBAAE,IAAI,MAAM,EAAE;oBAAW;oBAChC,QAAQ;wBAAE,uBAAuB;wBAAM,MAAM;oBAAK;gBACpD;gBAEA,IAAI,QAAQ;oBACV,2DAA2D;oBAC3D,IAAI,OAAO,qBAAqB,EAAE;wBAChC,MAAM,gBAAgB,MAAM,GAAG,GAAG,MAAM,GAAG,GAAG,OAAO,GAAG,0BAA0B;wBAClF,MAAM,gBAAgB,IAAI,KAAK,OAAO,qBAAqB,EAAE,OAAO;wBAEpE,IAAI,gBAAgB,eAAe;4BACjC,+DAA+D;4BAC/D,OAAO;wBACT;oBACF;oBAEA,qCAAqC;oBACrC,MAAM,IAAI,GAAG,OAAO,IAAI;gBAC1B,OAAO;oBACL,wBAAwB;oBACxB,OAAO;gBACT;YACF;YAEA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,uCAAuC;YACvC,IAAI,CAAC,OAAO;gBACV,OAAO;YACT;YAEA,OAAO;gBACL,GAAG,OAAO;gBACV,MAAM;oBACJ,GAAG,QAAQ,IAAI;oBACf,IAAI,MAAM,EAAE;oBACZ,MAAM,MAAM,IAAI;gBAClB;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/permissions.ts"],"sourcesContent":["import { UserRole } from '@prisma/client'\n\nexport type PermissionResource =\n  | 'PRODUCT'\n  | 'ORDER'\n  | 'CUSTOMER'\n  | 'CATEGORY'\n  | 'REVIEW'\n  | 'DISCOUNT'\n  | 'SETTINGS'\n  | 'ANALYTICS'\n  | 'FEATURES'\n  | 'ADMIN_USER'\n  | 'STOCK_ALERT'\n  | 'NEWSLETTER'\n  | 'REFUND'\n  | 'INVENTORY'\n  | 'SUPPLIER'\n  | 'PURCHASE_ORDER'\n\nexport type PermissionAction =\n  | 'VIEW'\n  | 'CREATE'\n  | 'UPDATE'\n  | 'DELETE'\n  | 'MANAGE'\n\n/**\n * Default permissions for each role\n * Format: \"RESOURCE:ACTION\"\n */\nconst ROLE_PERMISSIONS: Record<string, string[]> = {\n  SUPERADMIN: [\n    // Has ALL permissions including feature management\n    'PRODUCT:MANAGE',\n    'ORDER:MANAGE',\n    'CUSTOMER:MANAGE',\n    'CATEGORY:MANAGE',\n    'REVIEW:MANAGE',\n    'DISCOUNT:MANAGE',\n    'SETTINGS:MANAGE',\n    'ANALYTICS:MANAGE',\n    'FEATURES:MANAGE',\n    'ADMIN_USER:MANAGE',\n    'STOCK_ALERT:MANAGE',\n    'NEWSLETTER:MANAGE',\n    'REFUND:MANAGE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:MANAGE',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  ADMIN: [\n    // Has all permissions EXCEPT feature management\n    'PRODUCT:MANAGE',\n    'ORDER:MANAGE',\n    'CUSTOMER:MANAGE',\n    'CATEGORY:MANAGE',\n    'REVIEW:MANAGE',\n    'DISCOUNT:MANAGE',\n    'SETTINGS:MANAGE',\n    'ANALYTICS:MANAGE',\n    'ADMIN_USER:MANAGE',\n    'STOCK_ALERT:MANAGE',\n    'NEWSLETTER:MANAGE',\n    'REFUND:MANAGE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:MANAGE',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  MANAGER: [\n    // Can manage orders, view/update customers and products\n    'ORDER:MANAGE',\n    'CUSTOMER:VIEW',\n    'CUSTOMER:UPDATE',\n    'PRODUCT:VIEW',\n    'PRODUCT:UPDATE',\n    'PRODUCT:CREATE',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'REVIEW:UPDATE',\n    'STOCK_ALERT:VIEW',\n    'REFUND:VIEW',\n    'REFUND:UPDATE',\n    'INVENTORY:MANAGE',\n    'SUPPLIER:VIEW',\n    'PURCHASE_ORDER:MANAGE',\n  ],\n\n  EDITOR: [\n    // Can edit products and categories\n    'PRODUCT:VIEW',\n    'PRODUCT:CREATE',\n    'PRODUCT:UPDATE',\n    'CATEGORY:MANAGE',\n    'REVIEW:VIEW',\n    'STOCK_ALERT:VIEW',\n  ],\n\n  SUPPORT: [\n    // View-only access to orders and customers\n    'ORDER:VIEW',\n    'CUSTOMER:VIEW',\n    'PRODUCT:VIEW',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'REFUND:VIEW',\n  ],\n\n  VIEWER: [\n    // Read-only access to all resources\n    'PRODUCT:VIEW',\n    'ORDER:VIEW',\n    'CUSTOMER:VIEW',\n    'CATEGORY:VIEW',\n    'REVIEW:VIEW',\n    'DISCOUNT:VIEW',\n    'ANALYTICS:VIEW',\n    'STOCK_ALERT:VIEW',\n    'NEWSLETTER:VIEW',\n    'REFUND:VIEW',\n  ],\n\n  CUSTOMER: [],\n}\n\n/**\n * Get default permissions for a given role\n */\nexport function getDefaultPermissionsForRole(role: UserRole | string): string[] {\n  return ROLE_PERMISSIONS[role] || []\n}\n\n/**\n * Check if a role has a specific permission\n * MANAGE permission grants all sub-permissions (VIEW, CREATE, UPDATE, DELETE)\n */\nexport function hasPermission(\n  role: UserRole | string | undefined,\n  resource: PermissionResource | string,\n  action: PermissionAction | string\n): boolean {\n  if (!role) return false\n  \n  // SUPERADMIN has all permissions\n  if (role === 'SUPERADMIN') return true\n\n  const permissions = getDefaultPermissionsForRole(role)\n  \n  // Check exact permission\n  const exactPermission = `${resource}:${action}`\n  if (permissions.includes(exactPermission)) return true\n\n  // If resource has MANAGE permission, it includes all actions\n  const managePermission = `${resource}:MANAGE`\n  if (permissions.includes(managePermission)) {\n    // MANAGE grants VIEW, CREATE, UPDATE, DELETE\n    if (['VIEW', 'CREATE', 'UPDATE', 'DELETE'].includes(action)) {\n      return true\n    }\n  }\n\n  return false\n}\n\n/**\n * Helper functions for common permission checks\n */\nexport function canViewResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'VIEW')\n}\n\nexport function canCreateResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'CREATE')\n}\n\nexport function canUpdateResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'UPDATE')\n}\n\nexport function canDeleteResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'DELETE')\n}\n\nexport function canManageResource(role: UserRole | string, resource: PermissionResource): boolean {\n  return hasPermission(role, resource, 'MANAGE')\n}\n\n/**\n * Check if user is an admin (any admin role)\n */\nexport function isAdmin(role: UserRole | string | undefined): boolean {\n  if (!role) return false\n  return ['ADMIN', 'SUPERADMIN', 'MANAGER', 'EDITOR', 'SUPPORT', 'VIEWER'].includes(role)\n}\n\n/**\n * Check if user is a super admin\n */\nexport function isSuperAdmin(role: UserRole | string | undefined): boolean {\n  return role === 'SUPERADMIN'\n}\n\n/**\n * Get user's effective permissions (for display purposes)\n */\nexport function getUserPermissions(role: UserRole | string): {\n  resource: string\n  actions: string[]\n}[] {\n  const permissions = getDefaultPermissionsForRole(role)\n  const grouped: Record<string, Set<string>> = {}\n\n  permissions.forEach(permission => {\n    const [resource, action] = permission.split(':')\n    if (!grouped[resource]) {\n      grouped[resource] = new Set()\n    }\n    \n    if (action === 'MANAGE') {\n      // MANAGE implies all actions\n      grouped[resource].add('VIEW')\n      grouped[resource].add('CREATE')\n      grouped[resource].add('UPDATE')\n      grouped[resource].add('DELETE')\n      grouped[resource].add('MANAGE')\n    } else {\n      grouped[resource].add(action)\n    }\n  })\n\n  return Object.entries(grouped).map(([resource, actions]) => ({\n    resource,\n    actions: Array.from(actions).sort(),\n  }))\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/app/api/admin/inventory/reports/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { getServerSession } from 'next-auth/next'\r\nimport { authOptions } from '@/lib/auth'\r\nimport { prisma } from '@/lib/prisma'\r\nimport { hasPermission } from '@/lib/permissions'\r\nimport { Decimal } from '@prisma/client/runtime/library'\r\n\r\n/**\r\n * GET /api/admin/inventory/reports\r\n * Generate inventory reports\r\n * Query params: type (current-stock, low-stock, valuation, movement)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Check authentication\r\n    const session = await getServerSession(authOptions)\r\n    if (!session?.user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Check permissions\r\n    if (!hasPermission(session.user.role, 'INVENTORY', 'VIEW') ||\r\n        !hasPermission(session.user.role, 'ANALYTICS', 'VIEW')) {\r\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 })\r\n    }\r\n\r\n    // Parse query parameters\r\n    const searchParams = request.nextUrl.searchParams\r\n    const reportType = searchParams.get('type') || 'current-stock'\r\n    const startDate = searchParams.get('startDate')\r\n    const endDate = searchParams.get('endDate')\r\n    const categoryId = searchParams.get('categoryId')\r\n\r\n    let reportData: any = {}\r\n\r\n    switch (reportType) {\r\n      case 'current-stock': {\r\n        // Current Stock Report\r\n        const where: any = {}\r\n        if (categoryId) {\r\n          where.categoryId = categoryId\r\n        }\r\n\r\n        const products = await prisma.product.findMany({\r\n          where,\r\n          include: {\r\n            category: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n            variants: {\r\n              select: {\r\n                id: true,\r\n                sku: true,\r\n                stock: true,\r\n                price: true,\r\n                optionValues: true,\r\n              },\r\n            },\r\n            stockAlert: true,\r\n          },\r\n          orderBy: { name: 'asc' },\r\n        })\r\n\r\n        const summary = {\r\n          totalProducts: products.length,\r\n          totalStock: products.reduce((sum, p) => sum + p.stock, 0),\r\n          totalVariants: products.reduce((sum, p) => sum + p.variants.length, 0),\r\n          totalVariantStock: products.reduce(\r\n            (sum, p) => sum + p.variants.reduce((vs, v) => vs + v.stock, 0),\r\n            0\r\n          ),\r\n          productsInStock: products.filter(p => p.stock > 0).length,\r\n          productsOutOfStock: products.filter(p => p.stock === 0).length,\r\n          productsLowStock: products.filter(\r\n            p => p.stockAlert && p.stock <= p.stockAlert.threshold\r\n          ).length,\r\n        }\r\n\r\n        reportData = {\r\n          type: 'current-stock',\r\n          summary,\r\n          products: products.map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            sku: p.sku,\r\n            stock: p.stock,\r\n            category: p.category?.name,\r\n            variants: p.variants,\r\n            hasLowStock: p.stockAlert ? p.stock <= p.stockAlert.threshold : false,\r\n            threshold: p.stockAlert?.threshold,\r\n          })),\r\n        }\r\n        break\r\n      }\r\n\r\n      case 'low-stock': {\r\n        // Low Stock Report\r\n        const defaultThreshold = 10\r\n\r\n        const productsWithAlerts = await prisma.product.findMany({\r\n          where: {\r\n            stockAlert: { isNot: null },\r\n          },\r\n          include: {\r\n            stockAlert: true,\r\n            category: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n            variants: {\r\n              select: {\r\n                id: true,\r\n                sku: true,\r\n                stock: true,\r\n                optionValues: true,\r\n              },\r\n            },\r\n          },\r\n        })\r\n\r\n        const lowStockProducts = productsWithAlerts.filter(\r\n          p => p.stock <= (p.stockAlert?.threshold || defaultThreshold)\r\n        )\r\n\r\n        const productsWithoutAlerts = await prisma.product.findMany({\r\n          where: {\r\n            stockAlert: null,\r\n            stock: { lte: defaultThreshold },\r\n          },\r\n          include: {\r\n            stockAlert: true,\r\n            category: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n          },\r\n        })\r\n\r\n        const allLowStock = [...lowStockProducts, ...productsWithoutAlerts]\r\n          .sort((a, b) => a.stock - b.stock)\r\n\r\n        reportData = {\r\n          type: 'low-stock',\r\n          summary: {\r\n            totalLowStock: allLowStock.length,\r\n            criticalStock: allLowStock.filter(p => p.stock === 0).length,\r\n            needsReorder: allLowStock.filter(p => p.stock > 0).length,\r\n          },\r\n          products: allLowStock.map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            sku: p.sku,\r\n            stock: p.stock,\r\n            threshold: p.stockAlert?.threshold || defaultThreshold,\r\n            belowBy: (p.stockAlert?.threshold || defaultThreshold) - p.stock,\r\n            category: p.category?.name,\r\n          })),\r\n        }\r\n        break\r\n      }\r\n\r\n      case 'valuation': {\r\n        // Inventory Valuation Report\r\n        const products = await prisma.product.findMany({\r\n          include: {\r\n            category: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n            variants: {\r\n              select: {\r\n                stock: true,\r\n                price: true,\r\n              },\r\n            },\r\n          },\r\n        })\r\n\r\n        let totalValue = 0\r\n        const valuationData = products.map(p => {\r\n          const productValue = p.stock * p.price.toNumber()\r\n          const variantsValue = p.variants.reduce(\r\n            (sum, v) => sum + (v.stock * (v.price?.toNumber() || p.price.toNumber())),\r\n            0\r\n          )\r\n          const totalProductValue = productValue + variantsValue\r\n          totalValue += totalProductValue\r\n\r\n          return {\r\n            id: p.id,\r\n            name: p.name,\r\n            sku: p.sku,\r\n            stock: p.stock,\r\n            price: p.price.toNumber(),\r\n            productValue,\r\n            variantsValue,\r\n            totalValue: totalProductValue,\r\n            category: p.category?.name,\r\n          }\r\n        })\r\n\r\n        reportData = {\r\n          type: 'valuation',\r\n          summary: {\r\n            totalProducts: products.length,\r\n            totalInventoryValue: totalValue,\r\n            averageProductValue: totalValue / (products.length || 1),\r\n          },\r\n          products: valuationData.sort((a, b) => b.totalValue - a.totalValue),\r\n        }\r\n        break\r\n      }\r\n\r\n      case 'movement': {\r\n        // Stock Movement Report\r\n        const where: any = {}\r\n\r\n        if (startDate || endDate) {\r\n          where.createdAt = {}\r\n          if (startDate) {\r\n            where.createdAt.gte = new Date(startDate)\r\n          }\r\n          if (endDate) {\r\n            where.createdAt.lte = new Date(endDate)\r\n          }\r\n        } else {\r\n          // Default to last 30 days\r\n          where.createdAt = {\r\n            gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\r\n          }\r\n        }\r\n\r\n        const stockHistory = await prisma.stockHistory.findMany({\r\n          where,\r\n          include: {\r\n            product: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n                sku: true,\r\n              },\r\n            },\r\n            supplier: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n            user: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n                email: true,\r\n              },\r\n            },\r\n          },\r\n          orderBy: { createdAt: 'desc' },\r\n        })\r\n\r\n        // Calculate summary by change type\r\n        const byChangeType: Record<string, { count: number; totalChange: number }> = {}\r\n        stockHistory.forEach(h => {\r\n          if (!byChangeType[h.changeType]) {\r\n            byChangeType[h.changeType] = { count: 0, totalChange: 0 }\r\n          }\r\n          byChangeType[h.changeType].count++\r\n          byChangeType[h.changeType].totalChange += h.quantityChange\r\n        })\r\n\r\n        // Group by date for chart data\r\n        const byDate: Record<string, { in: number; out: number }> = {}\r\n        stockHistory.forEach(h => {\r\n          const date = h.createdAt.toISOString().split('T')[0]\r\n          if (!byDate[date]) {\r\n            byDate[date] = { in: 0, out: 0 }\r\n          }\r\n          if (h.quantityChange > 0) {\r\n            byDate[date].in += h.quantityChange\r\n          } else {\r\n            byDate[date].out += Math.abs(h.quantityChange)\r\n          }\r\n        })\r\n\r\n        reportData = {\r\n          type: 'movement',\r\n          period: {\r\n            startDate: startDate || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n            endDate: endDate || new Date().toISOString(),\r\n          },\r\n          summary: {\r\n            totalMovements: stockHistory.length,\r\n            byChangeType,\r\n            totalStockIn: stockHistory\r\n              .filter(h => h.quantityChange > 0)\r\n              .reduce((sum, h) => sum + h.quantityChange, 0),\r\n            totalStockOut: Math.abs(\r\n              stockHistory\r\n                .filter(h => h.quantityChange < 0)\r\n                .reduce((sum, h) => sum + h.quantityChange, 0)\r\n            ),\r\n          },\r\n          chartData: Object.entries(byDate)\r\n            .map(([date, data]) => ({ date, ...data }))\r\n            .sort((a, b) => a.date.localeCompare(b.date)),\r\n          movements: stockHistory.slice(0, 100), // Limit to 100 most recent\r\n        }\r\n        break\r\n      }\r\n\r\n      case 'dashboard': {\r\n        // Dashboard Report - Aggregate data for the main inventory dashboard\r\n        const defaultThreshold = 10\r\n\r\n        // Get all products with comprehensive data\r\n        const products = await prisma.product.findMany({\r\n          include: {\r\n            category: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n            variants: {\r\n              select: {\r\n                id: true,\r\n                stock: true,\r\n                price: true,\r\n              },\r\n            },\r\n            stockAlert: true,\r\n          },\r\n        })\r\n\r\n        // Calculate summary statistics\r\n        const totalProducts = products.length\r\n        const totalStock = products.reduce((sum, p) => sum + p.stock, 0)\r\n\r\n        const lowStockProducts = products.filter(\r\n          p => p.stockAlert ? p.stock <= p.stockAlert.threshold : p.stock <= defaultThreshold\r\n        )\r\n        const lowStockCount = lowStockProducts.length\r\n\r\n        const outOfStockCount = products.filter(p => p.stock === 0).length\r\n\r\n        // Calculate total inventory value\r\n        const inventoryValue = products.reduce((sum, p) => {\r\n          const productValue = p.stock * p.price.toNumber()\r\n          const variantsValue = p.variants.reduce(\r\n            (vSum, v) => vSum + (v.stock * (v.price?.toNumber() || p.price.toNumber())),\r\n            0\r\n          )\r\n          return sum + productValue + variantsValue\r\n        }, 0)\r\n\r\n        // Get recent stock changes (last 10)\r\n        const recentChanges = await prisma.stockHistory.findMany({\r\n          take: 10,\r\n          orderBy: { createdAt: 'desc' },\r\n          include: {\r\n            product: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n                sku: true,\r\n              },\r\n            },\r\n            user: {\r\n              select: {\r\n                id: true,\r\n                name: true,\r\n              },\r\n            },\r\n          },\r\n        })\r\n\r\n        // Get stock trend data (last 30 days)\r\n        const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\r\n        const stockMovements = await prisma.stockHistory.findMany({\r\n          where: {\r\n            createdAt: { gte: thirtyDaysAgo },\r\n          },\r\n          select: {\r\n            createdAt: true,\r\n            quantityChange: true,\r\n          },\r\n          orderBy: { createdAt: 'asc' },\r\n        })\r\n\r\n        // Group by date for trend chart\r\n        const trendByDate: Record<string, { in: number; out: number }> = {}\r\n        stockMovements.forEach(h => {\r\n          const date = h.createdAt.toISOString().split('T')[0]\r\n          if (!trendByDate[date]) {\r\n            trendByDate[date] = { in: 0, out: 0 }\r\n          }\r\n          if (h.quantityChange > 0) {\r\n            trendByDate[date].in += h.quantityChange\r\n          } else {\r\n            trendByDate[date].out += Math.abs(h.quantityChange)\r\n          }\r\n        })\r\n\r\n        // Stock by category\r\n        const stockByCategory: Record<string, { products: number; totalStock: number; value: number }> = {}\r\n        products.forEach(p => {\r\n          const categoryName = p.category?.name || 'Uncategorized'\r\n          if (!stockByCategory[categoryName]) {\r\n            stockByCategory[categoryName] = { products: 0, totalStock: 0, value: 0 }\r\n          }\r\n          stockByCategory[categoryName].products++\r\n          stockByCategory[categoryName].totalStock += p.stock\r\n          stockByCategory[categoryName].value += p.stock * p.price.toNumber()\r\n        })\r\n\r\n        reportData = {\r\n          type: 'dashboard',\r\n          summary: {\r\n            totalProducts,\r\n            totalStock,\r\n            lowStockCount,\r\n            outOfStockCount,\r\n            inventoryValue: Math.round(inventoryValue * 100) / 100,\r\n          },\r\n          recentChanges: recentChanges.map(change => ({\r\n            id: change.id,\r\n            productId: change.productId,\r\n            productName: change.product.name,\r\n            productSku: change.product.sku,\r\n            changeType: change.changeType,\r\n            quantityBefore: change.quantityBefore,\r\n            quantityAfter: change.quantityAfter,\r\n            quantityChange: change.quantityChange,\r\n            createdAt: change.createdAt,\r\n            createdBy: change.user?.name || 'System',\r\n          })),\r\n          lowStockAlerts: lowStockProducts.slice(0, 10).map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            sku: p.sku,\r\n            slug: p.slug,\r\n            stock: p.stock,\r\n            stockAlert: p.stockAlert ? {\r\n              threshold: p.stockAlert.threshold,\r\n            } : null,\r\n            category: p.category?.name,\r\n          })),\r\n          stockTrend: Object.entries(trendByDate)\r\n            .map(([date, data]) => ({ date, ...data }))\r\n            .sort((a, b) => a.date.localeCompare(b.date)),\r\n          stockByCategory: Object.entries(stockByCategory)\r\n            .map(([category, data]) => ({ category, ...data }))\r\n            .sort((a, b) => b.totalStock - a.totalStock),\r\n        }\r\n        break\r\n      }\r\n\r\n      default: {\r\n        return NextResponse.json({ error: 'Invalid report type' }, { status: 400 })\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      report: reportData,\r\n      generatedAt: new Date().toISOString(),\r\n      generatedBy: {\r\n        id: session.user.id,\r\n        name: session.user.name,\r\n        email: session.user.email,\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error('Error generating inventory report:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}