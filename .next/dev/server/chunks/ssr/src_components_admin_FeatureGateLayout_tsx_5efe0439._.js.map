{"version":3,"sources":null,"sections":[{"offset":{"line":5,"column":0},"url":null,"map":{"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/components/admin/FeatureGateLayout.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { useSession } from 'next-auth/react'\r\nimport { useRouter } from 'next/navigation'\r\nimport toast from 'react-hot-toast'\r\n\r\ninterface FeatureGateLayoutProps {\r\n  featureName: string\r\n  featureDisplayName: string\r\n  children: React.ReactNode\r\n}\r\n\r\nexport default function FeatureGateLayout({\r\n  featureName,\r\n  featureDisplayName,\r\n  children,\r\n}: FeatureGateLayoutProps) {\r\n  const { data: session, status } = useSession()\r\n  const router = useRouter()\r\n  const [featureEnabled, setFeatureEnabled] = useState<boolean | null>(null)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    const checkFeatureAccess = async () => {\r\n      try {\r\n        // Check if feature is enabled\r\n        const response = await fetch('/api/features/enabled')\r\n        if (response.ok) {\r\n          const data = await response.json()\r\n          const isEnabled = data.features?.includes(featureName)\r\n          setFeatureEnabled(isEnabled)\r\n\r\n          if (!isEnabled) {\r\n            // Feature is disabled - redirect to admin dashboard\r\n            toast.error(`${featureDisplayName} feature is not available`)\r\n            router.push('/admin')\r\n            return\r\n          }\r\n        } else {\r\n          // If API fails, assume feature is disabled\r\n          setFeatureEnabled(false)\r\n          router.push('/admin')\r\n          return\r\n        }\r\n      } catch (error) {\r\n        console.error('Error checking feature access:', error)\r\n        setFeatureEnabled(false)\r\n        toast.error('Unable to verify feature access')\r\n        router.push('/admin')\r\n      } finally {\r\n        setIsLoading(false)\r\n      }\r\n    }\r\n\r\n    if (status !== 'loading' && session) {\r\n      checkFeatureAccess()\r\n    }\r\n  }, [status, session, router, featureName, featureDisplayName])\r\n\r\n  // Show loading state while checking\r\n  if (status === 'loading' || isLoading || featureEnabled === null) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // If feature is disabled, show nothing (will redirect)\r\n  if (!featureEnabled) {\r\n    return null\r\n  }\r\n\r\n  // Feature is enabled - render children\r\n  return <>{children}</>\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAae,SAAS,kBAAkB,EACxC,WAAW,EACX,kBAAkB,EAClB,QAAQ,EACe;IACvB,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,4JAAU;IAC5C,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAiB;IACrE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,IAAA,kNAAS,EAAC;QACR,MAAM,qBAAqB;YACzB,IAAI;gBACF,8BAA8B;gBAC9B,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,MAAM,YAAY,KAAK,QAAQ,EAAE,SAAS;oBAC1C,kBAAkB;oBAElB,IAAI,CAAC,WAAW;wBACd,oDAAoD;wBACpD,kKAAK,CAAC,KAAK,CAAC,GAAG,mBAAmB,yBAAyB,CAAC;wBAC5D,OAAO,IAAI,CAAC;wBACZ;oBACF;gBACF,OAAO;oBACL,2CAA2C;oBAC3C,kBAAkB;oBAClB,OAAO,IAAI,CAAC;oBACZ;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,kCAAkC;gBAChD,kBAAkB;gBAClB,kKAAK,CAAC,KAAK,CAAC;gBACZ,OAAO,IAAI,CAAC;YACd,SAAU;gBACR,aAAa;YACf;QACF;QAEA,IAAI,WAAW,aAAa,SAAS;YACnC;QACF;IACF,GAAG;QAAC;QAAQ;QAAS;QAAQ;QAAa;KAAmB;IAE7D,oCAAoC;IACpC,IAAI,WAAW,aAAa,aAAa,mBAAmB,MAAM;QAChE,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAI1C;IAEA,uDAAuD;IACvD,IAAI,CAAC,gBAAgB;QACnB,OAAO;IACT;IAEA,uCAAuC;IACvC,qBAAO;kBAAG;;AACZ"}}],"debugId":"a459ccc9-893b-55bb-8fa8-e1abd6aae69a"}