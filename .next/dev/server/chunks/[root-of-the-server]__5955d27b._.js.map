{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/i18n.ts"],"sourcesContent":["import { getRequestConfig } from 'next-intl/server';\nimport { notFound } from 'next/navigation';\n\n// Supported locales - can be managed from admin\nexport const locales = ['en', 'fr'] as const;\nexport type Locale = (typeof locales)[number];\nexport const defaultLocale: Locale = 'en';\n\nexport default getRequestConfig(async ({ requestLocale }) => {\n  let locale = await requestLocale;\n\n  // Validate that the incoming `locale` parameter is valid\n  if (!locale || !locales.includes(locale as Locale)) {\n    locale = defaultLocale;\n  }\n\n  try {\n    // Try to load translations from the messages directory (admin managed)\n    const messages = (await import(`../messages/${locale}.json`)).default;\n    return {\n      locale: locale as string,\n      messages\n    };\n  } catch (error) {\n    // If no translation file exists, fall back to English\n    console.warn(`Translation file for ${locale} not found, using English`);\n    const messages = (await import(`../messages/en.json`)).default;\n    return {\n      locale: locale as string,\n      messages\n    };\n  }\n});\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAIO,MAAM,UAAU;IAAC;IAAM;CAAK;AAE5B,MAAM,gBAAwB;uCAEtB,IAAA,8QAAgB,EAAC,OAAO,EAAE,aAAa,EAAE;IACtD,IAAI,SAAS,MAAM;IAEnB,yDAAyD;IACzD,IAAI,CAAC,UAAU,CAAC,QAAQ,QAAQ,CAAC,SAAmB;QAClD,SAAS;IACX;IAEA,IAAI;QACF,uEAAuE;QACvE,MAAM,WAAW,CAAC;;;;;;;;;kBAAa,CAAC,YAAY,EAAE,OAAO,KAAK,CAAC,CAAC,EAAE,OAAO;QACrE,OAAO;YACL,QAAQ;YACR;QACF;IACF,EAAE,OAAO,OAAO;QACd,sDAAsD;QACtD,QAAQ,IAAI,CAAC,CAAC,qBAAqB,EAAE,OAAO,yBAAyB,CAAC;QACtE,MAAM,WAAW,CAAC,gFAAmC,EAAE,OAAO;QAC9D,OAAO;YACL,QAAQ;YACR;QACF;IACF;AACF"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/lib/features.ts"],"sourcesContent":["import { prisma } from './prisma'\n\n/**\n * Check if a feature is enabled\n */\nexport async function isFeatureEnabled(featureName: string): Promise<boolean> {\n  try {\n    const feature = await prisma.featureFlag.findUnique({\n      where: { name: featureName },\n    })\n    return feature?.enabled ?? false\n  } catch (error) {\n    console.error(`Error checking feature flag ${featureName}:`, error)\n    return false\n  }\n}\n\n/**\n * Get all enabled features\n */\nexport async function getEnabledFeatures(): Promise<string[]> {\n  try {\n    const features = await prisma.featureFlag.findMany({\n      where: { enabled: true },\n      select: { name: true },\n    })\n    return features.map(f => f.name)\n  } catch (error) {\n    console.error('Error getting enabled features:', error)\n    return []\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAKO,eAAe,iBAAiB,WAAmB;IACxD,IAAI;QACF,MAAM,UAAU,MAAM,8HAAM,CAAC,WAAW,CAAC,UAAU,CAAC;YAClD,OAAO;gBAAE,MAAM;YAAY;QAC7B;QACA,OAAO,SAAS,WAAW;IAC7B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,YAAY,CAAC,CAAC,EAAE;QAC7D,OAAO;IACT;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,8HAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YACjD,OAAO;gBAAE,SAAS;YAAK;YACvB,QAAQ;gBAAE,MAAM;YAAK;QACvB;QACA,OAAO,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;IACjC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/laragon/www/claude/ecommerce-platform/src/proxy.ts"],"sourcesContent":["import createMiddleware from 'next-intl/middleware';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { locales, defaultLocale } from './i18n';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { isFeatureEnabled } from '@/lib/features';\r\n\r\n// Create next-intl middleware\r\nconst intlMiddleware = createMiddleware({\r\n  locales,\r\n  defaultLocale,\r\n  // Don't prefix default locale (en)\r\n  localePrefix: 'as-needed'\r\n});\r\n\r\nasync function handleUrlRedirects(request: NextRequest) {\r\n  const path = request.nextUrl.pathname;\r\n\r\n  // Skip for static files, API routes, and admin routes\r\n  if (\r\n    path.startsWith('/_next') ||\r\n    path.startsWith('/api') ||\r\n    path.startsWith('/admin') ||\r\n    path.includes('.') // Skip files with extensions\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    // Check for active redirects\r\n    const redirect = await prisma.urlRedirect.findFirst({\r\n      where: {\r\n        fromPath: path,\r\n        isActive: true,\r\n      },\r\n    });\r\n\r\n    if (redirect) {\r\n      // Update hit count\r\n      await prisma.urlRedirect.update({\r\n        where: { id: redirect.id },\r\n        data: {\r\n          hitCount: { increment: 1 },\r\n          lastHitAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Determine status code\r\n      const statusCode = redirect.type === 'PERMANENT_301' ? 301 : 302;\r\n\r\n      // Perform redirect\r\n      return NextResponse.redirect(\r\n        new URL(redirect.toPath, request.url),\r\n        statusCode\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in redirect middleware:', error);\r\n    // Continue to the next middleware/handler if there's an error\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport async function proxy(request: NextRequest) {\r\n  const pathname = request.nextUrl.pathname;\r\n\r\n  // Skip middleware for static files, API routes, admin routes, and auth routes\r\n  if (\r\n    pathname.startsWith('/_next') ||\r\n    pathname.startsWith('/api') ||\r\n    pathname.startsWith('/admin') ||\r\n    pathname.startsWith('/auth') ||\r\n    pathname.includes('.') // Skip files with extensions\r\n  ) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Check if storefront is enabled\r\n  try {\r\n    const storefrontEnabled = await isFeatureEnabled('storefront_enabled');\r\n    if (!storefrontEnabled) {\r\n      // Redirect to admin login if storefront is disabled\r\n      return NextResponse.redirect(new URL('/admin/login', request.url));\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking storefront feature:', error);\r\n    // If there's an error, allow the request to continue (fail open)\r\n  }\r\n\r\n  // First, handle URL redirects from database\r\n  const redirectResponse = await handleUrlRedirects(request);\r\n  if (redirectResponse && redirectResponse.status >= 300 && redirectResponse.status < 400) {\r\n    return redirectResponse;\r\n  }\r\n\r\n  // Then, handle locale routing with next-intl\r\n  return intlMiddleware(request);\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - api (API routes)\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - admin (admin routes)\r\n     * - auth (auth routes)\r\n     */\r\n    '/((?!api|_next/static|_next/image|favicon.ico|admin|auth).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,8BAA8B;AAC9B,MAAM,iBAAiB,IAAA,iMAAgB,EAAC;IACtC,SAAA,sHAAO;IACP,eAAA,4HAAa;IACb,mCAAmC;IACnC,cAAc;AAChB;AAEA,eAAe,mBAAmB,OAAoB;IACpD,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IAErC,sDAAsD;IACtD,IACE,KAAK,UAAU,CAAC,aAChB,KAAK,UAAU,CAAC,WAChB,KAAK,UAAU,CAAC,aAChB,KAAK,QAAQ,CAAC,KAAK,6BAA6B;MAChD;QACA,OAAO;IACT;IAEA,IAAI;QACF,6BAA6B;QAC7B,MAAM,WAAW,MAAM,8HAAM,CAAC,WAAW,CAAC,SAAS,CAAC;YAClD,OAAO;gBACL,UAAU;gBACV,UAAU;YACZ;QACF;QAEA,IAAI,UAAU;YACZ,mBAAmB;YACnB,MAAM,8HAAM,CAAC,WAAW,CAAC,MAAM,CAAC;gBAC9B,OAAO;oBAAE,IAAI,SAAS,EAAE;gBAAC;gBACzB,MAAM;oBACJ,UAAU;wBAAE,WAAW;oBAAE;oBACzB,WAAW,IAAI;gBACjB;YACF;YAEA,wBAAwB;YACxB,MAAM,aAAa,SAAS,IAAI,KAAK,kBAAkB,MAAM;YAE7D,mBAAmB;YACnB,OAAO,8IAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI,SAAS,MAAM,EAAE,QAAQ,GAAG,GACpC;QAEJ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;IAC/C,8DAA8D;IAChE;IAEA,OAAO;AACT;AAEO,eAAe,MAAM,OAAoB;IAC9C,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,8EAA8E;IAC9E,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,YACpB,SAAS,QAAQ,CAAC,KAAK,6BAA6B;MACpD;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,iCAAiC;IACjC,IAAI;QACF,MAAM,oBAAoB,MAAM,IAAA,0IAAgB,EAAC;QACjD,IAAI,CAAC,mBAAmB;YACtB,oDAAoD;YACpD,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;IACpD,iEAAiE;IACnE;IAEA,4CAA4C;IAC5C,MAAM,mBAAmB,MAAM,mBAAmB;IAClD,IAAI,oBAAoB,iBAAiB,MAAM,IAAI,OAAO,iBAAiB,MAAM,GAAG,KAAK;QACvF,OAAO;IACT;IAEA,6CAA6C;IAC7C,OAAO,eAAe;AACxB;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;;KAQC,GACD;KACD;AACH"}}]
}