(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,142204,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(217255),r=e.i(110075),l=e.i(496305),n=e.i(519455),i=e.i(755146),o=e.i(799676),c=e.i(159070),d=e.i(284614),u=e.i(975157);let m=[{value:"DINE_IN",label:"Dine In"},{value:"TAKE_AWAY",label:"Take Away"},{value:"DELIVERY",label:"Deliver"}];function h({locationName:e}){let{data:s}=(0,a.useSession)(),h=(0,r.useAppDispatch)(),x=(0,r.useAppSelector)(e=>e.pos.orderType),p=(0,r.useAppSelector)(e=>e.pos.locationId);return(0,t.jsxs)("header",{className:"h-20 border-b bg-background flex items-center justify-between px-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.Package2,{className:"h-7 w-7 text-primary"}),(0,t.jsx)("span",{className:"font-bold text-xl",children:"POS Terminal"})]}),(0,t.jsx)("div",{className:"flex items-center gap-1 ml-4",children:m.map(e=>(0,t.jsx)(n.Button,{variant:x===e.value?"default":"outline",size:"lg",onClick:()=>h((0,l.setOrderType)(e.value)),className:(0,u.cn)("h-12 px-6 text-base font-semibold rounded-lg",x===e.value&&"shadow-md"),children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[p&&(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Location"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:e||`ID: ${p.slice(0,8)}...`})]}),(0,t.jsxs)(i.DropdownMenu,{children:[(0,t.jsx)(i.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"ghost",className:"flex items-center gap-3 h-12 px-3",children:[(0,t.jsxs)(o.Avatar,{className:"h-10 w-10",children:[(0,t.jsx)(o.AvatarImage,{src:s?.user?.image||""}),(0,t.jsx)(o.AvatarFallback,{children:s?.user?.name?.charAt(0)||(0,t.jsx)(d.User,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s?.user?.name||"Admin"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Cashier"})]})]})}),(0,t.jsxs)(i.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,t.jsx)(i.DropdownMenuLabel,{children:"My Account"}),(0,t.jsx)(i.DropdownMenuSeparator,{}),(0,t.jsx)(i.DropdownMenuItem,{children:"Settings"}),(0,t.jsx)(i.DropdownMenuItem,{children:"Logout"})]})]})]})]})}var x=e.i(618566),p=e.i(694351),f=e.i(150965),g=e.i(217923),j=e.i(239616),v=e.i(367240),N=e.i(292270);let y=[{icon:p.Home,label:"Home",path:"/admin/pos"},{icon:f.ShoppingBag,label:"Orders",path:"/admin/pos/orders"},{icon:g.BarChart3,label:"Reports",path:"/admin/pos/reports"},{icon:j.Settings,label:"Settings",path:"/admin/pos/settings"}];function b(){let e=(0,x.useRouter)(),r=(0,x.usePathname)(),[l,i]=(0,s.useState)(r);return(0,t.jsxs)("aside",{className:"w-16 border-r bg-background flex flex-col items-center py-4 gap-2",children:[y.map(s=>{let a=s.icon,r=l===s.path;return(0,t.jsx)(n.Button,{variant:r?"secondary":"ghost",size:"icon",className:(0,u.cn)("h-12 w-12 rounded-lg",r&&"bg-primary text-primary-foreground"),onClick:()=>{var t;i(t=s.path),e.push(t)},title:s.label,children:(0,t.jsx)(a,{className:"h-5 w-5"})},s.path)}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-lg",onClick:()=>window.location.reload(),title:"Refresh",children:(0,t.jsx)(v.RotateCcw,{className:"h-5 w-5"})}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-lg",onClick:()=>{(0,a.signOut)({callbackUrl:"/admin/login"})},title:"Logout",children:(0,t.jsx)(N.LogOut,{className:"h-5 w-5"})})]})}var w=e.i(283599),C=e.i(515288),k=e.i(487486),S=e.i(373375),A=e.i(463059),D=e.i(595468),E=e.i(503116);let I=async e=>{let t=await fetch(e);if(!t.ok)throw Error("An error occurred while fetching the data.");return t.json()};function P(){let[e,a]=(0,s.useState)(0),{data:r,error:l,isLoading:i,mutate:o}=(0,w.default)("/api/pos/orders?status=active",I,{refreshInterval:3e3,onError:e=>{console.error("Error fetching POS orders:",e)}}),c=Array.isArray(r)?r:[];if((0,s.useEffect)(()=>{let e=setInterval(()=>{o()},3e3);return()=>clearInterval(e)},[o]),i)return(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Sales Analytic"}),(0,t.jsx)("div",{className:"flex gap-4",children:[1,2,3].map(e=>(0,t.jsx)(C.Card,{className:"w-64 animate-pulse",children:(0,t.jsx)(C.CardContent,{className:"p-4",children:(0,t.jsx)("div",{className:"h-20 bg-muted rounded"})})},e))})]});let d=c||[],u=Math.ceil(d.length/3),m=3*e,h=d.slice(m,m+3);return(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold",children:["Sales Analytic ",d.length>0&&`(${d.length})`]}),u>1&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>a(e=>Math.max(0,e-1)),disabled:0===e,children:(0,t.jsx)(S.ChevronLeft,{className:"h-4 w-4"})}),(0,t.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>a(e=>Math.min(u-1,e+1)),disabled:e>=u-1,children:(0,t.jsx)(A.ChevronRight,{className:"h-4 w-4"})})]})]}),(0,t.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2",children:h.length>0?h.map(e=>(0,t.jsxs)(C.Card,{className:"min-w-[240px] flex-shrink-0",children:[(0,t.jsx)(C.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(C.CardTitle,{className:"text-sm font-medium",children:e.orderNumber||`#${e.id.slice(-6)}`}),(0,t.jsxs)(k.Badge,{variant:"READY"===e.status||"DELIVERED"===e.status?"default":"secondary",className:"text-xs",children:["READY"===e.status||"DELIVERED"===e.status?(0,t.jsx)(D.CheckCircle2,{className:"h-3 w-3 mr-1"}):(0,t.jsx)(E.Clock,{className:"h-3 w-3 mr-1"}),"READY"===e.status||"DELIVERED"===e.status?"Ready to serve":"In Progress"]})]})}),(0,t.jsxs)(C.CardContent,{children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-3",children:[e.itemCount," Items"]}),(0,t.jsx)(n.Button,{size:"sm",variant:"READY"===e.status||"DELIVERED"===e.status?"default":"outline",className:"w-full",children:"READY"===e.status||"DELIVERED"===e.status?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Ready to serve"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Clock,{className:"h-4 w-4 mr-2"}),"In Progress"]})})]})]},e.id)):(0,t.jsx)(C.Card,{className:"w-full",children:(0,t.jsx)(C.CardContent,{className:"p-6 text-center text-muted-foreground",children:"No active orders"})})})]})}var T=e.i(759684),O=e.i(431343),L=e.i(727612),F=e.i(705766),R=e.i(401851),B=e.i(776639);function q(){let e=(0,r.useAppSelector)(e=>e.pos.locationId),[a,l]=(0,s.useState)([]),[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1);(0,s.useEffect)(()=>{h();let e=setInterval(h,5e3);return()=>clearInterval(e)},[e]);let h=async()=>{o(!0);try{let t=new URLSearchParams;e&&t.append("locationId",e);let s=await fetch(`/api/pos/orders/held?${t.toString()}`);if(s.ok){let e=await s.json();l(e.orders||[])}}catch(e){console.error("Error fetching held orders:",e)}finally{o(!1)}},x=async e=>{try{(await fetch(`/api/pos/orders/${e.id}/resume`,{method:"POST"})).ok?(F.default.success("Order resumed"),h(),m(!1),d(null)):F.default.error("Failed to resume order")}catch(e){console.error("Error resuming order:",e),F.default.error("An error occurred")}},p=async e=>{if(confirm("Are you sure you want to delete this held order?"))try{(await fetch(`/api/pos/orders/${e}`,{method:"DELETE"})).ok?(F.default.success("Order deleted"),h()):F.default.error("Failed to delete order")}catch(e){console.error("Error deleting order:",e),F.default.error("An error occurred")}};return 0!==a.length||i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-900 rounded-lg",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.Clock,{className:"h-4 w-4 text-orange-600"}),(0,t.jsxs)("h3",{className:"font-semibold text-sm",children:["Held Orders (",a.length,")"]})]})}),(0,t.jsx)(T.ScrollArea,{className:"max-h-[200px]",children:(0,t.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background rounded border hover:bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-mono font-semibold truncate",children:e.orderNumber}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["$",e.total.toFixed(2)," • ",(0,R.format)(new Date(e.createdAt),"HH:mm")]}),e.customer&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.customer.name||e.customer.email})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{d(e),m(!0)},title:"Resume order",children:(0,t.jsx)(O.Play,{className:"h-4 w-4"})}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>p(e.id),title:"Delete order",children:(0,t.jsx)(L.Trash2,{className:"h-4 w-4"})})]})]},e.id))})})]}),(0,t.jsx)(B.Dialog,{open:u,onOpenChange:m,children:(0,t.jsxs)(B.DialogContent,{children:[(0,t.jsxs)(B.DialogHeader,{children:[(0,t.jsx)(B.DialogTitle,{children:"Resume Held Order"}),(0,t.jsx)(B.DialogDescription,{children:"This will restore the order to active status. You can then complete the payment."})]}),c&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Order:"}),(0,t.jsx)("span",{className:"font-semibold",children:c.orderNumber})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["$",c.total.toFixed(2)]})]}),c.customer&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Customer:"}),(0,t.jsx)("span",{className:"font-semibold",children:c.customer.name||c.customer.email})]})]}),(0,t.jsxs)(B.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:()=>c&&x(c),children:"Resume Order"})]})]})})]}):null}var H=e.i(299023),M=e.i(107233),z=e.i(643531),$=e.i(657688),K=e.i(455225),U=e.i(28928);function Y({product:e}){let s=(0,r.useAppDispatch)(),a=(0,r.useAppSelector)(e=>e.pos.cart),{format:i}=(0,K.useCurrency)(),o="string"==typeof e.price?parseFloat(e.price):e.price,c=e.images?.[0]?.url||U.PLACEHOLDER_PRODUCT_IMAGE,d=a.find(t=>t.productId===e.id&&!t.variantId),m=d?.quantity||0,h=()=>{e.stock<=0||(0===m?s((0,l.addToPosCart)({id:`${e.id}-${Date.now()}`,productId:e.id,name:e.name,price:o,quantity:1,image:c})):s((0,l.updatePosCartQuantity)({id:d.id,quantity:m+1})))},x=e.stock<=0;return(0,t.jsxs)("div",{className:(0,u.cn)("border-2 rounded-xl overflow-hidden bg-card hover:shadow-lg transition-all cursor-pointer",m>0&&"ring-2 ring-primary border-primary",x&&"opacity-60"),children:[(0,t.jsxs)("div",{className:"relative aspect-square bg-muted cursor-pointer",onClick:e=>{e.stopPropagation(),x||h()},children:[(0,t.jsx)($.default,{src:c,alt:e.name,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",onError:e=>{let t=e.currentTarget;t.onerror=null,t.src=U.PLACEHOLDER_PRODUCT_IMAGE},unoptimized:c?.startsWith("data:")||!1}),x&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white font-bold text-lg",children:"Out of Stock"})}),m>0&&(0,t.jsx)("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground rounded-full h-10 w-10 flex items-center justify-center font-bold text-lg shadow-lg",children:m})]}),(0,t.jsxs)("div",{className:"p-5",children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2 line-clamp-2 min-h-[3rem]",children:e.name}),(0,t.jsx)("p",{className:"text-2xl font-bold mb-4 text-primary",children:i(o)}),m>0?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"icon",className:"h-12 w-12 text-lg font-bold",onClick:e=>{e.stopPropagation(),d&&m>1?s((0,l.updatePosCartQuantity)({id:d.id,quantity:m-1})):d&&s((0,l.removeFromPosCart)(d.id))},disabled:x,children:(0,t.jsx)(H.Minus,{className:"h-5 w-5"})}),(0,t.jsx)("div",{className:"flex-1 text-center",children:(0,t.jsx)("span",{className:"text-2xl font-bold",children:m})}),(0,t.jsx)(n.Button,{variant:"outline",size:"icon",className:"h-12 w-12 text-lg font-bold",onClick:e=>{e.stopPropagation(),h()},disabled:x||e.stock<=m,children:(0,t.jsx)(M.Plus,{className:"h-5 w-5"})})]}),(0,t.jsxs)(n.Button,{variant:"default",size:"lg",className:"w-full h-12 text-base font-semibold",disabled:x,onClick:e=>{e.stopPropagation(),h()},children:[(0,t.jsx)(z.Check,{className:"h-5 w-5 mr-2"}),"In Cart"]})]}):(0,t.jsxs)(n.Button,{variant:"default",size:"lg",className:"w-full h-12 text-base font-semibold",onClick:e=>{e.stopPropagation(),h()},disabled:x,children:[(0,t.jsx)(M.Plus,{className:"h-5 w-5 mr-2"}),"Add Item"]})]})]})}var _=e.i(793479),G=e.i(677572),Q=e.i(555436),V=e.i(687130);let J=e=>fetch(e).then(e=>e.json());function W(){let[e,a]=(0,s.useState)(""),[r,l]=(0,s.useState)(null),[o,c]=(0,s.useState)([]),{data:d,error:u,isLoading:m}=(0,w.default)(`/api/pos/products?${r?`categoryId=${r}`:""}${e?`&search=${e}`:""}`,J);(0,s.useEffect)(()=>{fetch("/api/categories").then(e=>e.json()).then(e=>{c([{id:"all",name:"All Menu"},...e||[]])}).catch(console.error)},[]);let h=d?.filter(t=>{if(!e)return!0;let s=e.toLowerCase();return t.name.toLowerCase().includes(s)||t.description?.toLowerCase().includes(s)})||[];return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold",children:["Menu Items ",d&&`(${d.length})`]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(Q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(_.Input,{placeholder:"Search products...",value:e,onChange:e=>a(e.target.value),className:"pl-10 w-64"})]}),(0,t.jsxs)(i.DropdownMenu,{children:[(0,t.jsx)(i.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"outline",size:"icon",children:(0,t.jsx)(V.Filter,{className:"h-4 w-4"})})}),(0,t.jsxs)(i.DropdownMenuContent,{children:[(0,t.jsx)(i.DropdownMenuItem,{onClick:()=>l(null),children:"All Categories"}),o.slice(1).map(e=>(0,t.jsx)(i.DropdownMenuItem,{onClick:()=>l(e.id),children:e.name},e.id))]})]})]})]}),o.length>0&&(0,t.jsx)(G.Tabs,{value:r||"all",onValueChange:e=>l("all"===e?null:e),className:"mb-4",children:(0,t.jsx)(G.TabsList,{className:"grid w-full grid-cols-6",children:o.slice(0,6).map(e=>(0,t.jsx)(G.TabsTrigger,{value:"all"===e.id?"all":e.id,children:e.name},e.id))})}),m?(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[1,2,3,4,5,6,7,8].map(e=>(0,t.jsxs)("div",{className:"border rounded-lg animate-pulse",children:[(0,t.jsx)("div",{className:"aspect-square bg-muted"}),(0,t.jsxs)("div",{className:"p-4 space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,t.jsx)("div",{className:"h-4 bg-muted rounded w-1/2"})]})]},e))}):u?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Error loading products"}):0===h.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No products found"}):(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:h.map(e=>(0,t.jsx)(Y,{product:e},e.id))})]})}var X=e.i(110204),Z=e.i(398361),ee=e.i(212426);function et({total:e,onPaymentSelect:a,defaultMethod:r="CASH"}){let[l,i]=(0,s.useState)(r),[o,c]=(0,s.useState)(""),[d,m]=(0,s.useState)(""),h=e=>{i("CASH"),c(e.toString()),a("CASH",e)},x=()=>{let t=parseFloat(d);t>=e&&(i("CASH"),c(d),a("CASH",t))},p=parseFloat(o)||0,f=p-e;return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(X.Label,{className:"text-xs text-muted-foreground mb-1.5 block",children:"Quick Cash"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-1.5",children:[(0,t.jsxs)(n.Button,{type:"button",variant:"CASH"===l&&"50"===o?"default":"outline",className:(0,u.cn)("h-11 text-sm font-semibold","CASH"===l&&"50"===o&&"bg-green-600 hover:bg-green-700"),onClick:()=>h(50),children:[(0,t.jsx)(ee.DollarSign,{className:"h-4 w-4 mr-1"}),"$50"]}),(0,t.jsxs)(n.Button,{type:"button",variant:"CASH"===l&&"100"===o?"default":"outline",className:(0,u.cn)("h-11 text-sm font-semibold","CASH"===l&&"100"===o&&"bg-green-600 hover:bg-green-700"),onClick:()=>h(100),children:[(0,t.jsx)(ee.DollarSign,{className:"h-4 w-4 mr-1"}),"$100"]}),(0,t.jsx)(n.Button,{type:"button",variant:"CASH"===l&&o===e.toString()?"default":"outline",className:(0,u.cn)("h-11 text-sm font-semibold","CASH"===l&&o===e.toString()&&"bg-blue-600 hover:bg-blue-700"),onClick:()=>{i("CASH"),c(e.toString()),a("CASH",e)},children:"Exact"})]})]}),"CASH"===l&&(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(X.Label,{className:"text-xs text-muted-foreground",children:"Custom Amount"}),(0,t.jsxs)("div",{className:"flex gap-1.5",children:[(0,t.jsx)(_.Input,{type:"number",placeholder:"Enter amount",value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&x()},className:"h-10 text-sm"}),(0,t.jsx)(n.Button,{type:"button",variant:"outline",className:"h-10 px-3",onClick:x,disabled:!d||parseFloat(d)<e,children:"Apply"})]}),p>0&&(0,t.jsxs)("div",{className:"p-2 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs mb-0.5",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Received:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["$",p.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-base font-bold",children:[(0,t.jsx)("span",{children:"Change:"}),(0,t.jsxs)("span",{className:(0,u.cn)(f>=0?"text-green-600":"text-red-600"),children:["$",f>=0?f.toFixed(2):"0.00"]})]})]})]})]})}var es=e.i(37727),ea=e.i(751975),er=e.i(624895),er=er;function el({subtotal:e,onDiscountApply:a,appliedDiscount:r,className:l}){let[i,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),[m,h]=(0,s.useState)(""),[x,p]=(0,s.useState)("PERCENTAGE"),f=async()=>{if(!i.trim())return void F.default.error("Please enter a discount code");d(!0);try{let t=await fetch("/api/pos/discounts/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i.trim(),subtotal:e})});if(t.ok){let e=await t.json();a({code:e.code,type:e.type,amount:parseFloat(e.discountAmount)}),F.default.success("Discount applied"),o("")}else{let e=await t.json();F.default.error(e.error||"Invalid discount code")}}catch(e){console.error("Error validating discount:",e),F.default.error("Failed to validate discount")}finally{d(!1)}};return(0,t.jsxs)("div",{className:(0,u.cn)("space-y-2",l),children:[(0,t.jsx)(X.Label,{className:"text-xs font-semibold",children:"Discount"}),r?(0,t.jsx)("div",{className:"p-2 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-900 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ea.Tag,{className:"h-4 w-4 text-green-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-green-800 dark:text-green-200",children:r.code}),(0,t.jsx)("p",{className:"text-xs text-green-600 dark:text-green-400",children:"PERCENTAGE"===r.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(er.default,{className:"h-3 w-3 inline"}),(r.amount/e*100).toFixed(0),"% off"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee.DollarSign,{className:"h-3 w-3 inline"}),r.amount.toFixed(2)," off"]})})]})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 text-green-600 hover:text-green-700",onClick:()=>{a(null),o(""),h(""),F.default.success("Discount removed")},children:(0,t.jsx)(es.X,{className:"h-4 w-4"})})]})}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-1.5",children:[(0,t.jsx)(_.Input,{placeholder:"Enter discount code",value:i,onChange:e=>o(e.target.value.toUpperCase()),onKeyDown:e=>{"Enter"===e.key&&f()},className:"h-10 text-sm flex-1"}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",className:"h-10 px-3",onClick:f,disabled:!i.trim()||c,children:c?"...":"Apply"})]}),(0,t.jsxs)("div",{className:"flex gap-1.5",children:[(0,t.jsx)(_.Input,{type:"number",placeholder:"Amount",value:m,onChange:e=>h(e.target.value),className:"h-10 text-sm flex-1"}),(0,t.jsxs)("select",{value:x,onChange:e=>p(e.target.value),className:"h-10 px-2 text-sm border rounded-md bg-background",children:[(0,t.jsx)("option",{value:"PERCENTAGE",children:"%"}),(0,t.jsx)("option",{value:"FIXED_AMOUNT",children:"$"})]}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",className:"h-10 px-3",onClick:()=>{let t=parseFloat(m);if(isNaN(t)||t<=0)return void F.default.error("Please enter a valid discount amount");let s=0;if("PERCENTAGE"===x){if(t>100)return void F.default.error("Percentage cannot exceed 100%");s=e*t/100}else{if(t>e)return void F.default.error("Discount cannot exceed subtotal");s=t}a({code:`MANUAL-${x}`,type:x,amount:s}),F.default.success("Manual discount applied"),h("")},disabled:!m||0>=parseFloat(m),children:"Apply"})]})]})]})}var en=e.i(356909);function ei(){let e=(0,r.useAppDispatch)(),a=(0,r.useAppSelector)(e=>e.pos.cart),i=(0,r.useAppSelector)(e=>e.pos.orderType),o=(0,r.useAppSelector)(e=>e.pos.locationId),c=(0,r.useAppSelector)(e=>e.pos.cashierId),{format:d}=(0,K.useCurrency)(),[m]=(0,s.useState)("CASH"),[h,x]=(0,s.useState)(null),[p,g]=(0,s.useState)(!1),[j,v]=(0,s.useState)(`#${Date.now().toString().slice(-6)}`),[N,y]=(0,s.useState)(null),[b,w]=(0,s.useState)(""),[C,k]=(0,s.useState)(null),S=a.reduce((e,t)=>e+t.price*t.quantity,0),A=.1*S,D=C?C.amount:0,E=S+A-D,I=h&&h>=E?h-E:0,P=(t,s)=>{s<=0?e((0,l.removeFromPosCart)(t)):e((0,l.updatePosCartQuantity)({id:t,quantity:s}))};(0,s.useEffect)(()=>{a.length>0&&E>0&&!h&&x(E)},[a.length,E]),(0,s.useEffect)(()=>{let e=e=>{"Enter"===e.key&&a.length>0&&!p&&(e.preventDefault(),R())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a.length,p,m,h,E]);let O=async()=>{if(0===a.length)return void F.default.error("Cart is empty");if(!o||!c)return void F.default.error("Location and cashier must be set");g(!0);try{let t=await fetch("/api/pos/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderType:i,locationId:o,cashierId:c,customerId:N?.id||null,items:a.map(e=>({productId:e.productId,variantId:e.variantId,quantity:e.quantity,price:e.price})),subtotal:S,tax:A,discount:D,discountCode:C?.code||null,discountType:C?.type||null,total:E,paymentMethod:"CASH",notes:b||null})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to create POS order")}let s=await t.json();if(!(await fetch(`/api/pos/orders/${s.id}/hold`,{method:"POST"})).ok)throw Error("Failed to hold order");F.default.success("Order held successfully"),e((0,l.clearPosCart)()),x(null),y(null),w(""),k(null),v(`#${Date.now().toString().slice(-6)}`)}catch(e){console.error("Error holding order:",e),F.default.error("Failed to hold order")}finally{g(!1)}},R=async()=>{if(0===a.length)return void F.default.error("Cart is empty");if(!o||!c)return void F.default.error("Location and cashier must be set");let t="CASH";if(!h||h<E)return void F.default.error("Cash amount must be at least the total amount");g(!0);try{let s=await fetch("/api/pos/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderType:i,locationId:o,cashierId:c,customerId:N?.id||null,items:a.map(e=>({productId:e.productId,variantId:e.variantId,quantity:e.quantity,price:e.price})),subtotal:S,tax:A,discount:D,discountCode:C?.code||null,discountType:C?.type||null,total:E,paymentMethod:t,paymentDetails:h?{cashAmount:h,change:I}:null,notes:b||null})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Failed to create POS order")}let r=await s.json(),n=await fetch(`/api/pos/orders/${r.id}/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:a.map(e=>({productId:e.productId,variantId:e.variantId,quantity:e.quantity,price:e.price})),subtotal:S,tax:A,discount:D,discountCode:C?.code||null,total:E})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||"Failed to complete order")}let{order:d}=await n.json();(await fetch("/api/pos/payment/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({posOrderId:r.id,paymentMethod:t,amount:E,paymentDetails:h?{cashAmount:h,change:I}:null})})).ok||console.warn("Payment processing failed, but order was created"),F.default.success(`Order ${d.orderNumber} placed successfully!`),e((0,l.clearPosCart)()),x(null),y(null),w(""),k(null),v(`#${Date.now().toString().slice(-6)}`)}catch(e){console.error("Error processing order:",e),F.default.error("Failed to process order")}finally{g(!1)}};return(0,t.jsxs)("aside",{className:"w-96 border-l bg-background flex flex-col h-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-3 border-b flex items-center justify-between bg-primary/5 flex-shrink-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base",children:"Order's Summary"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:j})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,t.jsx)(Z.Maximize2,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"px-3 py-2 border-b bg-muted/30 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.ShoppingBag,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("p",{className:"text-sm font-semibold",children:["Items (",a.length,")"]})]})}),(0,t.jsx)(T.ScrollArea,{className:"flex-1 min-h-0 overflow-y-auto",children:(0,t.jsx)("div",{className:"p-3",children:0===a.length?(0,t.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,t.jsx)(f.ShoppingBag,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"Cart is empty"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Add items to get started"})]}):(0,t.jsx)("div",{className:"space-y-2",children:a.map(s=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded-lg border hover:bg-muted/50 transition-colors",children:[(0,t.jsx)("div",{className:"relative w-12 h-12 rounded overflow-hidden bg-muted flex-shrink-0 border",children:s.image&&(0,t.jsx)($.default,{src:s.image,alt:s.name,fill:!0,className:"object-cover",sizes:"48px"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",children:s.name}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[d(s.price)," × ",s.quantity," = ",d(s.price*s.quantity)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>P(s.id,s.quantity-1),title:"Decrease quantity",children:(0,t.jsx)("span",{className:"text-base font-bold",children:"−"})}),(0,t.jsx)("div",{className:"w-8 text-center",children:(0,t.jsx)("span",{className:"text-sm font-bold",children:s.quantity})}),(0,t.jsx)(n.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>P(s.id,s.quantity+1),title:"Increase quantity",children:(0,t.jsx)("span",{className:"text-base font-bold",children:"+"})}),(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{var t;return t=s.id,void e((0,l.removeFromPosCart)(t))},title:"Remove item",children:(0,t.jsx)(L.Trash2,{className:"h-4 w-4"})})]})]},s.id))})})}),(0,t.jsxs)("div",{className:"p-3 border-t space-y-3 bg-muted/20 flex-shrink-0 overflow-y-auto max-h-[60vh]",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Price:"}),(0,t.jsx)("span",{className:"font-medium",children:d(S)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Taxes:"}),(0,t.jsx)("span",{className:"font-medium",children:d(A)})]}),D>0&&(0,t.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Discount:"}),(0,t.jsxs)("span",{className:"font-medium text-green-600",children:["-",d(D)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-1.5 border-t",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsx)("span",{className:"text-primary",children:d(E)})]})]}),a.length>0&&(0,t.jsx)(el,{subtotal:S,onDiscountApply:k,appliedDiscount:C}),a.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{className:"text-xs font-semibold",children:"Order Notes (Optional)"}),(0,t.jsx)("textarea",{className:"w-full min-h-[60px] p-2 text-sm border rounded-md resize-none",placeholder:"Add special instructions or notes...",value:b,onChange:e=>w(e.target.value)})]}),a.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{className:"text-xs font-semibold",children:"Payment Method"}),(0,t.jsx)(et,{total:E,onPaymentSelect:(e,t)=>{"CASH"===e&&t&&x(t)},defaultMethod:m})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Button,{variant:"outline",className:(0,u.cn)("flex-1 h-12 text-sm font-semibold",0===a.length&&"opacity-50 cursor-not-allowed"),onClick:O,disabled:0===a.length||p,children:[(0,t.jsx)(en.Save,{className:"h-4 w-4 mr-2"}),"Hold"]}),(0,t.jsx)(n.Button,{className:(0,u.cn)("flex-1 h-14 text-base font-bold",0===a.length&&"opacity-50 cursor-not-allowed"),size:"lg",onClick:R,disabled:0===a.length||p||!h||h<E,children:p?"Processing...":(0,t.jsxs)(t.Fragment,{children:["Place Order ",a.length>0&&`(${a.length})`,(0,t.jsx)("span",{className:"ml-2 text-xs font-normal opacity-75",children:"(Enter)"})]})})]})]})]})}let eo=[{key:"Enter",action:"place-order",description:"Place order"},{key:"Escape",action:"clear-cart",description:"Clear cart"},{key:"F1",action:"payment-cash",description:"Cash payment"},{key:"F2",action:"payment-card",description:"Card payment"},{key:"F3",action:"payment-digital",description:"Digital wallet"},{key:"ArrowUp",action:"navigate-up",description:"Navigate up"},{key:"ArrowDown",action:"navigate-down",description:"Navigate down"},{key:"ArrowLeft",action:"navigate-left",description:"Navigate left"},{key:"ArrowRight",action:"navigate-right",description:"Navigate right"},{key:"+",action:"increase-quantity",description:"Increase quantity"},{key:"-",action:"decrease-quantity",description:"Decrease quantity"},{key:"Delete",action:"remove-item",description:"Remove item"}];function ec({onPlaceOrder:e,onPaymentSelect:t,onNavigate:a,enabled:n=!0}){let i=(0,r.useAppDispatch)(),o=(0,r.useAppSelector)(e=>e.pos.cart),c=(0,s.useCallback)((s,r)=>{if(n)switch(s){case"place-order":r.preventDefault(),e?.();break;case"clear-cart":r.preventDefault(),confirm("Clear cart?")&&i((0,l.clearPosCart)());break;case"payment-cash":r.preventDefault(),t?.("CASH");break;case"payment-card":r.preventDefault(),t?.("CARD");break;case"payment-digital":r.preventDefault(),t?.("DIGITAL_WALLET");break;case"increase-quantity":if(o.length>0){let e=o[o.length-1];i((0,l.updatePosCartQuantity)({id:e.id,quantity:e.quantity+1}))}break;case"decrease-quantity":if(o.length>0){let e=o[o.length-1];e.quantity>1?i((0,l.updatePosCartQuantity)({id:e.id,quantity:e.quantity-1})):i((0,l.removeFromPosCart)(e.id))}break;case"remove-item":if(o.length>0){let e=o[o.length-1];i((0,l.removeFromPosCart)(e.id))}break;case"navigate-up":a?.("up");break;case"navigate-down":a?.("down");break;case"navigate-left":a?.("left");break;case"navigate-right":a?.("right")}},[n,i,o,e,t,a]);return(0,s.useEffect)(()=>{if(!n)return;let e=e=>{let t,s=!isNaN(t=parseInt(e.key))&&t>=1&&t<=9?t:null;if(s&&o.length>0&&!e.ctrlKey&&!e.altKey&&!e.shiftKey){let e=o[o.length-1];i((0,l.updatePosCartQuantity)({id:e.id,quantity:s}));return}for(let t of eo){let s=t.key===e.key||t.key.toLowerCase()===e.key.toLowerCase(),a=t.ctrl?e.ctrlKey:!e.ctrlKey,r=t.shift?e.shiftKey:!e.shiftKey,l=t.alt?e.altKey:!e.altKey;if(s&&a&&r&&l){c(t.action,e);break}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n,o,i,c]),null}function ed(){let{data:e}=(0,a.useSession)(),n=(0,r.useAppDispatch)();(0,r.useAppSelector)(e=>e.pos.locationId),(0,r.useAppSelector)(e=>e.pos.cashierId);let[i,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)(null),u=(0,s.useRef)();return((0,s.useEffect)(()=>{let t=async()=>{try{let e=await fetch("/api/pos/cashiers/me");if(e.ok){let t=await e.json();t&&(n((0,l.setLocation)(t.locationId)),n((0,l.setCashier)(t.id)),d(t.location?.name||null))}else if(404===e.status){let[e,t]=await Promise.all([fetch("/api/pos/locations"),fetch("/api/pos/cashiers")]);if(e.ok&&t.ok){let s=await e.json(),a=await t.json(),r=s?.find(e=>e.isActive);if(r){n((0,l.setLocation)(r.id)),d(r.name);let e=a?.find(e=>e.locationId===r.id&&e.isActive);e?n((0,l.setCashier)(e.id)):a?.length>0&&a[0]?.isActive&&n((0,l.setCashier)(a[0].id))}else F.default.error("No active location found. Please create a location first.")}}else F.default.error("Failed to load POS session")}catch(e){console.error("Error initializing POS:",e),F.default.error("Failed to initialize POS session")}finally{o(!1)}};e?t():o(!1)},[e,n]),i)?(0,t.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading POS..."})]})}):(0,t.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,t.jsx)(ec,{onPlaceOrder:()=>{u.current?.()},onPaymentSelect:e=>{},enabled:!0}),(0,t.jsx)(h,{locationName:c}),(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,t.jsx)(b,{}),(0,t.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,t.jsx)(q,{}),(0,t.jsx)(P,{}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(W,{})})]})}),(0,t.jsx)(ei,{})]})]})}function eu(){return(0,t.jsx)(ed,{})}e.s(["default",()=>eu],142204)}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b08b40c8-190e-5f91-bd12-1307a1bca6e8")}catch(e){}}();
//# debugId=b08b40c8-190e-5f91-bd12-1307a1bca6e8
